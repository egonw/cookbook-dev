
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Changes in D3 5.0</title>
    
  <link rel="stylesheet" href="../../_static/css/index.f658d18f9b420779cfdf24aa0a7e2d77.css">

    
  <link rel="stylesheet"
    href="../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      
  <link rel="stylesheet"
    href="../../_static/vendor/open-sans_all/1.44.1/index.css">
  <link rel="stylesheet"
    href="../../_static/vendor/lato_latin-ext/1.44.1/index.css">

    
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/sphinx-book-theme.e7340bb3dbd8dde6db86f25597f54a1b.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/custom.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../../_static/js/index.d3f166471bb80abb5163.js">

    <script id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/togglebutton.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script src="../../_static/mermaid.js"></script>
    <script src="../../_static/mermaid.core.js"></script>
    <script src="../../_static/mermaid.min.js"></script>
    <script async="async" kind="hypothesis" src="https://hypothes.is/embed.js"></script>
    <script kind="utterances">

    var commentsRunWhenDOMLoaded = cb => {
    if (document.readyState != 'loading') {
        cb()
    } else if (document.addEventListener) {
        document.addEventListener('DOMContentLoaded', cb)
    } else {
        document.attachEvent('onreadystatechange', function() {
        if (document.readyState == 'complete') cb()
        })
    }
}

var addUtterances = () => {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src = "https://utteranc.es/client.js";
    script.async = "async";

    script.setAttribute("repo", "FAIRplus/the-fair-cookbook");
    script.setAttribute("issue-term", "pathname");
    script.setAttribute("theme", "github-light");
    script.setAttribute("label", "💬 comment");
    script.setAttribute("crossorigin", "anonymous");

    sections = document.querySelectorAll("div.section");
    if (sections !== null) {
        section = sections[sections.length-1];
        section.appendChild(script);
    }
}
commentsRunWhenDOMLoaded(addUtterances);
</script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../../_static/sphinx-book-theme.7d483ff0a819d6edff12ce0b1ead3928.js"></script>
    <script async="async" src="https://unpkg.com/thebelab@latest/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="../../_static/sphinx-thebe.js"></script>
    <link rel="canonical" href="https://fairplus.github.io/the-fair-cookbook/node_modules/d3/CHANGES.html" />
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />

    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />


<!-- Opengraph tags -->
<meta property="og:url"         content="https://fairplus.github.io/the-fair-cookbook/node_modules/d3/CHANGES.html" />
<meta property="og:type"        content="article" />
<meta property="og:title"       content="Changes in D3 5.0" />
<meta property="og:description" content="Changes in D3 5.0  Released March 22, 2018.  This document covers only major changes. For minor and patch changes, please see the release notes.  D3 5.0 introdu" />
<meta property="og:image"       content="https://fairplus.github.io/the-fair-cookbook/_static/cookbook-logo-small.png" />

<meta name="twitter:card" content="summary" />


  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
<a class="navbar-brand text-wrap" href="../../index.html">
  
  <img src="../../_static/cookbook-logo-small.png" class="logo" alt="logo">
  
  
</a>
</div><form class="bd-search d-flex align-items-center" action="../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form>
<nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
    <ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../../content/home.html">
   FAIR Cookbook
  </a>
 </li>
</ul>
<ul class="nav sidenav_l1">
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="../../content/recipes/introduction.html">
   Introduction
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="../../content/recipes/introduction/ATI-turingway.html">
     1. The Turing Way Book of Data Science
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../content/recipes/introduction/FAIR-cookbook-audience.html">
     2. Who should read the FAIR Cookbook?
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../content/recipes/introduction/brief-FAIR-principles.html">
     3. What are the FAIR Principles?
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../content/recipes/introduction/what-is-IMI.html">
     4. What is IMI?
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../content/recipes/introduction/FAIR-in-IMI-context.html">
     5. FAIR in the context of IMI
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../content/recipes/introduction/IMI-Data-Access-Request-Process.html">
     6. Engaging with IMI Projects
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../content/recipes/introduction/FAIRplus-values.html">
     7. The Ethical Values behind FAIR and the FAIRPlus project
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../content/recipes/introduction/data-sharing-models.html">
     8. High level data sharing models
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="../../content/recipes/assessing-fairness.html">
   Assessing FAIR
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="../../content/recipes/assessing-fairness/cmmi/Data-Management-Maturity-Model.html">
     1. Data Management Maturity Model
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../content/recipes/assessing-fairness/cmmi/Datasets-Maturity-Model.html">
     2. FAIRplus Datasets Maturity Model
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../content/recipes/assessing-fairness/cmmi/Data-Usage-Areas.html">
     3. Data Usage Areas
    </a>
   </li>
   <li class="toctree-l2 collapsible-parent">
    <a class="reference internal" href="../../content/recipes/assessing-fairness/fair-indicators.html">
     4. FAIR Indicators
    </a>
    <ul class="collapse-ul">
     <li class="toctree-l3">
      <a class="reference internal" href="../../content/recipes/assessing-fairness/cmmi/RDA-Indicators.html">
       4.4.1. RDA Indicators
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../content/recipes/assessing-fairness/cmmi/FAIRPlus-Indicators.html">
       4.4.2. IMI FAIRPlus Indicators
      </a>
     </li>
    </ul>
    <i class="fas fa-chevron-down">
    </i>
   </li>
   <li class="toctree-l2 collapsible-parent">
    <a class="reference internal" href="../../content/recipes/assessing-fairness/manual-fair-assessment.html">
     5. FAIR assessment by hand
    </a>
    <ul class="collapse-ul">
     <li class="toctree-l3">
      <a class="reference internal" href="../../content/recipes/assessing-fairness/cmmi/evaluation-method.html">
       5.4.1. Evaluation Method
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../content/recipes/assessing-fairness/cmmi/rda-evaluation.html">
       5.4.2. RDA Evaluation Methods
      </a>
     </li>
    </ul>
    <i class="fas fa-chevron-down">
    </i>
   </li>
   <li class="toctree-l2 collapsible-parent">
    <a class="reference internal" href="../../content/recipes/assessing-fairness/automatic-fair-assessment.html">
     6. FAIR assessment by software
    </a>
    <ul class="collapse-ul">
     <li class="toctree-l3">
      <a class="reference internal" href="../../content/recipes/assessing-fairness/fair-assessment-fairevaluator.html">
       6.4.1. Assessing FAIRness with FAIREvaluator
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../content/recipes/assessing-fairness/fair-assessment-fairshake.html">
       6.4.2. FAIR assessment with FAIRShake
      </a>
     </li>
    </ul>
    <i class="fas fa-chevron-down">
    </i>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="../../content/recipes/infrastructure.html">
   Infrastructure for FAIR
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="../../content/recipes/infrastructure/id-resolution.html">
     1. Identifier resolution services
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../content/recipes/infrastructure/data-catalog.html">
     2. Building a Dataset Catalogue
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../content/recipes/infrastructure/data-catalog-deployment.html">
     3. Deploying the IMI data catalogue
    </a>
   </li>
   <li class="toctree-l2 collapsible-parent">
    <a class="reference internal" href="../../content/recipes/infrastructure/vocabularies.html">
     4. Vocabularies and Terminology Infrastructure
    </a>
    <ul class="collapse-ul">
     <li class="toctree-l3">
      <a class="reference internal" href="../../content/recipes/infrastructure/vocabularies/technical-and-architectural-selection-criteria-of-ontology-lookup-services.html">
       4.1. Technical &amp; architectural selection criteria of ontology lookup services
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../content/recipes/infrastructure/vocabularies/Selecting_and_using_ontology_lookup_services.html">
       4.2. Selection and exploitation of Ontology Lookup Services
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../content/recipes/infrastructure/vocabularies/UC3_R13_local_ontology_services.html">
       4.3. How to deploy a terminology service - EBI Ontology Lookup Service
      </a>
     </li>
    </ul>
    <i class="fas fa-chevron-down">
    </i>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="../../content/recipes/findability.html">
   Improving Findability
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="../../content/recipes/findability/identifiers.html">
     1. How to generate globally unique, resolvable and persistent identifiers
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../content/recipes/infrastructure/chemical-identities.html">
     2. Chemical Identity - InChi and SMILES
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../content/recipes/findability/identifiers-minids.html">
     3. Identifier Minting Service with Minid Client
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../content/recipes/findability/zenodo-deposition.html">
     4. Deposition to Zenodo Archive
    </a>
   </li>
   <li class="toctree-l2 collapsible-parent">
    <a class="reference internal" href="../../content/recipes/findability/seo.html">
     5. Findability: Search Engine Optimization
    </a>
    <ul class="collapse-ul">
     <li class="toctree-l3">
      <a class="reference internal" href="../../content/recipes/findability/seo/bioschemas-data-page.html">
       5.8.1. Findability: Data Page Markup with Bioschemas
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../content/recipes/findability/seo/bioschemas-dataset.html">
       5.8.2. Findability: Dataset Markup
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../content/recipes/findability/seo/bioschemas-datacatalog.html">
       5.8.3. Findability: Data Catalog Markup
      </a>
     </li>
    </ul>
    <i class="fas fa-chevron-down">
    </i>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="../../content/recipes/accessibility.html">
   Improving Accessibility
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="../../content/recipes/accessibility/anonymization.html">
     1. Anonymizing Patient Data
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../content/recipes/accessibility/how-to-use-sftp-for-transfer.html">
     2. How to use SFTP to transfer data files between institutions.
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../content/recipes/accessibility/aspera.html">
     3. How to download files with Aspera
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="../../content/recipes/interoperability.html">
   Improving Interoperability
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="../../content/recipes/interoperability/selecting-ontologies.html">
     Which vocabulary to use?
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../content/recipes/interoperability/ontology-new-term-request-recipe.html">
     Requesting terms addition to terminology artefacts
    </a>
   </li>
   <li class="toctree-l2 collapsible-parent">
    <a class="reference internal" href="../../content/recipes/interoperability/ontology-robot-recipe.html">
     Building an application ontology with Robot
    </a>
    <ul class="collapse-ul">
     <li class="toctree-l3">
      <a class="reference internal" href="../../content/recipes/interoperability/ontology-robot/MSIO-robot-build-process.html">
       MSIO, an application ontology for Metabolomics
      </a>
     </li>
    </ul>
    <i class="fas fa-chevron-down">
    </i>
   </li>
   <li class="toctree-l2 collapsible-parent">
    <a class="reference internal" href="../../content/recipes/interoperability/creating-minimal-metadata-profiles.html">
     Creating a Metadata Profile
    </a>
    <ul class="collapse-ul">
     <li class="toctree-l3">
      <a class="reference internal" href="../../content/recipes/interoperability/transcriptomics-metadata.html">
       Establishing a Metadata Profile for Transcriptomics
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../content/recipes/interoperability/covid19-sample-metadata-profile-shex-use-case.html">
       Metadata Profile Validation in RDF with Shape Expression:
      </a>
     </li>
    </ul>
    <i class="fas fa-chevron-down">
    </i>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../content/recipes/interoperability/from-proprietary-to-open-standard-mzml-exemplar.html">
     From proprietary to open standard data format
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../content/recipes/interoperability/fastq-file-format-validators.html">
     File format validation, an example with FASTQ files
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="../../content/recipes/reusability.html">
   Improving Reusability
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="../../content/recipes/reusability/ATI-licensing.html">
     1. Licensing
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../content/recipes/reusability/ATI_licensing_software.html">
     2. Software Licenses
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../content/recipes/reusability/ATI_licensing_data.html">
     3. Data Licenses
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../content/recipes/reusability/expressing-data-use.html">
     4. Patterns and practice for expressing allowed data usage
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../content/recipes/reusability/provenance.html">
     5. Provenance Information
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../content/recipes/reusability/community-standards.html">
     6. Compliance with community annotation standards
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="../../content/recipes/applied-examples.html">
   Making IMI data FAIR
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2 collapsible-parent">
    <a class="reference internal" href="../../content/recipes/applied-examples/fair-data-matrix-recipe.html">
     Making a Data Matrix FAIR
    </a>
    <ul class="collapse-ul">
     <li class="toctree-l3">
      <a class="reference internal" href="../../content/recipes/applied-examples/fair-data-matrix/0-rose-metabolites-Python-data-handling.html">
       Bibliographic Reference:
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../content/recipes/applied-examples/fair-data-matrix/1-rose-metabolites-Python-analysis.html">
       Exploring and comparing Rose Scent profiles stored as tabular data packages with plotnine, a python port of R ggplot2
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../content/recipes/applied-examples/fair-data-matrix/2-rose-metabolites-Python-RDF-querying-analysis.html">
       Exploring a rose garden with SPARQL
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../content/recipes/applied-examples/fair-data-matrix/3-rose-metabolites-R-analysis.html">
       Exploring and comparing Rose Scent profiles stored as tabular data packages with ggplot2 R library
      </a>
     </li>
    </ul>
    <i class="fas fa-chevron-down">
    </i>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../content/recipes/applied-examples/etox_raw/FAIRplus_Recipe_Ontology_mapping_the_eTox_dataset_scenario.html">
     Data normalization and integration through entity linking
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../content/recipes/applied-examples/nd4bb_raw/FAIRification_CookBook_Recipe1_V02.html">
     ND4BB dataset FAIRification recipe
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../content/recipes/applied-examples/oncotrack_raw/rawRecipe-oncotrack.html">
     Oncotrack FAIRification recipe
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../content/recipes/applied-examples/resolute_raw/rawRecipe_resolute.html">
     RESOLUTE FAIRification Recipe
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../content/recipes/glossary-fair-terms.html">
   Glossary of FAIR things
  </a>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="../../content/recipes/help.html">
   Help
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="../../content/recipes/help/tips-tricks.html">
     1. Recipe Tips and Tricks
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../content/recipes/help/recipe-template.html">
     2. Recipe Template
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../content/recipes/help/how-to-create-recipe-with-gdoc.html">
     3. Using GoogleDocs to contribute a FAIR Cookbook Recipe
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../content/recipes/help/how-to-create-recipe-with-hackmd.html">
     4. How to use HackMD to write a FAIR Cookbook Recipe
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../content/recipes/help/how-to-create-recipe-with-git.html">
     5. How to create a FAIRPlus Coobook Recipe ?
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="../../content/recipes/boilerplate.html">
   Miscellaneous
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="../../content/recipes/boilerplate/license.html">
     1. License for this book
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../content/recipes/boilerplate/people.html">
     2. FAIR Cookbook Steering Council and Institutional Partners
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../content/recipes/boilerplate/governance.html">
     3. FAIR Cookbook Governance
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../content/recipes/boilerplate/code_of_conduct.html">
     4. FAIR Cookbook Code of Conduct
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../content/recipes/boilerplate/project_information.html">
     5. FAIR CookBook BoilerPlate
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../content/recipes/boilerplate/roadmap.html">
     6. FAIR cookbook development roadmap
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../content/recipes/boilerplate/contributing.html">
     7. Contributing to the FAIR cookbook
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../content/recipes/boilerplate/disclaimer.html">
     8. Disclaimer
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
</ul>

</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../../_sources/node_modules/d3/CHANGES.md"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.md</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/FAIRplus/the-fair-cookbook"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https://github.com/FAIRplus/the-fair-cookbook/issues/new?title=Issue%20on%20page%20%2Fnode_modules/d3/CHANGES.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        <a class="edit-button" href="https://github.com/FAIRplus/the-fair-cookbook/edit/migrating/node_modules/d3/CHANGES.md"><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Edit this page"><i class="fas fa-pencil-alt"></i>suggest edit</button></a>
    </div>
</div>


            <!-- Full screen (wrap in <a> to have style consistency -->
            <a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
                    data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
                    title="Fullscreen mode"><i
                        class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show">
            
        <div class="tocsection onthispage pt-5 pb-3">
            <i class="fas fa-list"></i>
            Contents
        </div>
        <nav id="bd-toc-nav">
            <ul class="nav section-nav flex-column">
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#">
   Changes in D3 5.0
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#changes-in-d3-4-0">
   Changes in D3 4.0
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#other-global-changes">
     Other Global Changes
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#table-of-contents">
     Table of Contents
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#arrays-d3-array">
     Arrays (d3-array)
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#axes-d3-axis">
     Axes (d3-axis)
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#brushes-d3-brush">
     Brushes (d3-brush)
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#chords-d3-chord">
     Chords (d3-chord)
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#collections-d3-collection">
     Collections (d3-collection)
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#colors-d3-color">
     Colors (d3-color)
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#dispatches-d3-dispatch">
     Dispatches (d3-dispatch)
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#dragging-d3-drag">
     Dragging (d3-drag)
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#delimiter-separated-values-d3-dsv">
     Delimiter-Separated Values (d3-dsv)
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#easings-d3-ease">
     Easings (d3-ease)
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#forces-d3-force">
     Forces (d3-force)
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#number-formats-d3-format">
     Number Formats (d3-format)
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#geographies-d3-geo">
     Geographies (d3-geo)
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#hierarchies-d3-hierarchy">
     Hierarchies (d3-hierarchy)
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#internals">
     Internals
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#interpolators-d3-interpolate">
     Interpolators (d3-interpolate)
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#paths-d3-path">
     Paths (d3-path)
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#polygons-d3-polygon">
     Polygons (d3-polygon)
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#quadtrees-d3-quadtree">
     Quadtrees (d3-quadtree)
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#queues-d3-queue">
     Queues (d3-queue)
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#random-numbers-d3-random">
     Random Numbers (d3-random)
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#requests-d3-request">
     Requests (d3-request)
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#scales-d3-scale">
     Scales (d3-scale)
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#selections-d3-selection">
     Selections (d3-selection)
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#shapes-d3-shape">
     Shapes (d3-shape)
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#time-formats-d3-time-format">
     Time Formats (d3-time-format)
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#time-intervals-d3-time">
     Time Intervals (d3-time)
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#timers-d3-timer">
     Timers (d3-timer)
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#transitions-d3-transition">
     Transitions (d3-transition)
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#voronoi-diagrams-d3-voronoi">
     Voronoi Diagrams (d3-voronoi)
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#zooming-d3-zoom">
     Zooming (d3-zoom)
    </a>
   </li>
  </ul>
 </li>
</ul>

        </nav>
        
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="changes-in-d3-5-0">
<h1>Changes in D3 5.0<a class="headerlink" href="#changes-in-d3-5-0" title="Permalink to this headline">¶</a></h1>
<p><a class="reference external" href="https://github.com/d3/d3/releases/tag/v5.0.0">Released March 22, 2018.</a></p>
<p><em>This document covers only major changes. For minor and patch changes, please see the <a class="reference external" href="https://github.com/d3/d3/releases">release notes</a>.</em></p>
<p>D3 5.0 introduces only a few non-backwards-compatible changes.</p>
<p>D3 now uses <a class="reference external" href="https://developer.mozilla.org/docs/Web/JavaScript/Guide/Using_promises">Promises</a> instead of asynchronous callbacks to load data. Promises simplify the structure of asynchronous code, especially in modern browsers that support <a class="reference external" href="https://javascript.info/async-await">async and await</a>. (See this <a class="reference external" href="https://observablehq.com/&#64;observablehq/introduction-to-promises">introduction to promises</a> on <a class="reference external" href="https://observablehq.com">Observable</a>.) For example, to load a CSV file in v4, you might say:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="nx">d3</span><span class="p">.</span><span class="nx">csv</span><span class="p">(</span><span class="s2">&quot;file.csv&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">error</span><span class="p">,</span> <span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="k">throw</span> <span class="nx">error</span><span class="p">;</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>
</div>
<p>In v5, using promises:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="nx">d3</span><span class="p">.</span><span class="nx">csv</span><span class="p">(</span><span class="s2">&quot;file.csv&quot;</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>
</div>
<p>Note that you don’t need to rethrow the error—the promise will reject automatically, and you can <em>promise</em>.catch if desired. Using await, the code is even simpler:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="kd">const</span> <span class="nx">data</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">d3</span><span class="p">.</span><span class="nx">csv</span><span class="p">(</span><span class="s2">&quot;file.csv&quot;</span><span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
</pre></div>
</div>
<p>With the adoption of promises, D3 now uses the <a class="reference external" href="https://fetch.spec.whatwg.org/">Fetch API</a> instead of <a class="reference external" href="https://developer.mozilla.org/docs/Web/API/XMLHttpRequest">XMLHttpRequest</a>: the <a class="reference external" href="https://github.com/d3/d3-request">d3-request</a> module has been replaced by <a class="reference external" href="https://github.com/d3/d3-fetch">d3-fetch</a>. Fetch supports many powerful new features, such as <a class="reference external" href="https://observablehq.com/&#64;mbostock/streaming-shapefiles">streaming responses</a>. D3 5.0 also deprecates and removes the <a class="reference external" href="https://github.com/d3/d3-queue">d3-queue</a> module. Use <a class="reference external" href="https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Promise/all">Promise.all</a> to run a batch of asynchronous tasks in parallel, or a helper library such as <a class="reference external" href="https://github.com/sindresorhus/p-queue">p-queue</a> to <a class="reference external" href="https://observablehq.com/&#64;mbostock/hello-p-queue">control concurrency</a>.</p>
<p>D3 no longer provides the d3.schemeCategory20* categorical color schemes. These twenty-color schemes were flawed because their grouped design could falsely imply relationships in the data: a shared hue can imply that the encoded data are part of a group (a super-category), while relative lightness can imply order. Instead, D3 now includes <a class="reference external" href="https://github.com/d3/d3-scale-chromatic">d3-scale-chromatic</a>, which implements excellent schemes from ColorBrewer, including <a class="reference external" href="https://github.com/d3/d3-scale-chromatic/blob/master/README.md#categorical">categorical</a>, <a class="reference external" href="https://github.com/d3/d3-scale-chromatic/blob/master/README.md#diverging">diverging</a>, <a class="reference external" href="https://github.com/d3/d3-scale-chromatic/blob/master/README.md#sequential-single-hue">sequential single-hue</a> and <a class="reference external" href="https://github.com/d3/d3-scale-chromatic/blob/master/README.md#sequential-multi-hue">sequential multi-hue</a> schemes. These schemes are available in both discrete and continuous variants.</p>
<p>D3 now provides implementations of <a class="reference external" href="https://observablehq.com/&#64;d3/contours">marching squares</a> and <a class="reference external" href="https://observablehq.com/&#64;d3/density-contours">density estimation</a> via <a class="reference external" href="https://github.com/d3/d3-contour">d3-contour</a>! There are two new <a class="reference external" href="https://github.com/d3/d3-selection">d3-selection</a> methods: <a class="reference external" href="https://github.com/d3/d3-selection/blob/master/README.md#selection_clone"><em>selection</em>.clone</a> for inserting clones of the selected nodes, and <a class="reference external" href="https://github.com/d3/d3-selection/blob/master/README.md#create">d3.create</a> for creating detached elements. <a class="reference external" href="https://github.com/d3/d3-geo">Geographic projections</a> now support <a class="reference external" href="https://github.com/d3/d3-geo/blob/master/README.md#projection_angle"><em>projection</em>.angle</a>, which has enabled several fantastic new <a class="reference external" href="https://github.com/d3/d3-geo-polygon">polyhedral projections</a> by Philippe Rivière.</p>
<p>Lastly, D3’s <a class="reference external" href="https://github.com/d3/d3/blob/master/package.json">package.json</a> no longer pins exact versions of the dependent D3 modules. This fixes an issue with <a class="reference external" href="https://github.com/d3/d3/issues/3256">duplicate installs</a> of D3 modules.</p>
</div>
<div class="section" id="changes-in-d3-4-0">
<h1>Changes in D3 4.0<a class="headerlink" href="#changes-in-d3-4-0" title="Permalink to this headline">¶</a></h1>
<p><a class="reference external" href="https://github.com/d3/d3/releases/tag/v4.0.0">Released June 28, 2016.</a></p>
<p>D3 4.0 is modular. Instead of one library, D3 is now <a class="reference external" href="#table-of-contents">many small libraries</a> that are designed to work together. You can pick and choose which parts to use as you see fit. Each library is maintained in its own repository, allowing decentralized ownership and independent release cycles. The default bundle combines about thirty of these microlibraries.</p>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;https://d3js.org/d3.v4.js&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
</pre></div>
</div>
<p>As before, you can load optional plugins on top of the default bundle, such as <a class="reference external" href="https://github.com/d3/d3-scale-chromatic">ColorBrewer scales</a>:</p>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;https://d3js.org/d3.v4.js&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;https://d3js.org/d3-scale-chromatic.v0.3.js&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
</pre></div>
</div>
<p>You are not required to use the default bundle! If you’re just using <a class="reference external" href="https://github.com/d3/d3-selection">d3-selection</a>, use it as a standalone library. Like the default bundle, you can load D3 microlibraries using vanilla script tags or RequireJS (great for HTTP/2!):</p>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;https://d3js.org/d3-selection.v1.js&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
</pre></div>
</div>
<p>You can also <code class="docutils literal notranslate"><span class="pre">cat</span></code> D3 microlibraries into a custom bundle, or use tools such as <a class="reference external" href="https://webpack.github.io/">Webpack</a> and <a class="reference external" href="http://rollupjs.org/">Rollup</a> to create <a class="reference external" href="https://bl.ocks.org/mbostock/bb09af4c39c79cffcde4">optimized bundles</a>. Custom bundles are great for applications that use a subset of D3’s features; for example, a React chart library might use D3 for scales and shapes, and React to manipulate the DOM. The D3 microlibraries are written as <a class="reference external" href="http://www.2ality.com/2014/09/es6-modules-final.html">ES6 modules</a>, and Rollup lets you pick at the symbol level to produce smaller bundles.</p>
<p>Small files are nice, but modularity is also about making D3 more <em>fun</em>. Microlibraries are easier to understand, develop and test. They make it easier for new people to get involved and contribute. They reduce the distinction between a “core module” and a “plugin”, and increase the pace of development in D3 features.</p>
<p>If you don’t care about modularity, you can mostly ignore this change and keep using the default bundle. However, there is one unavoidable consequence of adopting ES6 modules: every symbol in D3 4.0 now shares a flat namespace rather than the nested one of D3 3.x. For example, d3.scale.linear is now d3.scaleLinear, and d3.layout.treemap is now d3.treemap. The adoption of ES6 modules also means that D3 is now written exclusively in <a class="reference external" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Strict_mode">strict mode</a> and has better readability. And there have been many other significant improvements to D3’s features! (Nearly all of the code from D3 3.x has been rewritten.) These changes are covered below.</p>
<div class="section" id="other-global-changes">
<h2>Other Global Changes<a class="headerlink" href="#other-global-changes" title="Permalink to this headline">¶</a></h2>
<p>The default <a class="reference external" href="https://github.com/umdjs/umd">UMD bundle</a> is now <a class="reference external" href="https://github.com/requirejs/requirejs/wiki/Updating-existing-libraries#register-as-an-anonymous-module-">anonymous</a>. No <code class="docutils literal notranslate"><span class="pre">d3</span></code> global is exported if AMD or CommonJS is detected. In a vanilla environment, the D3 microlibraries share the <code class="docutils literal notranslate"><span class="pre">d3</span></code> global, even if you load them independently; thus, code you write is the same whether or not you use the default bundle. (See <a class="reference external" href="https://bost.ocks.org/mike/d3-plugin/">Let’s Make a (D3) Plugin</a> for more.) The generated bundle is no longer stored in the Git repository; Bower has been repointed to <a class="reference external" href="https://github.com/mbostock-bower/d3-bower">d3-bower</a>, and you can find the generated files on <a class="reference external" href="https://unpkg.com/d3">npm</a> or attached to the <a class="reference external" href="https://github.com/d3/d3/releases/latest">latest release</a>. The non-minified default bundle is no longer mangled, making it more readable and preserving inline comments.</p>
<p>To the consternation of some users, 3.x employed Unicode variable names such as λ, φ, τ and π for a concise representation of mathematical operations. A downside of this approach was that a SyntaxError would occur if you loaded the non-minified D3 using ISO-8859-1 instead of UTF-8. 3.x also used Unicode string literals, such as the SI-prefix µ for 1e-6. 4.0 uses only ASCII variable names and ASCII string literals (see <a class="reference external" href="https://github.com/mbostock/rollup-plugin-ascii">rollup-plugin-ascii</a>), avoiding encoding problems.</p>
</div>
<div class="section" id="table-of-contents">
<h2>Table of Contents<a class="headerlink" href="#table-of-contents" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p><a class="reference external" href="#arrays-d3-array">Arrays</a></p></li>
<li><p><a class="reference external" href="#axes-d3-axis">Axes</a></p></li>
<li><p><a class="reference external" href="#brushes-d3-brush">Brushes</a></p></li>
<li><p><a class="reference external" href="#chords-d3-chord">Chords</a></p></li>
<li><p><a class="reference external" href="#collections-d3-collection">Collections</a></p></li>
<li><p><a class="reference external" href="#colors-d3-color">Colors</a></p></li>
<li><p><a class="reference external" href="#dispatches-d3-dispatch">Dispatches</a></p></li>
<li><p><a class="reference external" href="#dragging-d3-drag">Dragging</a></p></li>
<li><p><a class="reference external" href="#delimiter-separated-values-d3-dsv">Delimiter-Separated Values</a></p></li>
<li><p><a class="reference external" href="#easings-d3-ease">Easings</a></p></li>
<li><p><a class="reference external" href="#forces-d3-force">Forces</a></p></li>
<li><p><a class="reference external" href="#number-formats-d3-format">Number Formats</a></p></li>
<li><p><a class="reference external" href="#geographies-d3-geo">Geographies</a></p></li>
<li><p><a class="reference external" href="#hierarchies-d3-hierarchy">Hierarchies</a></p></li>
<li><p><a class="reference external" href="#internals">Internals</a></p></li>
<li><p><a class="reference external" href="#interpolators-d3-interpolate">Interpolators</a></p></li>
<li><p><a class="reference external" href="#paths-d3-path">Paths</a></p></li>
<li><p><a class="reference external" href="#polygons-d3-polygon">Polygons</a></p></li>
<li><p><a class="reference external" href="#quadtrees-d3-quadtree">Quadtrees</a></p></li>
<li><p><a class="reference external" href="#queues-d3-queue">Queues</a></p></li>
<li><p><a class="reference external" href="#random-numbers-d3-random">Random Numbers</a></p></li>
<li><p><a class="reference external" href="#requests-d3-request">Requests</a></p></li>
<li><p><a class="reference external" href="#scales-d3-scale">Scales</a></p></li>
<li><p><a class="reference external" href="#selections-d3-selection">Selections</a></p></li>
<li><p><a class="reference external" href="#shapes-d3-shape">Shapes</a></p></li>
<li><p><a class="reference external" href="#time-formats-d3-time-format">Time Formats</a></p></li>
<li><p><a class="reference external" href="#time-intervals-d3-time">Time Intervals</a></p></li>
<li><p><a class="reference external" href="#timers-d3-timer">Timers</a></p></li>
<li><p><a class="reference external" href="#transitions-d3-transition">Transitions</a></p></li>
<li><p><a class="reference external" href="#voronoi-diagrams-d3-voronoi">Voronoi Diagrams</a></p></li>
<li><p><a class="reference external" href="#zooming-d3-zoom">Zooming</a></p></li>
</ul>
</div>
<div class="section" id="arrays-d3-array">
<h2><a class="reference external" href="https://github.com/d3/d3-array/blob/master/README.md">Arrays (d3-array)</a><a class="headerlink" href="#arrays-d3-array" title="Permalink to this headline">¶</a></h2>
<p>The new <a class="reference external" href="https://github.com/d3/d3-array/blob/master/README.md#scan">d3.scan</a> method performs a linear scan of an array, returning the index of the least element according to the specified comparator. This is similar to <a class="reference external" href="https://github.com/d3/d3-array/blob/master/README.md#min">d3.min</a> and <a class="reference external" href="https://github.com/d3/d3-array/blob/master/README.md#max">d3.max</a>, except you can use it to find the position of an extreme element, rather than just calculate an extreme value.</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">data</span> <span class="o">=</span> <span class="p">[</span>
  <span class="p">{</span><span class="nx">name</span><span class="o">:</span> <span class="s2">&quot;Alice&quot;</span><span class="p">,</span> <span class="nx">value</span><span class="o">:</span> <span class="mf">2</span><span class="p">},</span>
  <span class="p">{</span><span class="nx">name</span><span class="o">:</span> <span class="s2">&quot;Bob&quot;</span><span class="p">,</span> <span class="nx">value</span><span class="o">:</span> <span class="mf">3</span><span class="p">},</span>
  <span class="p">{</span><span class="nx">name</span><span class="o">:</span> <span class="s2">&quot;Carol&quot;</span><span class="p">,</span> <span class="nx">value</span><span class="o">:</span> <span class="mf">1</span><span class="p">},</span>
  <span class="p">{</span><span class="nx">name</span><span class="o">:</span> <span class="s2">&quot;Dwayne&quot;</span><span class="p">,</span> <span class="nx">value</span><span class="o">:</span> <span class="mf">5</span><span class="p">}</span>
<span class="p">];</span>

<span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="nx">d3</span><span class="p">.</span><span class="nx">scan</span><span class="p">(</span><span class="nx">data</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">a</span><span class="p">.</span><span class="nx">value</span> <span class="o">-</span> <span class="nx">b</span><span class="p">.</span><span class="nx">value</span><span class="p">;</span> <span class="p">});</span> <span class="c1">// 2</span>
<span class="nx">data</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span> <span class="c1">// {name: &quot;Carol&quot;, value: 1}</span>
</pre></div>
</div>
<p>The new <a class="reference external" href="https://github.com/d3/d3-array/blob/master/README.md#ticks">d3.ticks</a> and <a class="reference external" href="https://github.com/d3/d3-array/blob/master/README.md#tickStep">d3.tickStep</a> methods are useful for generating human-readable numeric ticks. These methods are a low-level alternative to <a class="reference external" href="https://github.com/d3/d3-scale/blob/master/README.md#continuous_ticks"><em>continuous</em>.ticks</a> from <a class="reference external" href="https://github.com/d3/d3-scale">d3-scale</a>. The new implementation is also more accurate, returning the optimal number of ticks as measured by relative error.</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">ticks</span> <span class="o">=</span> <span class="nx">d3</span><span class="p">.</span><span class="nx">ticks</span><span class="p">(</span><span class="mf">0</span><span class="p">,</span> <span class="mf">10</span><span class="p">,</span> <span class="mf">5</span><span class="p">);</span> <span class="c1">// [0, 2, 4, 6, 8, 10]</span>
</pre></div>
</div>
<p>The <a class="reference external" href="https://github.com/d3/d3-array/blob/master/README.md#range">d3.range</a> method no longer makes an elaborate attempt to avoid floating-point error when <em>step</em> is not an integer. The returned values are strictly defined as <em>start</em> + <em>i</em> * <em>step</em>, where <em>i</em> is an integer. (Learn more about <a class="reference external" href="http://0.30000000000000004.com/">floating point math</a>.) d3.range returns the empty array for infinite ranges, rather than throwing an error.</p>
<p>The method signature for optional accessors has been changed to be more consistent with array methods such as <a class="reference external" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/forEach"><em>array</em>.forEach</a>: the accessor is passed the current element (<em>d</em>), the index (<em>i</em>), and the array (<em>data</em>), with <em>this</em> as undefined. This affects <a class="reference external" href="https://github.com/d3/d3-array/blob/master/README.md#min">d3.min</a>, <a class="reference external" href="https://github.com/d3/d3-array/blob/master/README.md#max">d3.max</a>, <a class="reference external" href="https://github.com/d3/d3-array/blob/master/README.md#extent">d3.extent</a>, <a class="reference external" href="https://github.com/d3/d3-array/blob/master/README.md#sum">d3.sum</a>, <a class="reference external" href="https://github.com/d3/d3-array/blob/master/README.md#mean">d3.mean</a>, <a class="reference external" href="https://github.com/d3/d3-array/blob/master/README.md#median">d3.median</a>, <a class="reference external" href="https://github.com/d3/d3-array/blob/master/README.md#quantile">d3.quantile</a>, <a class="reference external" href="https://github.com/d3/d3-array/blob/master/README.md#variance">d3.variance</a> and <a class="reference external" href="https://github.com/d3/d3-array/blob/master/README.md#deviation">d3.deviation</a>. The <a class="reference external" href="https://github.com/d3/d3-array/blob/master/README.md#quantile">d3.quantile</a> method previously did not take an accessor. Some methods with optional arguments now treat those arguments as missing if they are null or undefined, rather than strictly checking arguments.length.</p>
<p>The new <a class="reference external" href="https://github.com/d3/d3-array/blob/master/README.md#histograms">d3.histogram</a> API replaces d3.layout.histogram. Rather than exposing <em>bin</em>.x and <em>bin</em>.dx on each returned bin, the histogram exposes <em>bin</em>.x0 and <em>bin</em>.x1, guaranteeing that <em>bin</em>.x0 is exactly equal to <em>bin</em>.x1 on the preceding bin. The “frequency” and “probability” modes are no longer supported; each bin is simply an array of elements from the input data, so <em>bin</em>.length is equal to D3 3.x’s <em>bin</em>.y in frequency mode. To compute a probability distribution, divide the number of elements in each bin by the total number of elements.</p>
<p>The <em>histogram</em>.range method has been renamed <a class="reference external" href="https://github.com/d3/d3-array/blob/master/README.md#histogram_domain"><em>histogram</em>.domain</a> for consistency with scales. The <em>histogram</em>.bins method has been renamed <a class="reference external" href="https://github.com/d3/d3-array/blob/master/README.md#histogram_thresholds"><em>histogram</em>.thresholds</a>, and no longer accepts an upper value: <em>n</em> thresholds will produce <em>n</em> + 1 bins. If you specify a desired number of bins rather than thresholds, d3.histogram now uses <a class="reference external" href="https://github.com/d3/d3-array/blob/master/README.md#ticks">d3.ticks</a> to compute nice bin thresholds. In addition to the default Sturges’ formula, D3 now implements the <a class="reference external" href="https://github.com/d3/d3-array/blob/master/README.md#thresholdFreedmanDiaconis">Freedman-Diaconis rule</a> and <a class="reference external" href="https://github.com/d3/d3-array/blob/master/README.md#thresholdScott">Scott’s normal reference rule</a>.</p>
</div>
<div class="section" id="axes-d3-axis">
<h2><a class="reference external" href="https://github.com/d3/d3-axis/blob/master/README.md">Axes (d3-axis)</a><a class="headerlink" href="#axes-d3-axis" title="Permalink to this headline">¶</a></h2>
<p>To render axes properly in D3 3.x, you needed to style them:</p>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">style</span><span class="p">&gt;</span>

<span class="p">.</span><span class="nc">axis</span> <span class="nt">path</span><span class="o">,</span>
<span class="p">.</span><span class="nc">axis</span> <span class="nt">line</span> <span class="p">{</span>
  <span class="n">fill</span><span class="p">:</span> <span class="kc">none</span><span class="p">;</span>
  <span class="n">stroke</span><span class="p">:</span> <span class="mh">#000</span><span class="p">;</span>
  <span class="n">shape-rendering</span><span class="p">:</span> <span class="n">crispEdges</span><span class="p">;</span>
<span class="p">}</span>

<span class="p">.</span><span class="nc">axis</span> <span class="nt">text</span> <span class="p">{</span>
  <span class="k">font</span><span class="p">:</span> <span class="mi">10</span><span class="kt">px</span> <span class="kc">sans-serif</span><span class="p">;</span>
<span class="p">}</span>

<span class="p">&lt;/</span><span class="nt">style</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">script</span><span class="p">&gt;</span>

<span class="nx">d3</span><span class="p">.</span><span class="nx">select</span><span class="p">(</span><span class="s2">&quot;.axis&quot;</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">d3</span><span class="p">.</span><span class="nx">svg</span><span class="p">.</span><span class="nx">axis</span><span class="p">()</span>
        <span class="p">.</span><span class="nx">scale</span><span class="p">(</span><span class="nx">x</span><span class="p">)</span>
        <span class="p">.</span><span class="nx">orient</span><span class="p">(</span><span class="s2">&quot;bottom&quot;</span><span class="p">));</span>

<span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
</pre></div>
</div>
<p>If you didn’t, you saw this:</p>
<img src="https://raw.githubusercontent.com/d3/d3/master/img/axis-v3.png" width="100%" height="105">
<p>D3 4.0 provides default styles and shorter syntax. In place of d3.svg.axis and <em>axis</em>.orient, D3 4.0 now provides four constructors for each orientation: <a class="reference external" href="https://github.com/d3/d3-axis/blob/master/README.md#axisTop">d3.axisTop</a>, <a class="reference external" href="https://github.com/d3/d3-axis/blob/master/README.md#axisRight">d3.axisRight</a>, <a class="reference external" href="https://github.com/d3/d3-axis/blob/master/README.md#axisBottom">d3.axisBottom</a>, <a class="reference external" href="https://github.com/d3/d3-axis/blob/master/README.md#axisLeft">d3.axisLeft</a>. These constructors accept a scale, so you can reduce all of the above to:</p>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">script</span><span class="p">&gt;</span>

<span class="nx">d3</span><span class="p">.</span><span class="nx">select</span><span class="p">(</span><span class="s2">&quot;.axis&quot;</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">d3</span><span class="p">.</span><span class="nx">axisBottom</span><span class="p">(</span><span class="nx">x</span><span class="p">));</span>

<span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
</pre></div>
</div>
<p>And get this:</p>
<img src="https://raw.githubusercontent.com/d3/d3/master/img/axis-v4.png" width="100%" height="105">
<p>As before, you can customize the axis appearance either by applying stylesheets or by modifying the axis elements. The default appearance has been changed slightly to offset the axis by a half-pixel;  this fixes a crisp-edges rendering issue on Safari where the axis would be drawn two-pixels thick.</p>
<p>There’s now an <a class="reference external" href="https://github.com/d3/d3-axis/blob/master/README.md#axis_tickArguments"><em>axis</em>.tickArguments</a> method, as an alternative to <a class="reference external" href="https://github.com/d3/d3-axis/blob/master/README.md#axis_ticks"><em>axis</em>.ticks</a> that also allows the axis tick arguments to be inspected. The <a class="reference external" href="https://github.com/d3/d3-axis/blob/master/README.md#axis_tickSize"><em>axis</em>.tickSize</a> method has been changed to only allow a single argument when setting the tick size. The <em>axis</em>.innerTickSize and <em>axis</em>.outerTickSize methods have been renamed <a class="reference external" href="https://github.com/d3/d3-axis/blob/master/README.md#axis_tickSizeInner"><em>axis</em>.tickSizeInner</a> and <a class="reference external" href="https://github.com/d3/d3-axis/blob/master/README.md#axis_tickSizeOuter"><em>axis</em>.tickSizeOuter</a>, respectively.</p>
</div>
<div class="section" id="brushes-d3-brush">
<h2><a class="reference external" href="https://github.com/d3/d3-brush/blob/master/README.md">Brushes (d3-brush)</a><a class="headerlink" href="#brushes-d3-brush" title="Permalink to this headline">¶</a></h2>
<p>Replacing d3.svg.brush, there are now three classes of brush for brushing along the <em>x</em>-dimension, the <em>y</em>-dimension, or both: <a class="reference external" href="https://github.com/d3/d3-brush/blob/master/README.md#brushX">d3.brushX</a>, <a class="reference external" href="https://github.com/d3/d3-brush/blob/master/README.md#brushY">d3.brushY</a>, <a class="reference external" href="https://github.com/d3/d3-brush/blob/master/README.md#brush">d3.brush</a>. Brushes are no longer dependent on <a class="reference external" href="#scales-d3-scale">scales</a>; instead, each brush defines a selection in screen coordinates. This selection can be <a class="reference external" href="https://github.com/d3/d3-scale/blob/master/README.md#continuous_invert">inverted</a> if you want to compute the corresponding data domain. And rather than rely on the scales’ ranges to determine the brushable area, there is now a <a class="reference external" href="https://github.com/d3/d3-brush/blob/master/README.md#brush_extent"><em>brush</em>.extent</a> method for setting it. If you do not set the brush extent, it defaults to the full extent of the owner SVG element. The <em>brush</em>.clamp method has also been eliminated; brushing is always restricted to the brushable area defined by the brush extent.</p>
<p>Brushes no longer store the active brush selection (<em>i.e.</em>, the highlighted region; the brush’s position) internally. The brush’s position is now stored on any elements to which the brush has been applied. The brush’s position is available as <em>event</em>.selection within a brush event or by calling <a class="reference external" href="https://github.com/d3/d3-brush/blob/master/README.md#brushSelection">d3.brushSelection</a> on a given <em>element</em>. To move the brush programmatically, use <a class="reference external" href="https://github.com/d3/d3-brush/blob/master/README.md#brush_move"><em>brush</em>.move</a> with a given <a class="reference external" href="#selections-d3-selection">selection</a> or <a class="reference external" href="#transitions-d3-transition">transition</a>; see the <a class="reference external" href="https://bl.ocks.org/mbostock/6232537">brush snapping example</a>. The <em>brush</em>.event method has been removed.</p>
<p>Brush interaction has been improved. By default, brushes now ignore right-clicks intended for the context menu; you can change this behavior using <a class="reference external" href="https://github.com/d3/d3-brush/blob/master/README.md#brush_filter"><em>brush</em>.filter</a>. Brushes also ignore emulated mouse events on iOS. Holding down SHIFT (⇧) while brushing locks the <em>x</em>- or <em>y</em>-position of the brush. Holding down META (⌘) while clicking and dragging starts a new selection, rather than translating the existing selection.</p>
<p>The default appearance of the brush has also been improved and slightly simplified. Previously it was necessary to apply styles to the brush to give it a reasonable appearance, such as:</p>
<div class="highlight-css notranslate"><div class="highlight"><pre><span></span><span class="p">.</span><span class="nc">brush</span> <span class="p">.</span><span class="nc">extent</span> <span class="p">{</span>
  <span class="n">stroke</span><span class="p">:</span> <span class="mh">#fff</span><span class="p">;</span>
  <span class="n">fill-opacity</span><span class="p">:</span> <span class="mf">.125</span><span class="p">;</span>
  <span class="n">shape-rendering</span><span class="p">:</span> <span class="n">crispEdges</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>These styles are now applied by default as attributes; if you want to customize the brush appearance, you can still apply external styles or modify the brush elements. (D3 4.0 features a similar improvement to <a class="reference external" href="#axes-d3-axis">axes</a>.) A new <a class="reference external" href="https://github.com/d3/d3-brush/blob/master/README.md#brush_handleSize"><em>brush</em>.handleSize</a> method lets you override the brush handle size; it defaults to six pixels.</p>
<p>The brush now consumes handled events, making it easier to combine with other interactive behaviors such as <a class="reference external" href="#dragging-d3-drag">dragging</a> and <a class="reference external" href="#zooming-d3-zoom">zooming</a>. The <em>brushstart</em> and <em>brushend</em> events have been renamed to <em>start</em> and <em>end</em>, respectively. The brush event no longer reports a <em>event</em>.mode to distinguish between resizing and dragging the brush.</p>
</div>
<div class="section" id="chords-d3-chord">
<h2><a class="reference external" href="https://github.com/d3/d3-chord/blob/master/README.md">Chords (d3-chord)</a><a class="headerlink" href="#chords-d3-chord" title="Permalink to this headline">¶</a></h2>
<p>Pursuant to the great namespace flattening:</p>
<ul class="simple">
<li><p>d3.layout.chord ↦ <a class="reference external" href="https://github.com/d3/d3-chord/blob/master/README.md#chord">d3.chord</a></p></li>
<li><p>d3.svg.chord ↦ <a class="reference external" href="https://github.com/d3/d3-chord/blob/master/README.md#ribbon">d3.ribbon</a></p></li>
</ul>
<p>For consistency with <a class="reference external" href="https://github.com/d3/d3-shape/blob/master/README.md#arc_padAngle"><em>arc</em>.padAngle</a>, <em>chord</em>.padding has also been renamed to <a class="reference external" href="https://github.com/d3/d3-chord/blob/master/README.md#ribbon_padAngle"><em>ribbon</em>.padAngle</a>. A new <a class="reference external" href="https://github.com/d3/d3-chord/blob/master/README.md#ribbon_context"><em>ribbon</em>.context</a> method lets you render chord diagrams to Canvas! See also <a class="reference external" href="#paths-d3-path">d3-path</a>.</p>
</div>
<div class="section" id="collections-d3-collection">
<h2><a class="reference external" href="https://github.com/d3/d3-collection/blob/master/README.md">Collections (d3-collection)</a><a class="headerlink" href="#collections-d3-collection" title="Permalink to this headline">¶</a></h2>
<p>The <a class="reference external" href="https://github.com/d3/d3-collection/blob/master/README.md#set">d3.set</a> constructor now accepts an existing set for making a copy. If you pass an array to d3.set, you can also pass a value accessor. This accessor takes the standard arguments: the current element (<em>d</em>), the index (<em>i</em>), and the array (<em>data</em>), with <em>this</em> undefined. For example:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">yields</span> <span class="o">=</span> <span class="p">[</span>
  <span class="p">{</span><span class="k">yield</span><span class="o">:</span> <span class="mf">22.13333</span><span class="p">,</span> <span class="nx">variety</span><span class="o">:</span> <span class="s2">&quot;Manchuria&quot;</span><span class="p">,</span>        <span class="nx">year</span><span class="o">:</span> <span class="mf">1932</span><span class="p">,</span> <span class="nx">site</span><span class="o">:</span> <span class="s2">&quot;Grand Rapids&quot;</span><span class="p">},</span>
  <span class="p">{</span><span class="k">yield</span><span class="o">:</span> <span class="mf">26.76667</span><span class="p">,</span> <span class="nx">variety</span><span class="o">:</span> <span class="s2">&quot;Peatland&quot;</span><span class="p">,</span>         <span class="nx">year</span><span class="o">:</span> <span class="mf">1932</span><span class="p">,</span> <span class="nx">site</span><span class="o">:</span> <span class="s2">&quot;Grand Rapids&quot;</span><span class="p">},</span>
  <span class="p">{</span><span class="k">yield</span><span class="o">:</span> <span class="mf">28.10000</span><span class="p">,</span> <span class="nx">variety</span><span class="o">:</span> <span class="s2">&quot;No. 462&quot;</span><span class="p">,</span>          <span class="nx">year</span><span class="o">:</span> <span class="mf">1931</span><span class="p">,</span> <span class="nx">site</span><span class="o">:</span> <span class="s2">&quot;Duluth&quot;</span><span class="p">},</span>
  <span class="p">{</span><span class="k">yield</span><span class="o">:</span> <span class="mf">38.50000</span><span class="p">,</span> <span class="nx">variety</span><span class="o">:</span> <span class="s2">&quot;Svansota&quot;</span><span class="p">,</span>         <span class="nx">year</span><span class="o">:</span> <span class="mf">1932</span><span class="p">,</span> <span class="nx">site</span><span class="o">:</span> <span class="s2">&quot;Waseca&quot;</span><span class="p">},</span>
  <span class="p">{</span><span class="k">yield</span><span class="o">:</span> <span class="mf">40.46667</span><span class="p">,</span> <span class="nx">variety</span><span class="o">:</span> <span class="s2">&quot;Svansota&quot;</span><span class="p">,</span>         <span class="nx">year</span><span class="o">:</span> <span class="mf">1931</span><span class="p">,</span> <span class="nx">site</span><span class="o">:</span> <span class="s2">&quot;Crookston&quot;</span><span class="p">},</span>
  <span class="p">{</span><span class="k">yield</span><span class="o">:</span> <span class="mf">36.03333</span><span class="p">,</span> <span class="nx">variety</span><span class="o">:</span> <span class="s2">&quot;Peatland&quot;</span><span class="p">,</span>         <span class="nx">year</span><span class="o">:</span> <span class="mf">1932</span><span class="p">,</span> <span class="nx">site</span><span class="o">:</span> <span class="s2">&quot;Waseca&quot;</span><span class="p">},</span>
  <span class="p">{</span><span class="k">yield</span><span class="o">:</span> <span class="mf">34.46667</span><span class="p">,</span> <span class="nx">variety</span><span class="o">:</span> <span class="s2">&quot;Wisconsin No. 38&quot;</span><span class="p">,</span> <span class="nx">year</span><span class="o">:</span> <span class="mf">1931</span><span class="p">,</span> <span class="nx">site</span><span class="o">:</span> <span class="s2">&quot;Grand Rapids&quot;</span><span class="p">}</span>
<span class="p">];</span>

<span class="kd">var</span> <span class="nx">sites</span> <span class="o">=</span> <span class="nx">d3</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="nx">yields</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">d</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">d</span><span class="p">.</span><span class="nx">site</span><span class="p">;</span> <span class="p">});</span> <span class="c1">// Grand Rapids, Duluth, Waseca, Crookston</span>
</pre></div>
</div>
<p>The <a class="reference external" href="https://github.com/d3/d3-collection/blob/master/README.md#map">d3.map</a> constructor also follows the standard array accessor argument pattern.</p>
<p>The <em>map</em>.forEach and <em>set</em>.forEach methods have been renamed to <a class="reference external" href="https://github.com/d3/d3-collection/blob/master/README.md#map_each"><em>map</em>.each</a> and <a class="reference external" href="https://github.com/d3/d3-collection/blob/master/README.md#set_each"><em>set</em>.each</a> respectively. The order of arguments for <em>map</em>.each has also been changed to <em>value</em>, <em>key</em> and <em>map</em>, while the order of arguments for <em>set</em>.each is now <em>value</em>, <em>value</em> and <em>set</em>. This is closer to ES6 <a class="reference external" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Map/forEach"><em>map</em>.forEach</a> and <a class="reference external" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Set/forEach"><em>set</em>.forEach</a>. Also like ES6 Map and Set, <em>map</em>.set and <em>set</em>.add now return the current collection (rather than the added value) to facilitate method chaining. New <a class="reference external" href="https://github.com/d3/d3-collection/blob/master/README.md#map_clear"><em>map</em>.clear</a> and <a class="reference external" href="https://github.com/d3/d3-collection/blob/master/README.md#set_clear"><em>set</em>.clear</a> methods can be used to empty collections.</p>
<p>The <a class="reference external" href="https://github.com/d3/d3-collection/blob/master/README.md#nest_map"><em>nest</em>.map</a> method now always returns a d3.map instance. For a plain object, use <a class="reference external" href="https://github.com/d3/d3-collection/blob/master/README.md#nest_object"><em>nest</em>.object</a> instead. When used in conjunction with <a class="reference external" href="https://github.com/d3/d3-collection/blob/master/README.md#nest_rollup"><em>nest</em>.rollup</a>, <a class="reference external" href="https://github.com/d3/d3-collection/blob/master/README.md#nest_entries"><em>nest</em>.entries</a> now returns {key, value} objects for the leaf entries, instead of {key, values}. This makes <em>nest</em>.rollup easier to use in conjunction with <a class="reference external" href="#hierarchies-d3-hierarchy">hierarchies</a>, as in this <a class="reference external" href="https://bl.ocks.org/mbostock/2838bf53e0e65f369f476afd653663a2">Nest Treemap example</a>.</p>
</div>
<div class="section" id="colors-d3-color">
<h2><a class="reference external" href="https://github.com/d3/d3-color/blob/master/README.md">Colors (d3-color)</a><a class="headerlink" href="#colors-d3-color" title="Permalink to this headline">¶</a></h2>
<p>All colors now have opacity exposed as <em>color</em>.opacity, which is a number in [0, 1]. You can pass an optional opacity argument to the color space constructors <a class="reference external" href="https://github.com/d3/d3-color/blob/master/README.md#rgb">d3.rgb</a>, <a class="reference external" href="https://github.com/d3/d3-color/blob/master/README.md#hsl">d3.hsl</a>, <a class="reference external" href="https://github.com/d3/d3-color/blob/master/README.md#lab">d3.lab</a>, <a class="reference external" href="https://github.com/d3/d3-color/blob/master/README.md#hcl">d3.hcl</a> or <a class="reference external" href="https://github.com/d3/d3-color/blob/master/README.md#cubehelix">d3.cubehelix</a>.</p>
<p>You can now parse rgba(…) and hsla(…) CSS color specifiers or the string “transparent” using <a class="reference external" href="https://github.com/d3/d3-color/blob/master/README.md#color">d3.color</a>. The “transparent” color is defined as an RGB color with zero opacity and undefined red, green and blue channels; this differs slightly from CSS which defines it as transparent black, but is useful for simplifying color interpolation logic where either the starting or ending color has undefined channels. The <a class="reference external" href="https://github.com/d3/d3-color/blob/master/README.md#color_toString"><em>color</em>.toString</a> method now likewise returns an rgb(…) or rgba(…) string with integer channel values, not the hexadecimal RGB format, consistent with CSS computed values. This improves performance by short-circuiting transitions when the element’s starting style matches its ending style.</p>
<p>The new <a class="reference external" href="https://github.com/d3/d3-color/blob/master/README.md#color">d3.color</a> method is the primary method for parsing colors: it returns a d3.color instance in the appropriate color space, or null if the CSS color specifier is invalid. For example:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">red</span> <span class="o">=</span> <span class="nx">d3</span><span class="p">.</span><span class="nx">color</span><span class="p">(</span><span class="s2">&quot;hsl(0, 80%, 50%)&quot;</span><span class="p">);</span> <span class="c1">// {h: 0, l: 0.5, s: 0.8, opacity: 1}</span>
</pre></div>
</div>
<p>The parsing implementation is now more robust. For example, you can no longer mix integers and percentages in rgb(…), and it correctly handles whitespace, decimal points, number signs, and other edge cases. The color space constructors d3.rgb, d3.hsl, d3.lab, d3.hcl and d3.cubehelix now always return a copy of the input color, converted to the corresponding color space. While <a class="reference external" href="https://github.com/d3/d3-color/blob/master/README.md#color_rgb"><em>color</em>.rgb</a> remains, <em>rgb</em>.hsl has been removed; use d3.hsl to convert a color to the RGB color space.</p>
<p>The RGB color space no longer greedily quantizes and clamps channel values when creating colors, improving accuracy in color space conversion. Quantization and clamping now occurs in <em>color</em>.toString when formatting a color for display. You can use the new <a class="reference external" href="https://github.com/d3/d3-color/blob/master/README.md#color_displayable"><em>color</em>.displayable</a> to test whether a color is <a class="reference external" href="https://en.wikipedia.org/wiki/Gamut">out-of-gamut</a>.</p>
<p>The <a class="reference external" href="https://github.com/d3/d3-color/blob/master/README.md#rgb_brighter"><em>rgb</em>.brighter</a> method no longer special-cases black. This is a multiplicative operator, defining a new color <em>r</em>′, <em>g</em>′, <em>b</em>′ where <em>r</em>′ = <em>r</em> × <em>pow</em>(0.7, <em>k</em>), <em>g</em>′ = <em>g</em> × <em>pow</em>(0.7, <em>k</em>) and <em>b</em>′ = <em>b</em> × <em>pow</em>(0.7, <em>k</em>); a brighter black is still black.</p>
<p>There’s a new <a class="reference external" href="https://github.com/d3/d3-color/blob/master/README.md#cubehelix">d3.cubehelix</a> color space, generalizing Dave Green’s color scheme! (See also <a class="reference external" href="https://github.com/d3/d3-scale/blob/master/README.md#interpolateCubehelixDefault">d3.interpolateCubehelixDefault</a> from <a class="reference external" href="#scales-d3-scale">d3-scale</a>.) You can continue to define your own custom color spaces, too; see <a class="reference external" href="https://github.com/d3/d3-hsv">d3-hsv</a> for an example.</p>
</div>
<div class="section" id="dispatches-d3-dispatch">
<h2><a class="reference external" href="https://github.com/d3/d3-dispatch/blob/master/README.md">Dispatches (d3-dispatch)</a><a class="headerlink" href="#dispatches-d3-dispatch" title="Permalink to this headline">¶</a></h2>
<p>Rather than decorating the <em>dispatch</em> object with each event type, the dispatch object now exposes generic <a class="reference external" href="https://github.com/d3/d3-dispatch/blob/master/README.md#dispatch_call"><em>dispatch</em>.call</a> and <a class="reference external" href="https://github.com/d3/d3-dispatch/blob/master/README.md#dispatch_apply"><em>dispatch</em>.apply</a> methods which take the <em>type</em> string as the first argument. For example, in D3 3.x, you might say:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="nx">dispatcher</span><span class="p">.</span><span class="nx">foo</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">that</span><span class="p">,</span> <span class="s2">&quot;Hello, Foo!&quot;</span><span class="p">);</span>
</pre></div>
</div>
<p>To dispatch a <em>foo</em> event in D3 4.0, you’d say:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="nx">dispatcher</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="s2">&quot;foo&quot;</span><span class="p">,</span> <span class="nx">that</span><span class="p">,</span> <span class="s2">&quot;Hello, Foo!&quot;</span><span class="p">);</span>
</pre></div>
</div>
<p>The <a class="reference external" href="https://github.com/d3/d3-dispatch/blob/master/README.md#dispatch_on"><em>dispatch</em>.on</a> method now accepts multiple typenames, allowing you to add or remove listeners for multiple events simultaneously. For example, to send both <em>foo</em> and <em>bar</em> events to the same listener:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="nx">dispatcher</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;foo bar&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">message</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">message</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>
</div>
<p>This matches the new behavior of <a class="reference external" href="https://github.com/d3/d3-selection/blob/master/README.md#selection_on"><em>selection</em>.on</a> in <a class="reference external" href="#selections-d3-selection">d3-selection</a>. The <em>dispatch</em>.on method now validates that the specifier <em>listener</em> is a function, rather than throwing an error in the future.</p>
<p>The new implementation d3.dispatch is faster, using fewer closures to improve performance. There’s also a new <a class="reference external" href="https://github.com/d3/d3-dispatch/blob/master/README.md#dispatch_copy"><em>dispatch</em>.copy</a> method for making a copy of a dispatcher; this is used by <a class="reference external" href="#transitions-d3-transition">d3-transition</a> to improve the performance of transitions in the common case where all elements in a transition have the same transition event listeners.</p>
</div>
<div class="section" id="dragging-d3-drag">
<h2><a class="reference external" href="https://github.com/d3/d3-drag/blob/master/README.md">Dragging (d3-drag)</a><a class="headerlink" href="#dragging-d3-drag" title="Permalink to this headline">¶</a></h2>
<p>The drag behavior d3.behavior.drag has been renamed to d3.drag. The <em>drag</em>.origin method has been replaced by <a class="reference external" href="https://github.com/d3/d3-drag/blob/master/README.md#drag_subject"><em>drag</em>.subject</a>, which allows you to define the thing being dragged at the start of a drag gesture. This is particularly useful with Canvas, where draggable objects typically share a Canvas element (as opposed to SVG, where draggable objects typically have distinct DOM elements); see the <a class="reference external" href="https://bl.ocks.org/mbostock/444757cc9f0fde320a5f469cd36860f4">circle dragging example</a>.</p>
<p>A new <a class="reference external" href="https://github.com/d3/d3-drag/blob/master/README.md#drag_container"><em>drag</em>.container</a> method lets you override the parent element that defines the drag gesture coordinate system. This defaults to the parent node of the element to which the drag behavior was applied. For dragging on Canvas elements, you probably want to use the Canvas element as the container.</p>
<p><a class="reference external" href="https://github.com/d3/d3-drag/blob/master/README.md#drag-events">Drag events</a> now expose an <a class="reference external" href="https://github.com/d3/d3-drag/blob/master/README.md#event_on"><em>event</em>.on</a> method for registering temporary listeners for duration of the current drag gesture; these listeners can capture state for the current gesture, such as the thing being dragged. A new <em>event</em>.active property lets you detect whether multiple (multitouch) drag gestures are active concurrently. The <em>dragstart</em> and <em>dragend</em> events have been renamed to <em>start</em> and <em>end</em>. By default, drag behaviors now ignore right-clicks intended for the context menu; use <a class="reference external" href="https://github.com/d3/d3-drag/blob/master/README.md#drag_filter"><em>drag</em>.filter</a> to control which events are ignored. The drag behavior also ignores emulated mouse events on iOS. The drag behavior now consumes handled events, making it easier to combine with other interactive behaviors such as <a class="reference external" href="#zooming-d3-zoom">zooming</a>.</p>
<p>The new <a class="reference external" href="https://github.com/d3/d3-drag/blob/master/README.md#dragEnable">d3.dragEnable</a> and <a class="reference external" href="https://github.com/d3/d3-drag/blob/master/README.md#dragDisable">d3.dragDisable</a> methods provide a low-level API for implementing drag gestures across browsers and devices. These methods are also used by other D3 components, such as the <a class="reference external" href="#brushes-d3-brush">brush</a>.</p>
</div>
<div class="section" id="delimiter-separated-values-d3-dsv">
<h2><a class="reference external" href="https://github.com/d3/d3-dsv/blob/master/README.md">Delimiter-Separated Values (d3-dsv)</a><a class="headerlink" href="#delimiter-separated-values-d3-dsv" title="Permalink to this headline">¶</a></h2>
<p>Pursuant to the great namespace flattening, various CSV and TSV methods have new names:</p>
<ul class="simple">
<li><p>d3.csv.parse ↦ <a class="reference external" href="https://github.com/d3/d3-dsv/blob/master/README.md#csvParse">d3.csvParse</a></p></li>
<li><p>d3.csv.parseRows ↦ <a class="reference external" href="https://github.com/d3/d3-dsv/blob/master/README.md#csvParseRows">d3.csvParseRows</a></p></li>
<li><p>d3.csv.format ↦ <a class="reference external" href="https://github.com/d3/d3-dsv/blob/master/README.md#csvFormat">d3.csvFormat</a></p></li>
<li><p>d3.csv.formatRows ↦ <a class="reference external" href="https://github.com/d3/d3-dsv/blob/master/README.md#csvFormatRows">d3.csvFormatRows</a></p></li>
<li><p>d3.tsv.parse ↦ <a class="reference external" href="https://github.com/d3/d3-dsv/blob/master/README.md#tsvParse">d3.tsvParse</a></p></li>
<li><p>d3.tsv.parseRows ↦ <a class="reference external" href="https://github.com/d3/d3-dsv/blob/master/README.md#tsvParseRows">d3.tsvParseRows</a></p></li>
<li><p>d3.tsv.format ↦ <a class="reference external" href="https://github.com/d3/d3-dsv/blob/master/README.md#tsvFormat">d3.tsvFormat</a></p></li>
<li><p>d3.tsv.formatRows ↦ <a class="reference external" href="https://github.com/d3/d3-dsv/blob/master/README.md#tsvFormatRows">d3.tsvFormatRows</a></p></li>
</ul>
<p>The <a class="reference external" href="https://github.com/d3/d3-request/blob/master/README.md#csv">d3.csv</a> and <a class="reference external" href="https://github.com/d3/d3-request/blob/master/README.md#tsv">d3.tsv</a> methods for loading files of the corresponding formats have not been renamed, however! Those are defined in <a class="reference external" href="#requests-d3-request">d3-request</a>.There’s no longer a d3.dsv method, which served the triple purpose of defining a DSV formatter, a DSV parser and a DSV requestor; instead, there’s just <a class="reference external" href="https://github.com/d3/d3-dsv/blob/master/README.md#dsvFormat">d3.dsvFormat</a> which you can use to define a DSV formatter and parser. You can use <a class="reference external" href="https://github.com/d3/d3-request/blob/master/README.md#request_response"><em>request</em>.response</a> to make a request and then parse the response body, or just use <a class="reference external" href="https://github.com/d3/d3-request/blob/master/README.md#text">d3.text</a>.</p>
<p>The <a class="reference external" href="https://github.com/d3/d3-dsv/blob/master/README.md#dsv_parse"><em>dsv</em>.parse</a> method now exposes the column names and their input order as <em>data</em>.columns. For example:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="nx">d3</span><span class="p">.</span><span class="nx">csv</span><span class="p">(</span><span class="s2">&quot;cars.csv&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">error</span><span class="p">,</span> <span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="k">throw</span> <span class="nx">error</span><span class="p">;</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">columns</span><span class="p">);</span> <span class="c1">// [&quot;Year&quot;, &quot;Make&quot;, &quot;Model&quot;, &quot;Length&quot;]</span>
<span class="p">});</span>
</pre></div>
</div>
<p>You can likewise pass an optional array of column names to <a class="reference external" href="https://github.com/d3/d3-dsv/blob/master/README.md#dsv_format"><em>dsv</em>.format</a> to format only a subset of columns, or to specify the column order explicitly:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">string</span> <span class="o">=</span> <span class="nx">d3</span><span class="p">.</span><span class="nx">csvFormat</span><span class="p">(</span><span class="nx">data</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;Year&quot;</span><span class="p">,</span> <span class="s2">&quot;Model&quot;</span><span class="p">,</span> <span class="s2">&quot;Length&quot;</span><span class="p">]);</span>
</pre></div>
</div>
<p>The parser is a bit faster and the formatter is a bit more robust: inputs are coerced to strings before formatting, fixing an obscure crash, and deprecated support for falling back to <a class="reference external" href="https://github.com/d3/d3-dsv/blob/master/README.md#dsv_formatRows"><em>dsv</em>.formatRows</a> when the input <em>data</em> is an array of arrays has been removed.</p>
</div>
<div class="section" id="easings-d3-ease">
<h2><a class="reference external" href="https://github.com/d3/d3-ease/blob/master/README.md">Easings (d3-ease)</a><a class="headerlink" href="#easings-d3-ease" title="Permalink to this headline">¶</a></h2>
<p>D3 3.x used strings, such as “cubic-in-out”, to identify easing methods; these strings could be passed to d3.ease or <em>transition</em>.ease. D3 4.0 uses symbols instead, such as <a class="reference external" href="https://github.com/d3/d3-ease/blob/master/README.md#easeCubicInOut">d3.easeCubicInOut</a>. Symbols are simpler and cleaner. They work well with Rollup to produce smaller custom bundles. You can still define your own custom easing function, too, if desired. Here’s the full list of equivalents:</p>
<ul class="simple">
<li><p>linear ↦ <a class="reference external" href="https://github.com/d3/d3-ease/blob/master/README.md#easeLinear">d3.easeLinear</a>¹</p></li>
<li><p>linear-in ↦ <a class="reference external" href="https://github.com/d3/d3-ease/blob/master/README.md#easeLinear">d3.easeLinear</a>¹</p></li>
<li><p>linear-out ↦ <a class="reference external" href="https://github.com/d3/d3-ease/blob/master/README.md#easeLinear">d3.easeLinear</a>¹</p></li>
<li><p>linear-in-out ↦ <a class="reference external" href="https://github.com/d3/d3-ease/blob/master/README.md#easeLinear">d3.easeLinear</a>¹</p></li>
<li><p>linear-out-in ↦ <a class="reference external" href="https://github.com/d3/d3-ease/blob/master/README.md#easeLinear">d3.easeLinear</a>¹</p></li>
<li><p>poly-in ↦ <a class="reference external" href="https://github.com/d3/d3-ease/blob/master/README.md#easePolyIn">d3.easePolyIn</a></p></li>
<li><p>poly-out ↦ <a class="reference external" href="https://github.com/d3/d3-ease/blob/master/README.md#easePolyOut">d3.easePolyOut</a></p></li>
<li><p>poly-in-out ↦ <a class="reference external" href="https://github.com/d3/d3-ease/blob/master/README.md#easePolyInOut">d3.easePolyInOut</a></p></li>
<li><p>poly-out-in ↦ REMOVED²</p></li>
<li><p>quad-in ↦ <a class="reference external" href="https://github.com/d3/d3-ease/blob/master/README.md#easeQuadIn">d3.easeQuadIn</a></p></li>
<li><p>quad-out ↦ <a class="reference external" href="https://github.com/d3/d3-ease/blob/master/README.md#easeQuadOut">d3.easeQuadOut</a></p></li>
<li><p>quad-in-out ↦ <a class="reference external" href="https://github.com/d3/d3-ease/blob/master/README.md#easeQuadInOut">d3.easeQuadInOut</a></p></li>
<li><p>quad-out-in ↦ REMOVED²</p></li>
<li><p>cubic-in ↦ <a class="reference external" href="https://github.com/d3/d3-ease/blob/master/README.md#easeCubicIn">d3.easeCubicIn</a></p></li>
<li><p>cubic-out ↦ <a class="reference external" href="https://github.com/d3/d3-ease/blob/master/README.md#easeCubicOut">d3.easeCubicOut</a></p></li>
<li><p>cubic-in-out ↦ <a class="reference external" href="https://github.com/d3/d3-ease/blob/master/README.md#easeCubicInOut">d3.easeCubicInOut</a></p></li>
<li><p>cubic-out-in ↦ REMOVED²</p></li>
<li><p>sin-in ↦ <a class="reference external" href="https://github.com/d3/d3-ease/blob/master/README.md#easeSinIn">d3.easeSinIn</a></p></li>
<li><p>sin-out ↦ <a class="reference external" href="https://github.com/d3/d3-ease/blob/master/README.md#easeSinOut">d3.easeSinOut</a></p></li>
<li><p>sin-in-out ↦ <a class="reference external" href="https://github.com/d3/d3-ease/blob/master/README.md#easeSinInOut">d3.easeSinInOut</a></p></li>
<li><p>sin-out-in ↦ REMOVED²</p></li>
<li><p>exp-in ↦ <a class="reference external" href="https://github.com/d3/d3-ease/blob/master/README.md#easeExpIn">d3.easeExpIn</a></p></li>
<li><p>exp-out ↦ <a class="reference external" href="https://github.com/d3/d3-ease/blob/master/README.md#easeExpOut">d3.easeExpOut</a></p></li>
<li><p>exp-in-out ↦ <a class="reference external" href="https://github.com/d3/d3-ease/blob/master/README.md#easeExpInOut">d3.easeExpInOut</a></p></li>
<li><p>exp-out-in ↦ REMOVED²</p></li>
<li><p>circle-in ↦ <a class="reference external" href="https://github.com/d3/d3-ease/blob/master/README.md#easeCircleIn">d3.easeCircleIn</a></p></li>
<li><p>circle-out ↦ <a class="reference external" href="https://github.com/d3/d3-ease/blob/master/README.md#easeCircleOut">d3.easeCircleOut</a></p></li>
<li><p>circle-in-out ↦ <a class="reference external" href="https://github.com/d3/d3-ease/blob/master/README.md#easeCircleInOut">d3.easeCircleInOut</a></p></li>
<li><p>circle-out-in ↦ REMOVED²</p></li>
<li><p>elastic-in ↦ <a class="reference external" href="https://github.com/d3/d3-ease/blob/master/README.md#easeElasticOut">d3.easeElasticOut</a>²</p></li>
<li><p>elastic-out ↦ <a class="reference external" href="https://github.com/d3/d3-ease/blob/master/README.md#easeElasticIn">d3.easeElasticIn</a>²</p></li>
<li><p>elastic-in-out ↦ REMOVED²</p></li>
<li><p>elastic-out-in ↦ <a class="reference external" href="https://github.com/d3/d3-ease/blob/master/README.md#easeElasticInOut">d3.easeElasticInOut</a>²</p></li>
<li><p>back-in ↦ <a class="reference external" href="https://github.com/d3/d3-ease/blob/master/README.md#easeBackIn">d3.easeBackIn</a></p></li>
<li><p>back-out ↦ <a class="reference external" href="https://github.com/d3/d3-ease/blob/master/README.md#easeBackOut">d3.easeBackOut</a></p></li>
<li><p>back-in-out ↦ <a class="reference external" href="https://github.com/d3/d3-ease/blob/master/README.md#easeBackInOut">d3.easeBackInOut</a></p></li>
<li><p>back-out-in ↦ REMOVED²</p></li>
<li><p>bounce-in ↦ <a class="reference external" href="https://github.com/d3/d3-ease/blob/master/README.md#easeBounceOut">d3.easeBounceOut</a>²</p></li>
<li><p>bounce-out ↦ <a class="reference external" href="https://github.com/d3/d3-ease/blob/master/README.md#easeBounceIn">d3.easeBounceIn</a>²</p></li>
<li><p>bounce-in-out ↦ REMOVED²</p></li>
<li><p>bounce-out-in ↦ <a class="reference external" href="https://github.com/d3/d3-ease/blob/master/README.md#easeBounceInOut">d3.easeBounceInOut</a>²</p></li>
</ul>
<p>¹ The -in, -out and -in-out variants of linear easing are identical, so there’s just d3.easeLinear.
<br>² Elastic and bounce easing were inadvertently reversed in 3.x, so 4.0 eliminates -out-in easing!</p>
<p>For convenience, there are also default aliases for each easing method. For example, <a class="reference external" href="https://github.com/d3/d3-ease/blob/master/README.md#easeCubic">d3.easeCubic</a> is an alias for <a class="reference external" href="https://github.com/d3/d3-ease/blob/master/README.md#easeCubicInOut">d3.easeCubicInOut</a>. Most default to -in-out; the exceptions are <a class="reference external" href="https://github.com/d3/d3-ease/blob/master/README.md#easeBounce">d3.easeBounce</a> and <a class="reference external" href="https://github.com/d3/d3-ease/blob/master/README.md#easeElastic">d3.easeElastic</a>, which default to -out.</p>
<p>Rather than pass optional arguments to d3.ease or <em>transition</em>.ease, parameterizable easing functions now have named parameters: <a class="reference external" href="https://github.com/d3/d3-ease/blob/master/README.md#poly_exponent"><em>poly</em>.exponent</a>, <a class="reference external" href="https://github.com/d3/d3-ease/blob/master/README.md#elastic_amplitude"><em>elastic</em>.amplitude</a>, <a class="reference external" href="https://github.com/d3/d3-ease/blob/master/README.md#elastic_period"><em>elastic</em>.period</a> and <a class="reference external" href="https://github.com/d3/d3-ease/blob/master/README.md#back_overshoot"><em>back</em>.overshoot</a>. For example, in D3 3.x you might say:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">e</span> <span class="o">=</span> <span class="nx">d3</span><span class="p">.</span><span class="nx">ease</span><span class="p">(</span><span class="s2">&quot;elastic-out-in&quot;</span><span class="p">,</span> <span class="mf">1.2</span><span class="p">);</span>
</pre></div>
</div>
<p>The equivalent in D3 4.0 is:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">e</span> <span class="o">=</span> <span class="nx">d3</span><span class="p">.</span><span class="nx">easeElastic</span><span class="p">.</span><span class="nx">amplitude</span><span class="p">(</span><span class="mf">1.2</span><span class="p">);</span>
</pre></div>
</div>
<p>Many of the easing functions have been optimized for performance and accuracy. Several bugs have been fixed, as well, such as the interpretation of the overshoot parameter for back easing, and the period parameter for elastic easing. Also, <a class="reference external" href="#transitions-d3-transition">d3-transition</a> now explicitly guarantees that the last tick of the transition happens at exactly <em>t</em> = 1, avoiding floating point errors in some easing functions.</p>
<p>There’s now a nice <a class="reference external" href="https://github.com/d3/d3-ease/blob/master/README.md">visual reference</a> and an <a class="reference external" href="https://bl.ocks.org/mbostock/248bac3b8e354a9103c4">animated reference</a> to the new easing functions, too!</p>
</div>
<div class="section" id="forces-d3-force">
<h2><a class="reference external" href="https://github.com/d3/d3-force/blob/master/README.md">Forces (d3-force)</a><a class="headerlink" href="#forces-d3-force" title="Permalink to this headline">¶</a></h2>
<p>The force layout d3.layout.force has been renamed to d3.forceSimulation. The force simulation now uses <a class="reference external" href="https://en.wikipedia.org/wiki/Verlet_integration#Velocity_Verlet">velocity Verlet integration</a> rather than position Verlet, tracking the nodes’ positions (<em>node</em>.x, <em>node</em>.y) and velocities (<em>node</em>.vx, <em>node</em>.vy) rather than their previous positions (<em>node</em>.px, <em>node</em>.py).</p>
<p>Rather than hard-coding a set of built-in forces, the force simulation is now extensible: you specify which forces you want! The approach affords greater flexibility through composition. The new forces are more flexible, too: force parameters can typically be configured per-node or per-link. There are separate positioning forces for <a class="reference external" href="https://github.com/d3/d3-force/blob/master/README.md#forceX"><em>x</em></a> and <a class="reference external" href="https://github.com/d3/d3-force/blob/master/README.md#forceY"><em>y</em></a> that replace <em>force</em>.gravity; <a class="reference external" href="https://github.com/d3/d3-force/blob/master/README.md#x_x"><em>x</em>.x</a> and <a class="reference external" href="https://github.com/d3/d3-force/blob/master/README.md#y_y"><em>y</em>.y</a> replace <em>force</em>.size. The new <a class="reference external" href="https://github.com/d3/d3-force/blob/master/README.md#forceLink">link force</a> replaces <em>force</em>.linkStrength and employs better default heuristics to improve stability. The new <a class="reference external" href="https://github.com/d3/d3-force/blob/master/README.md#forceManyBody">many-body force</a> replaces <em>force</em>.charge and supports a new <a class="reference external" href="https://github.com/d3/d3-force/blob/master/README.md#manyBody_distanceMin">minimum-distance parameter</a> and performance improvements thanks to 4.0’s <a class="reference external" href="#quadtrees-d3-quadtree">new quadtrees</a>. There are also brand-new forces for <a class="reference external" href="https://github.com/d3/d3-force/blob/master/README.md#forceCenter">centering nodes</a> and <a class="reference external" href="https://github.com/d3/d3-force/blob/master/README.md#forceCollision">collision resolution</a>.</p>
<p>The new forces and simulation have been carefully crafted to avoid nondeterminism. Rather than initializing nodes randomly, if the nodes do not have preset positions, they are placed in a phyllotaxis pattern:</p>
<img alt="Phyllotaxis" src="https://raw.githubusercontent.com/d3/d3-force/master/img/phyllotaxis.png" width="420" height="219">
<p>Random jitter is still needed to resolve link, collision and many-body forces if there are coincident nodes, but at least in the common case, the force simulation (and the resulting force-directed graph layout) is now consistent across browsers and reloads. D3 no longer plays dice!</p>
<p>The force simulation has several new methods for greater control over heating, such as <a class="reference external" href="https://github.com/d3/d3-force/blob/master/README.md#simulation_alphaMin"><em>simulation</em>.alphaMin</a> and <a class="reference external" href="https://github.com/d3/d3-force/blob/master/README.md#simulation_alphaDecay"><em>simulation</em>.alphaDecay</a>, and the internal timer. Calling <a class="reference external" href="https://github.com/d3/d3-force/blob/master/README.md#simulation_alpha"><em>simulation</em>.alpha</a> now has no effect on the internal timer, which is controlled independently via <a class="reference external" href="https://github.com/d3/d3-force/blob/master/README.md#simulation_stop"><em>simulation</em>.stop</a> and <a class="reference external" href="https://github.com/d3/d3-force/blob/master/README.md#simulation_restart"><em>simulation</em>.restart</a>. The force layout’s internal timer now starts automatically on creation, removing <em>force</em>.start. As in 3.x, you can advance the simulation manually using <a class="reference external" href="https://github.com/d3/d3-force/blob/master/README.md#simulation_tick"><em>simulation</em>.tick</a>. The <em>force</em>.friction parameter is replaced by <em>simulation</em>.velocityDecay. A new <a class="reference external" href="https://github.com/d3/d3-force/blob/master/README.md#simulation_alphaTarget"><em>simulation</em>.alphaTarget</a> method allows you to set the desired alpha (temperature) of the simulation, such that the simulation can be smoothly reheated during interaction, and then smoothly cooled again. This improves the stability of the graph during interaction.</p>
<p>The force layout no longer depends on the <a class="reference external" href="#dragging-d3-drag">drag behavior</a>, though you can certainly create <a class="reference external" href="https://bl.ocks.org/mbostock/ad70335eeef6d167bc36fd3c04378048">draggable force-directed graphs</a>! Set <em>node</em>.fx and <em>node</em>.fy to fix a node’s position. As an alternative to a <a class="reference external" href="#voronoi-d3-voronoi">Voronoi</a> SVG overlay, you can now use <a class="reference external" href="https://github.com/d3/d3-force/blob/master/README.md#simulation_find"><em>simulation</em>.find</a> to find the closest node to a pointer.</p>
</div>
<div class="section" id="number-formats-d3-format">
<h2><a class="reference external" href="https://github.com/d3/d3-format/blob/master/README.md">Number Formats (d3-format)</a><a class="headerlink" href="#number-formats-d3-format" title="Permalink to this headline">¶</a></h2>
<p>If a precision is not specified, the formatting behavior has changed: there is now a default precision of 6 for all directives except <em>none</em>, which defaults to 12. In 3.x, if you did not specify a precision, the number was formatted using its shortest unique representation (per <a class="reference external" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Number/toString"><em>number</em>.toString</a>); this could lead to unexpected digits due to <a class="reference external" href="http://0.30000000000000004.com/">floating point math</a>. The new default precision in 4.0 produces more consistent results:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">f</span> <span class="o">=</span> <span class="nx">d3</span><span class="p">.</span><span class="nx">format</span><span class="p">(</span><span class="s2">&quot;e&quot;</span><span class="p">);</span>
<span class="nx">f</span><span class="p">(</span><span class="mf">42</span><span class="p">);</span>        <span class="c1">// &quot;4.200000e+1&quot;</span>
<span class="nx">f</span><span class="p">(</span><span class="mf">0.1</span> <span class="o">+</span> <span class="mf">0.2</span><span class="p">);</span> <span class="c1">// &quot;3.000000e-1&quot;</span>
</pre></div>
</div>
<p>To trim insignificant trailing zeroes, use the <em>none</em> directive, which is similar <code class="docutils literal notranslate"><span class="pre">g</span></code>. For example:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">f</span> <span class="o">=</span> <span class="nx">d3</span><span class="p">.</span><span class="nx">format</span><span class="p">(</span><span class="s2">&quot;.3&quot;</span><span class="p">);</span>
<span class="nx">f</span><span class="p">(</span><span class="mf">0.12345</span><span class="p">);</span>   <span class="c1">// &quot;0.123&quot;</span>
<span class="nx">f</span><span class="p">(</span><span class="mf">0.10000</span><span class="p">);</span>   <span class="c1">// &quot;0.1&quot;</span>
<span class="nx">f</span><span class="p">(</span><span class="mf">0.1</span> <span class="o">+</span> <span class="mf">0.2</span><span class="p">);</span> <span class="c1">// &quot;0.3&quot;</span>
</pre></div>
</div>
<p>Under the hood, number formatting has improved accuracy with very large and very small numbers by using <a class="reference external" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Number/toExponential"><em>number</em>.toExponential</a> rather than <a class="reference external" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Math/log">Math.log</a> to extract the mantissa and exponent. Negative zero (-0, an IEEE 754 construct) and very small numbers that round to zero are now formatted as unsigned zero. The inherently unsafe d3.round method has been removed, along with d3.requote.</p>
<p>The <a class="reference external" href="https://github.com/d3/d3-format/blob/master/README.md#formatPrefix">d3.formatPrefix</a> method has been changed. Rather than returning an SI-prefix string, it returns an SI-prefix format function for a given <em>specifier</em> and reference <em>value</em>. For example, to format thousands:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">f</span> <span class="o">=</span> <span class="nx">d3</span><span class="p">.</span><span class="nx">formatPrefix</span><span class="p">(</span><span class="s2">&quot;,.0&quot;</span><span class="p">,</span> <span class="mf">1e3</span><span class="p">);</span>
<span class="nx">f</span><span class="p">(</span><span class="mf">1e3</span><span class="p">);</span> <span class="c1">// &quot;1k&quot;</span>
<span class="nx">f</span><span class="p">(</span><span class="mf">1e4</span><span class="p">);</span> <span class="c1">// &quot;10k&quot;</span>
<span class="nx">f</span><span class="p">(</span><span class="mf">1e5</span><span class="p">);</span> <span class="c1">// &quot;100k&quot;</span>
<span class="nx">f</span><span class="p">(</span><span class="mf">1e6</span><span class="p">);</span> <span class="c1">// &quot;1,000k&quot;</span>
</pre></div>
</div>
<p>Unlike the <code class="docutils literal notranslate"><span class="pre">s</span></code> format directive, d3.formatPrefix always employs the same SI-prefix, producing consistent results:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">f</span> <span class="o">=</span> <span class="nx">d3</span><span class="p">.</span><span class="nx">format</span><span class="p">(</span><span class="s2">&quot;.0s&quot;</span><span class="p">);</span>
<span class="nx">f</span><span class="p">(</span><span class="mf">1e3</span><span class="p">);</span> <span class="c1">// &quot;1k&quot;</span>
<span class="nx">f</span><span class="p">(</span><span class="mf">1e4</span><span class="p">);</span> <span class="c1">// &quot;10k&quot;</span>
<span class="nx">f</span><span class="p">(</span><span class="mf">1e5</span><span class="p">);</span> <span class="c1">// &quot;100k&quot;</span>
<span class="nx">f</span><span class="p">(</span><span class="mf">1e6</span><span class="p">);</span> <span class="c1">// &quot;1M&quot;</span>
</pre></div>
</div>
<p>The new <code class="docutils literal notranslate"><span class="pre">(</span></code> sign option uses parentheses for negative values. This is particularly useful in conjunction with <code class="docutils literal notranslate"><span class="pre">$</span></code>. For example:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="nx">d3</span><span class="p">.</span><span class="nx">format</span><span class="p">(</span><span class="s2">&quot;+.0f&quot;</span><span class="p">)(</span><span class="o">-</span><span class="mf">42</span><span class="p">);</span>  <span class="c1">// &quot;-42&quot;</span>
<span class="nx">d3</span><span class="p">.</span><span class="nx">format</span><span class="p">(</span><span class="s2">&quot;(.0f&quot;</span><span class="p">)(</span><span class="o">-</span><span class="mf">42</span><span class="p">);</span>  <span class="c1">// &quot;(42)&quot;</span>
<span class="nx">d3</span><span class="p">.</span><span class="nx">format</span><span class="p">(</span><span class="s2">&quot;+$.0f&quot;</span><span class="p">)(</span><span class="o">-</span><span class="mf">42</span><span class="p">);</span> <span class="c1">// &quot;-$42&quot;</span>
<span class="nx">d3</span><span class="p">.</span><span class="nx">format</span><span class="p">(</span><span class="s2">&quot;($.0f&quot;</span><span class="p">)(</span><span class="o">-</span><span class="mf">42</span><span class="p">);</span> <span class="c1">// &quot;($42)&quot;</span>
</pre></div>
</div>
<p>The new <code class="docutils literal notranslate"><span class="pre">=</span></code> align option places any sign and symbol to the left of any padding:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="nx">d3</span><span class="p">.</span><span class="nx">format</span><span class="p">(</span><span class="s2">&quot;&gt;6d&quot;</span><span class="p">)(</span><span class="o">-</span><span class="mf">42</span><span class="p">);</span>  <span class="c1">// &quot;   -42&quot;</span>
<span class="nx">d3</span><span class="p">.</span><span class="nx">format</span><span class="p">(</span><span class="s2">&quot;=6d&quot;</span><span class="p">)(</span><span class="o">-</span><span class="mf">42</span><span class="p">);</span>  <span class="c1">// &quot;-   42&quot;</span>
<span class="nx">d3</span><span class="p">.</span><span class="nx">format</span><span class="p">(</span><span class="s2">&quot;&gt;(6d&quot;</span><span class="p">)(</span><span class="o">-</span><span class="mf">42</span><span class="p">);</span> <span class="c1">// &quot;  (42)&quot;</span>
<span class="nx">d3</span><span class="p">.</span><span class="nx">format</span><span class="p">(</span><span class="s2">&quot;=(6d&quot;</span><span class="p">)(</span><span class="o">-</span><span class="mf">42</span><span class="p">);</span> <span class="c1">// &quot;(  42)&quot;</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">b</span></code>, <code class="docutils literal notranslate"><span class="pre">o</span></code>, <code class="docutils literal notranslate"><span class="pre">d</span></code> and <code class="docutils literal notranslate"><span class="pre">x</span></code> directives now round to the nearest integer, rather than returning the empty string for non-integers:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="nx">d3</span><span class="p">.</span><span class="nx">format</span><span class="p">(</span><span class="s2">&quot;b&quot;</span><span class="p">)(</span><span class="mf">41.9</span><span class="p">);</span> <span class="c1">// &quot;101010&quot;</span>
<span class="nx">d3</span><span class="p">.</span><span class="nx">format</span><span class="p">(</span><span class="s2">&quot;o&quot;</span><span class="p">)(</span><span class="mf">41.9</span><span class="p">);</span> <span class="c1">// &quot;52&quot;</span>
<span class="nx">d3</span><span class="p">.</span><span class="nx">format</span><span class="p">(</span><span class="s2">&quot;d&quot;</span><span class="p">)(</span><span class="mf">41.9</span><span class="p">);</span> <span class="c1">// &quot;42&quot;</span>
<span class="nx">d3</span><span class="p">.</span><span class="nx">format</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">)(</span><span class="mf">41.9</span><span class="p">);</span> <span class="c1">// &quot;2a&quot;</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">c</span></code> directive is now for character data (<em>i.e.</em>, literal strings), not for character codes. The is useful if you just want to apply padding and alignment and don’t care about formatting numbers. For example, the infamous <a class="reference external" href="http://blog.npmjs.org/post/141577284765/kik-left-pad-and-npm">left-pad</a> (as well as center- and right-pad!) can be conveniently implemented as:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="nx">d3</span><span class="p">.</span><span class="nx">format</span><span class="p">(</span><span class="s2">&quot;&gt;10c&quot;</span><span class="p">)(</span><span class="s2">&quot;foo&quot;</span><span class="p">);</span> <span class="c1">// &quot;       foo&quot;</span>
<span class="nx">d3</span><span class="p">.</span><span class="nx">format</span><span class="p">(</span><span class="s2">&quot;^10c&quot;</span><span class="p">)(</span><span class="s2">&quot;foo&quot;</span><span class="p">);</span> <span class="c1">// &quot;   foo    &quot;</span>
<span class="nx">d3</span><span class="p">.</span><span class="nx">format</span><span class="p">(</span><span class="s2">&quot;&lt;10c&quot;</span><span class="p">)(</span><span class="s2">&quot;foo&quot;</span><span class="p">);</span> <span class="c1">// &quot;foo       &quot;</span>
</pre></div>
</div>
<p>There are several new methods for computing suggested decimal precisions; these are used by <a class="reference external" href="#scales-d3-scale">d3-scale</a> for tick formatting, and are helpful for implementing custom number formats: <a class="reference external" href="https://github.com/d3/d3-format/blob/master/README.md#precisionFixed">d3.precisionFixed</a>, <a class="reference external" href="https://github.com/d3/d3-format/blob/master/README.md#precisionPrefix">d3.precisionPrefix</a> and <a class="reference external" href="https://github.com/d3/d3-format/blob/master/README.md#precisionRound">d3.precisionRound</a>. There’s also a new <a class="reference external" href="https://github.com/d3/d3-format/blob/master/README.md#formatSpecifier">d3.formatSpecifier</a> method for parsing, validating and debugging format specifiers; it’s also good for deriving related format specifiers, such as when you want to substitute the precision automatically.</p>
<p>You can now set the default locale using <a class="reference external" href="https://github.com/d3/d3-format/blob/master/README.md#formatDefaultLocale">d3.formatDefaultLocale</a>! The locales are published as <a class="reference external" href="https://github.com/d3/d3-request/blob/master/README.md#json">JSON</a> to <a class="reference external" href="https://unpkg.com/d3-format/locale/">npm</a>.</p>
</div>
<div class="section" id="geographies-d3-geo">
<h2><a class="reference external" href="https://github.com/d3/d3-geo/blob/master/README.md">Geographies (d3-geo)</a><a class="headerlink" href="#geographies-d3-geo" title="Permalink to this headline">¶</a></h2>
<p>Pursuant to the great namespace flattening, various methods have new names:</p>
<ul class="simple">
<li><p>d3.geo.graticule ↦ <a class="reference external" href="https://github.com/d3/d3-geo/blob/master/README.md#geoGraticule">d3.geoGraticule</a></p></li>
<li><p>d3.geo.circle ↦ <a class="reference external" href="https://github.com/d3/d3-geo/blob/master/README.md#geoCircle">d3.geoCircle</a></p></li>
<li><p>d3.geo.area ↦ <a class="reference external" href="https://github.com/d3/d3-geo/blob/master/README.md#geoArea">d3.geoArea</a></p></li>
<li><p>d3.geo.bounds ↦ <a class="reference external" href="https://github.com/d3/d3-geo/blob/master/README.md#geoBounds">d3.geoBounds</a></p></li>
<li><p>d3.geo.centroid ↦ <a class="reference external" href="https://github.com/d3/d3-geo/blob/master/README.md#geoCentroid">d3.geoCentroid</a></p></li>
<li><p>d3.geo.distance ↦ <a class="reference external" href="https://github.com/d3/d3-geo/blob/master/README.md#geoDistance">d3.geoDistance</a></p></li>
<li><p>d3.geo.interpolate ↦ <a class="reference external" href="https://github.com/d3/d3-geo/blob/master/README.md#geoInterpolate">d3.geoInterpolate</a></p></li>
<li><p>d3.geo.length ↦ <a class="reference external" href="https://github.com/d3/d3-geo/blob/master/README.md#geoLength">d3.geoLength</a></p></li>
<li><p>d3.geo.rotation ↦ <a class="reference external" href="https://github.com/d3/d3-geo/blob/master/README.md#geoRotation">d3.geoRotation</a></p></li>
<li><p>d3.geo.stream ↦ <a class="reference external" href="https://github.com/d3/d3-geo/blob/master/README.md#geoStream">d3.geoStream</a></p></li>
<li><p>d3.geo.path ↦ <a class="reference external" href="https://github.com/d3/d3-geo/blob/master/README.md#geoPath">d3.geoPath</a></p></li>
<li><p>d3.geo.projection ↦ <a class="reference external" href="https://github.com/d3/d3-geo/blob/master/README.md#geoProjection">d3.geoProjection</a></p></li>
<li><p>d3.geo.projectionMutator ↦ <a class="reference external" href="https://github.com/d3/d3-geo/blob/master/README.md#geoProjectionMutator">d3.geoProjectionMutator</a></p></li>
<li><p>d3.geo.albers ↦ <a class="reference external" href="https://github.com/d3/d3-geo/blob/master/README.md#geoAlbers">d3.geoAlbers</a></p></li>
<li><p>d3.geo.albersUsa ↦ <a class="reference external" href="https://github.com/d3/d3-geo/blob/master/README.md#geoAlbersUsa">d3.geoAlbersUsa</a></p></li>
<li><p>d3.geo.azimuthalEqualArea ↦ <a class="reference external" href="https://github.com/d3/d3-geo/blob/master/README.md#geoAzimuthalEqualArea">d3.geoAzimuthalEqualArea</a></p></li>
<li><p>d3.geo.azimuthalEquidistant ↦ <a class="reference external" href="https://github.com/d3/d3-geo/blob/master/README.md#geoAzimuthalEquidistant">d3.geoAzimuthalEquidistant</a></p></li>
<li><p>d3.geo.conicConformal ↦ <a class="reference external" href="https://github.com/d3/d3-geo/blob/master/README.md#geoConicConformal">d3.geoConicConformal</a></p></li>
<li><p>d3.geo.conicEqualArea ↦ <a class="reference external" href="https://github.com/d3/d3-geo/blob/master/README.md#geoConicEqualArea">d3.geoConicEqualArea</a></p></li>
<li><p>d3.geo.conicEquidistant ↦ <a class="reference external" href="https://github.com/d3/d3-geo/blob/master/README.md#geoConicEquidistant">d3.geoConicEquidistant</a></p></li>
<li><p>d3.geo.equirectangular ↦ <a class="reference external" href="https://github.com/d3/d3-geo/blob/master/README.md#geoEquirectangular">d3.geoEquirectangular</a></p></li>
<li><p>d3.geo.gnomonic ↦ <a class="reference external" href="https://github.com/d3/d3-geo/blob/master/README.md#geoGnomonic">d3.geoGnomonic</a></p></li>
<li><p>d3.geo.mercator ↦ <a class="reference external" href="https://github.com/d3/d3-geo/blob/master/README.md#geoMercator">d3.geoMercator</a></p></li>
<li><p>d3.geo.orthographic ↦ <a class="reference external" href="https://github.com/d3/d3-geo/blob/master/README.md#geoOrthographic">d3.geoOrthographic</a></p></li>
<li><p>d3.geo.stereographic ↦ <a class="reference external" href="https://github.com/d3/d3-geo/blob/master/README.md#geoStereographic">d3.geoStereographic</a></p></li>
<li><p>d3.geo.transverseMercator ↦ <a class="reference external" href="https://github.com/d3/d3-geo/blob/master/README.md#geoTransverseMercator">d3.geoTransverseMercator</a></p></li>
</ul>
<p>Also renamed for consistency:</p>
<ul class="simple">
<li><p><em>circle</em>.origin ↦ <a class="reference external" href="https://github.com/d3/d3-geo/blob/master/README.md#circle_center"><em>circle</em>.center</a></p></li>
<li><p><em>circle</em>.angle ↦ <a class="reference external" href="https://github.com/d3/d3-geo/blob/master/README.md#circle_radius"><em>circle</em>.radius</a></p></li>
<li><p><em>graticule</em>.majorExtent ↦ <a class="reference external" href="https://github.com/d3/d3-geo/blob/master/README.md#graticule_extentMajor"><em>graticule</em>.extentMajor</a></p></li>
<li><p><em>graticule</em>.minorExtent ↦ <a class="reference external" href="https://github.com/d3/d3-geo/blob/master/README.md#graticule_extentMinor"><em>graticule</em>.extentMinor</a></p></li>
<li><p><em>graticule</em>.majorStep ↦ <a class="reference external" href="https://github.com/d3/d3-geo/blob/master/README.md#graticule_stepMajor"><em>graticule</em>.stepMajor</a></p></li>
<li><p><em>graticule</em>.minorStep ↦ <a class="reference external" href="https://github.com/d3/d3-geo/blob/master/README.md#graticule_stepMinor"><em>graticule</em>.stepMinor</a></p></li>
</ul>
<p>Projections now have more appropriate defaults. For example, <a class="reference external" href="https://github.com/d3/d3-geo/blob/master/README.md#geoOrthographic">d3.geoOrthographic</a> has a 90° clip angle by default, showing only the front hemisphere, and <a class="reference external" href="https://github.com/d3/d3-geo/blob/master/README.md#geoGnomonic">d3.geoGnomonic</a> has a default 60° clip angle. The default <a class="reference external" href="https://github.com/d3/d3-geo/blob/master/README.md#path_projection">projection</a> for <a class="reference external" href="https://github.com/d3/d3-geo/blob/master/README.md#geoPath">d3.geoPath</a> is now null rather than <a class="reference external" href="https://github.com/d3/d3-geo/blob/master/README.md#geoAlbersUsa">d3.geoAlbersUsa</a>; a null projection is used with <a class="reference external" href="https://bl.ocks.org/mbostock/5557726">pre-projected geometry</a> and is typically faster to render.</p>
<p>“Fallback projections”—when you pass a function rather than a projection to <a class="reference external" href="https://github.com/d3/d3-geo/blob/master/README.md#path_projection"><em>path</em>.projection</a>—are no longer supported. For geographic projections, use <a class="reference external" href="https://github.com/d3/d3-geo/blob/master/README.md#geoProjection">d3.geoProjection</a> or <a class="reference external" href="https://github.com/d3/d3-geo/blob/master/README.md#geoProjectionMutator">d3.geoProjectionMutator</a> to define a custom projection. For arbitrary geometry transformations, implement the <a class="reference external" href="https://github.com/d3/d3-geo/blob/master/README.md#streams">stream interface</a>; see also <a class="reference external" href="https://github.com/d3/d3-geo/blob/master/README.md#geoTransform">d3.geoTransform</a>. The “raw” projections (e.g., d3.geo.equirectangular.raw) are no longer exported.</p>
</div>
<div class="section" id="hierarchies-d3-hierarchy">
<h2><a class="reference external" href="https://github.com/d3/d3-hierarchy/blob/master/README.md">Hierarchies (d3-hierarchy)</a><a class="headerlink" href="#hierarchies-d3-hierarchy" title="Permalink to this headline">¶</a></h2>
<p>Pursuant to the great namespace flattening:</p>
<ul class="simple">
<li><p>d3.layout.cluster ↦ <a class="reference external" href="https://github.com/d3/d3-hierarchy/blob/master/README.md#cluster">d3.cluster</a></p></li>
<li><p>d3.layout.hierarchy ↦ <a class="reference external" href="https://github.com/d3/d3-hierarchy/blob/master/README.md#hierarchy">d3.hierarchy</a></p></li>
<li><p>d3.layout.pack ↦ <a class="reference external" href="https://github.com/d3/d3-hierarchy/blob/master/README.md#pack">d3.pack</a></p></li>
<li><p>d3.layout.partition ↦ <a class="reference external" href="https://github.com/d3/d3-hierarchy/blob/master/README.md#partition">d3.partition</a></p></li>
<li><p>d3.layout.tree ↦ <a class="reference external" href="https://github.com/d3/d3-hierarchy/blob/master/README.md#tree">d3.tree</a></p></li>
<li><p>d3.layout.treemap ↦ <a class="reference external" href="https://github.com/d3/d3-hierarchy/blob/master/README.md#treemap">d3.treemap</a></p></li>
</ul>
<p>As an alternative to using JSON to represent hierarchical data (such as the “flare.json format” used by many D3 examples), the new <a class="reference external" href="https://github.com/d3/d3-hierarchy/blob/master/README.md#stratify">d3.stratify</a> operator simplifies the conversion of tabular data to hierarchical data! This is convenient if you already have data in a tabular format, such as the result of a SQL query or a CSV file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">name</span><span class="p">,</span><span class="n">parent</span>
<span class="n">Eve</span><span class="p">,</span>
<span class="n">Cain</span><span class="p">,</span><span class="n">Eve</span>
<span class="n">Seth</span><span class="p">,</span><span class="n">Eve</span>
<span class="n">Enos</span><span class="p">,</span><span class="n">Seth</span>
<span class="n">Noam</span><span class="p">,</span><span class="n">Seth</span>
<span class="n">Abel</span><span class="p">,</span><span class="n">Eve</span>
<span class="n">Awan</span><span class="p">,</span><span class="n">Eve</span>
<span class="n">Enoch</span><span class="p">,</span><span class="n">Awan</span>
<span class="n">Azura</span><span class="p">,</span><span class="n">Eve</span>
</pre></div>
</div>
<p>To convert this to a root <a class="reference external" href="https://github.com/d3/d3-hierarchy/blob/master/README.md#hierarchy"><em>node</em></a>:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">root</span> <span class="o">=</span> <span class="nx">d3</span><span class="p">.</span><span class="nx">stratify</span><span class="p">()</span>
    <span class="p">.</span><span class="nx">id</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">d</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">d</span><span class="p">.</span><span class="nx">name</span><span class="p">;</span> <span class="p">})</span>
    <span class="p">.</span><span class="nx">parentId</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">d</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">d</span><span class="p">.</span><span class="nx">parent</span><span class="p">;</span> <span class="p">})</span>
    <span class="p">(</span><span class="nx">nodes</span><span class="p">);</span>
</pre></div>
</div>
<p>The resulting <em>root</em> can be passed to <a class="reference external" href="https://github.com/d3/d3-hierarchy/blob/master/README.md#tree">d3.tree</a> to produce a tree diagram like this:</p>
<img src="https://raw.githubusercontent.com/d3/d3/master/img/stratify.png" width="298" height="137">
<p>Root nodes can also be created from JSON data using <a class="reference external" href="https://github.com/d3/d3-hierarchy/blob/master/README.md#hierarchy">d3.hierarchy</a>. The hierarchy layouts now take these root nodes as input rather than operating directly on JSON data, which helps to provide a cleaner separation between the input data and the computed layout. (For example, use <a class="reference external" href="https://github.com/d3/d3-hierarchy/blob/master/README.md#node_copy"><em>node</em>.copy</a> to isolate layout changes.) It also simplifies the API: rather than each hierarchy layout needing to implement value and sorting accessors, there are now generic <a class="reference external" href="https://github.com/d3/d3-hierarchy/blob/master/README.md#node_sum"><em>node</em>.sum</a> and <a class="reference external" href="https://github.com/d3/d3-hierarchy/blob/master/README.md#node_sort"><em>node</em>.sort</a> methods that work with any hierarchy layout.</p>
<p>The new d3.hierarchy API also provides a richer set of methods for manipulating hierarchical data. For example, to generate an array of all nodes in topological order, use <a class="reference external" href="https://github.com/d3/d3-hierarchy/blob/master/README.md#node_descendants"><em>node</em>.descendants</a>; for just leaf nodes, use <a class="reference external" href="https://github.com/d3/d3-hierarchy/blob/master/README.md#node_leaves"><em>node</em>.leaves</a>. To highlight the ancestors of a given <em>node</em> on mouseover, use <a class="reference external" href="https://github.com/d3/d3-hierarchy/blob/master/README.md#node_ancestors"><em>node</em>.ancestors</a>. To generate an array of {source, target} links for a given hierarchy, use <a class="reference external" href="https://github.com/d3/d3-hierarchy/blob/master/README.md#node_links"><em>node</em>.links</a>; this replaces <em>treemap</em>.links and similar methods on the other layouts. The new <a class="reference external" href="https://github.com/d3/d3-hierarchy/blob/master/README.md#node_path"><em>node</em>.path</a> method replaces d3.layout.bundle; see also <a class="reference external" href="https://github.com/d3/d3-shape/blob/master/README.md#curveBundle">d3.curveBundle</a> for hierarchical edge bundling.</p>
<p>The hierarchy layouts have been rewritten using new, non-recursive traversal methods (<a class="reference external" href="https://github.com/d3/d3-hierarchy/blob/master/README.md#node_each"><em>node</em>.each</a>, <a class="reference external" href="https://github.com/d3/d3-hierarchy/blob/master/README.md#node_eachAfter"><em>node</em>.eachAfter</a> and <a class="reference external" href="https://github.com/d3/d3-hierarchy/blob/master/README.md#node_eachBefore"><em>node</em>.eachBefore</a>), improving performance on large datasets. The d3.tree layout no longer uses a <em>node</em>._ field to store temporary state during layout.</p>
<p>Treemap tiling is now <a class="reference external" href="https://github.com/d3/d3-hierarchy/blob/master/README.md#treemap-tiling">extensible</a> via <a class="reference external" href="https://github.com/d3/d3-hierarchy/blob/master/README.md#treemap_tile"><em>treemap</em>.tile</a>! The default squarified tiling algorithm, <a class="reference external" href="https://github.com/d3/d3-hierarchy/blob/master/README.md#treemapSquarify">d3.treemapSquarify</a>, has been completely rewritten, improving performance and fixing bugs in padding and rounding. The <em>treemap</em>.sticky method has been replaced with the <a class="reference external" href="https://github.com/d3/d3-hierarchy/blob/master/README.md#treemapResquarify">d3.treemapResquarify</a>, which is identical to d3.treemapSquarify except it performs stable neighbor-preserving updates. The <em>treemap</em>.ratio method has been replaced with <a class="reference external" href="https://github.com/d3/d3-hierarchy/blob/master/README.md#squarify_ratio"><em>squarify</em>.ratio</a>. And there’s a new <a class="reference external" href="https://github.com/d3/d3-hierarchy/blob/master/README.md#treemapBinary">d3.treemapBinary</a> for binary treemaps!</p>
<p>Treemap padding has also been improved. The treemap now distinguishes between <a class="reference external" href="https://github.com/d3/d3-hierarchy/blob/master/README.md#treemap_paddingOuter">outer padding</a> that separates a parent from its children, and <a class="reference external" href="https://github.com/d3/d3-hierarchy/blob/master/README.md#treemap_paddingInner">inner padding</a> that separates adjacent siblings. You can set the <a class="reference external" href="https://github.com/d3/d3-hierarchy/blob/master/README.md#treemap_paddingTop">top-</a>, <a class="reference external" href="https://github.com/d3/d3-hierarchy/blob/master/README.md#treemap_paddingRight">right-</a>, <a class="reference external" href="https://github.com/d3/d3-hierarchy/blob/master/README.md#treemap_paddingBottom">bottom-</a> and <a class="reference external" href="https://github.com/d3/d3-hierarchy/blob/master/README.md#treemap_paddingLeft">left-</a>outer padding separately. There are new examples for the traditional <a class="reference external" href="https://bl.ocks.org/mbostock/911ad09bdead40ec0061">nested treemap</a> and for Lü and Fogarty’s <a class="reference external" href="https://bl.ocks.org/mbostock/f85ffb3a5ac518598043">cascaded treemap</a>. And there’s a new example demonstrating <a class="reference external" href="https://bl.ocks.org/mbostock/2838bf53e0e65f369f476afd653663a2">d3.nest with d3.treemap</a>.</p>
<p>The space-filling layouts <a class="reference external" href="https://github.com/d3/d3-hierarchy/blob/master/README.md#treemap">d3.treemap</a> and <a class="reference external" href="https://github.com/d3/d3-hierarchy/blob/master/README.md#partition">d3.partition</a> now output <em>x0</em>, <em>x1</em>, <em>y0</em>, <em>y1</em> on each node instead of <em>x0</em>, <em>dx</em>, <em>y0</em>, <em>dy</em>. This improves accuracy by ensuring that the edges of adjacent cells are exactly equal, rather than sometimes being slightly off due to floating point math. The partition layout now supports <a class="reference external" href="https://github.com/d3/d3-hierarchy/blob/master/README.md#partition_round">rounding</a> and <a class="reference external" href="https://github.com/d3/d3-hierarchy/blob/master/README.md#partition_padding">padding</a>.</p>
<p>The circle-packing layout, <a class="reference external" href="https://github.com/d3/d3-hierarchy/blob/master/README.md#pack">d3.pack</a>, has been completely rewritten to better implement Wang et al.’s algorithm, fixing major bugs and improving results! Welzl’s algorithm is now used to compute the exact <a class="reference external" href="https://bl.ocks.org/mbostock/29c534ff0b270054a01c">smallest enclosing circle</a> for each parent, rather than the approximate answer used by Wang et al. The 3.x output is shown on the left; 4.0 is shown on the right:</p>
<p><img alt="Circle Packing in 3.x" src="https://raw.githubusercontent.com/d3/d3/master/img/pack-v3.png" width="420" height="420"> <img alt="Circle Packing in 4.0" src="https://raw.githubusercontent.com/d3/d3/master/img/pack-v4.png" width="420" height="420"></p>
<p>A non-hierarchical implementation is also available as <a class="reference external" href="https://github.com/d3/d3-hierarchy/blob/master/README.md#packSiblings">d3.packSiblings</a>, and the smallest enclosing circle implementation is available as <a class="reference external" href="https://github.com/d3/d3-hierarchy/blob/master/README.md#packEnclose">d3.packEnclose</a>. <a class="reference external" href="https://github.com/d3/d3-hierarchy/blob/master/README.md#pack_padding">Pack padding</a> now applies between a parent and its children, as well as between adjacent siblings. In addition, you can now specify padding as a function that is computed dynamically for each parent.</p>
</div>
<div class="section" id="internals">
<h2>Internals<a class="headerlink" href="#internals" title="Permalink to this headline">¶</a></h2>
<p>The d3.rebind method has been removed. (See the <a class="reference external" href="https://github.com/d3/d3/blob/v3.5.17/src/core/rebind.js">3.x source</a>.) If you want to wrap a getter-setter method, the recommend pattern is to implement a wrapper method and check the return value. For example, given a <em>component</em> that uses an internal <a class="reference external" href="#dispatches-d3-dispatch"><em>dispatch</em></a>, <em>component</em>.on can rebind <em>dispatch</em>.on as follows:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="nx">component</span><span class="p">.</span><span class="nx">on</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">value</span> <span class="o">=</span> <span class="nx">dispatch</span><span class="p">.</span><span class="nx">on</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">dispatch</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">);</span>
  <span class="k">return</span> <span class="nx">value</span> <span class="o">===</span> <span class="nx">dispatch</span> <span class="o">?</span> <span class="nx">component</span> <span class="o">:</span> <span class="nx">value</span><span class="p">;</span>
<span class="p">};</span>
</pre></div>
</div>
<p>The d3.functor method has been removed. (See the <a class="reference external" href="https://github.com/d3/d3/blob/v3.5.17/src/core/functor.js">3.x source</a>.) If you want to promote a constant value to a function, the recommended pattern is to implement a closure that returns the constant value. If desired, you can use a helper method as follows:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="kd">function</span> <span class="nx">constant</span><span class="p">(</span><span class="nx">x</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">x</span><span class="p">;</span>
  <span class="p">};</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Given a value <em>x</em>, to promote <em>x</em> to a function if it is not already:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">fx</span> <span class="o">=</span> <span class="k">typeof</span> <span class="nx">x</span> <span class="o">===</span> <span class="s2">&quot;function&quot;</span> <span class="o">?</span> <span class="nx">x</span> <span class="o">:</span> <span class="nx">constant</span><span class="p">(</span><span class="nx">x</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="interpolators-d3-interpolate">
<h2><a class="reference external" href="https://github.com/d3/d3-interpolate/blob/master/README.md">Interpolators (d3-interpolate)</a><a class="headerlink" href="#interpolators-d3-interpolate" title="Permalink to this headline">¶</a></h2>
<p>The <a class="reference external" href="https://github.com/d3/d3-interpolate/blob/master/README.md#interpolate">d3.interpolate</a> method no longer delegates to d3.interpolators, which has been removed; its behavior is now defined by the library. It is now slightly faster in the common case that <em>b</em> is a number. It only uses <a class="reference external" href="https://github.com/d3/d3-interpolate/blob/master/README.md#interpolateRgb">d3.interpolateRgb</a> if <em>b</em> is a valid CSS color specifier (and not approximately one). And if the end value <em>b</em> is null, undefined, true or false, d3.interpolate now returns a constant function which always returns <em>b</em>.</p>
<p>The behavior of <a class="reference external" href="https://github.com/d3/d3-interpolate/blob/master/README.md#interpolateObject">d3.interpolateObject</a> and <a class="reference external" href="https://github.com/d3/d3-interpolate/blob/master/README.md#interpolateArray">d3.interpolateArray</a> has changed slightly with respect to properties or elements in the start value <em>a</em> that do not exist in the end value <em>b</em>: these properties and elements are now ignored, such that the ending value of the interpolator at <em>t</em> = 1 is now precisely equal to <em>b</em>. So, in 3.x:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="nx">d3</span><span class="p">.</span><span class="nx">interpolateObject</span><span class="p">({</span><span class="nx">foo</span><span class="o">:</span> <span class="mf">2</span><span class="p">,</span> <span class="nx">bar</span><span class="o">:</span> <span class="mf">1</span><span class="p">},</span> <span class="p">{</span><span class="nx">foo</span><span class="o">:</span> <span class="mf">3</span><span class="p">})(</span><span class="mf">0.5</span><span class="p">);</span> <span class="c1">// {bar: 1, foo: 2.5} in 3.x</span>
</pre></div>
</div>
<p>Whereas in 4.0, <em>a</em>.bar is ignored:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="nx">d3</span><span class="p">.</span><span class="nx">interpolateObject</span><span class="p">({</span><span class="nx">foo</span><span class="o">:</span> <span class="mf">2</span><span class="p">,</span> <span class="nx">bar</span><span class="o">:</span> <span class="mf">1</span><span class="p">},</span> <span class="p">{</span><span class="nx">foo</span><span class="o">:</span> <span class="mf">3</span><span class="p">})(</span><span class="mf">0.5</span><span class="p">);</span> <span class="c1">// {foo: 2.5} in 4.0</span>
</pre></div>
</div>
<p>If <em>a</em> or <em>b</em> are undefined or not an object, they are now implicitly converted to the empty object or empty array as appropriate, rather than throwing a TypeError.</p>
<p>The d3.interpolateTransform interpolator has been renamed to <a class="reference external" href="https://github.com/d3/d3-interpolate/blob/master/README.md#interpolateTransformSvg">d3.interpolateTransformSvg</a>, and there is a new <a class="reference external" href="https://github.com/d3/d3-interpolate/blob/master/README.md#interpolateTransformCss">d3.interpolateTransformCss</a> to interpolate CSS transforms! This allows <a class="reference external" href="#transitions-d3-transition">d3-transition</a> to automatically interpolate both the SVG <a class="reference external" href="https://www.w3.org/TR/SVG/coords.html#TransformAttribute">transform attribute</a> and the CSS <a class="reference external" href="https://www.w3.org/TR/css-transforms-1/#transform-property">transform style property</a>. (Note, however, that only 2D CSS transforms are supported.) The d3.transform method has been removed.</p>
<p>Color space interpolators now interpolate opacity (see <a class="reference external" href="#colors-d3-color">d3-color</a>) and return rgb(…) or rgba(…) CSS color specifier strings rather than using the RGB hexadecimal format. This is necessary to support opacity interpolation, but is also beneficial because it matches CSS computed values. When a channel in the start color <em>a</em> is undefined, color interpolators now use the corresponding channel value from the end color <em>b</em>, or <em>vice versa</em>. This logic previously applied to some channels (such as saturation in HSL), but now applies to all channels in all color spaces, and is especially useful when interpolating to or from transparent.</p>
<p>There are now “long” versions of cylindrical color space interpolators: <a class="reference external" href="https://github.com/d3/d3-interpolate/blob/master/README.md#interpolateHslLong">d3.interpolateHslLong</a>, <a class="reference external" href="https://github.com/d3/d3-interpolate/blob/master/README.md#interpolateHclLong">d3.interpolateHclLong</a> and <a class="reference external" href="https://github.com/d3/d3-interpolate/blob/master/README.md#interpolateCubehelixLong">d3.interpolateCubehelixLong</a>. These interpolators use linear interpolation of hue, rather than using the shortest path around the 360° hue circle. See <a class="reference external" href="https://github.com/d3/d3-scale/blob/master/README.md#interpolateRainbow">d3.interpolateRainbow</a> for an example. The Cubehelix color space is now supported by <a class="reference external" href="#colors-d3-color">d3-color</a>, and so there are now <a class="reference external" href="https://github.com/d3/d3-interpolate/blob/master/README.md#interpolateCubehelix">d3.interpolateCubehelix</a> and <a class="reference external" href="https://github.com/d3/d3-interpolate/blob/master/README.md#interpolateCubehelixLong">d3.interpolateCubehelixLong</a> interpolators.</p>
<p><a class="reference external" href="https://web.archive.org/web/20160112115812/http://www.4p8.com/eric.brasseur/gamma.html">Gamma-corrected color interpolation</a> is now supported for both RGB and Cubehelix color spaces as <a class="reference external" href="https://github.com/d3/d3-interpolate/blob/master/README.md#interpolate_gamma"><em>interpolate</em>.gamma</a>. For example, to interpolate from purple to orange with a gamma of 2.2 in RGB space:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">interpolate</span> <span class="o">=</span> <span class="nx">d3</span><span class="p">.</span><span class="nx">interpolateRgb</span><span class="p">.</span><span class="nx">gamma</span><span class="p">(</span><span class="mf">2.2</span><span class="p">)(</span><span class="s2">&quot;purple&quot;</span><span class="p">,</span> <span class="s2">&quot;orange&quot;</span><span class="p">);</span>
</pre></div>
</div>
<p>There are new interpolators for uniform non-rational <a class="reference external" href="https://en.wikipedia.org/wiki/B-spline">B-splines</a>! These are useful for smoothly interpolating between an arbitrary sequence of values from <em>t</em> = 0 to <em>t</em> = 1, such as to generate a smooth color gradient from a discrete set of colors. The <a class="reference external" href="https://github.com/d3/d3-interpolate/blob/master/README.md#interpolateBasis">d3.interpolateBasis</a> and <a class="reference external" href="https://github.com/d3/d3-interpolate/blob/master/README.md#interpolateBasisClosed">d3.interpolateBasisClosed</a> interpolators generate one-dimensional B-splines, while <a class="reference external" href="https://github.com/d3/d3-interpolate/blob/master/README.md#interpolateRgbBasis">d3.interpolateRgbBasis</a> and <a class="reference external" href="https://github.com/d3/d3-interpolate/blob/master/README.md#interpolateRgbBasisClosed">d3.interpolateRgbBasisClosed</a> generate three-dimensional B-splines through RGB color space. These are used by <a class="reference external" href="https://github.com/d3/d3-scale-chromatic">d3-scale-chromatic</a> to generate continuous color scales from ColorBrewer’s discrete color schemes, such as <a class="reference external" href="https://bl.ocks.org/mbostock/048d21cf747371b11884f75ad896e5a5">PiYG</a>.</p>
<p>There’s also now a <a class="reference external" href="https://github.com/d3/d3-interpolate/blob/master/README.md#quantize">d3.quantize</a> method for generating uniformly-spaced discrete samples from a continuous interpolator. This is useful for taking one of the built-in color scales (such as <a class="reference external" href="https://github.com/d3/d3-scale/blob/master/README.md#interpolateViridis">d3.interpolateViridis</a>) and quantizing it for use with <a class="reference external" href="https://github.com/d3/d3-scale/blob/master/README.md#scaleQuantize">d3.scaleQuantize</a>, <a class="reference external" href="https://github.com/d3/d3-scale/blob/master/README.md#scaleQuantile">d3.scaleQuantile</a> or <a class="reference external" href="https://github.com/d3/d3-scale/blob/master/README.md#scaleThreshold">d3.scaleThreshold</a>.</p>
</div>
<div class="section" id="paths-d3-path">
<h2><a class="reference external" href="https://github.com/d3/d3-path/blob/master/README.md">Paths (d3-path)</a><a class="headerlink" href="#paths-d3-path" title="Permalink to this headline">¶</a></h2>
<p>The <a class="reference external" href="https://github.com/d3/d3-path/blob/master/README.md#path">d3.path</a> serializer implements the <a class="reference external" href="https://www.w3.org/TR/2dcontext/#canvaspathmethods">CanvasPathMethods API</a>, allowing you to write code that can render to either Canvas or SVG. For example, given some code that draws to a canvas:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="kd">function</span> <span class="nx">drawCircle</span><span class="p">(</span><span class="nx">context</span><span class="p">,</span> <span class="nx">radius</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">context</span><span class="p">.</span><span class="nx">moveTo</span><span class="p">(</span><span class="nx">radius</span><span class="p">,</span> <span class="mf">0</span><span class="p">);</span>
  <span class="nx">context</span><span class="p">.</span><span class="nx">arc</span><span class="p">(</span><span class="mf">0</span><span class="p">,</span> <span class="mf">0</span><span class="p">,</span> <span class="nx">radius</span><span class="p">,</span> <span class="mf">0</span><span class="p">,</span> <span class="mf">2</span> <span class="o">*</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">PI</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>You can render to SVG as follows:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">context</span> <span class="o">=</span> <span class="nx">d3</span><span class="p">.</span><span class="nx">path</span><span class="p">();</span>
<span class="nx">drawCircle</span><span class="p">(</span><span class="nx">context</span><span class="p">,</span> <span class="mf">40</span><span class="p">);</span>
<span class="nx">pathElement</span><span class="p">.</span><span class="nx">setAttribute</span><span class="p">(</span><span class="s2">&quot;d&quot;</span><span class="p">,</span> <span class="nx">context</span><span class="p">.</span><span class="nx">toString</span><span class="p">());</span>
</pre></div>
</div>
<p>The path serializer enables <a class="reference external" href="#shapes-d3-shape">d3-shape</a> to support both Canvas and SVG; see <a class="reference external" href="https://github.com/d3/d3-shape/blob/master/README.md#line_context"><em>line</em>.context</a> and <a class="reference external" href="https://github.com/d3/d3-shape/blob/master/README.md#area_context"><em>area</em>.context</a>, for example.</p>
</div>
<div class="section" id="polygons-d3-polygon">
<h2><a class="reference external" href="https://github.com/d3/d3-polygon/blob/master/README.md">Polygons (d3-polygon)</a><a class="headerlink" href="#polygons-d3-polygon" title="Permalink to this headline">¶</a></h2>
<p>There’s no longer a d3.geom.polygon constructor; instead you just pass an array of vertices to the polygon methods. So instead of <em>polygon</em>.area and <em>polygon</em>.centroid, there’s <a class="reference external" href="https://github.com/d3/d3-polygon/blob/master/README.md#polygonArea">d3.polygonArea</a> and <a class="reference external" href="https://github.com/d3/d3-polygon/blob/master/README.md#polygonCentroid">d3.polygonCentroid</a>. There are also new <a class="reference external" href="https://github.com/d3/d3-polygon/blob/master/README.md#polygonContains">d3.polygonContains</a> and <a class="reference external" href="https://github.com/d3/d3-polygon/blob/master/README.md#polygonLength">d3.polygonLength</a> methods. There’s no longer an equivalent to <em>polygon</em>.clip, but if <a class="reference external" href="https://en.wikipedia.org/wiki/Sutherland%E2%80%93Hodgman_algorithm">Sutherland–Hodgman clipping</a> is needed, please <a class="reference external" href="https://github.com/d3/d3-polygon/issues">file a feature request</a>.</p>
<p>The d3.geom.hull operator has been simplified: instead of an operator with <em>hull</em>.x and <em>hull</em>.y accessors, there’s just the <a class="reference external" href="https://github.com/d3/d3-polygon/blob/master/README.md#polygonHull">d3.polygonHull</a> method which takes an array of points and returns the convex hull.</p>
</div>
<div class="section" id="quadtrees-d3-quadtree">
<h2><a class="reference external" href="https://github.com/d3/d3-quadtree/blob/master/README.md">Quadtrees (d3-quadtree)</a><a class="headerlink" href="#quadtrees-d3-quadtree" title="Permalink to this headline">¶</a></h2>
<p>The d3.geom.quadtree method has been replaced by <a class="reference external" href="https://github.com/d3/d3-quadtree/blob/master/README.md#quadtree">d3.quadtree</a>. 4.0 removes the concept of quadtree “generators” (configurable functions that build a quadtree from an array of data); there are now just quadtrees, which you can create via d3.quadtree and add data to via <a class="reference external" href="https://github.com/d3/d3-quadtree/blob/master/README.md#quadtree_add"><em>quadtree</em>.add</a> and <a class="reference external" href="https://github.com/d3/d3-quadtree/blob/master/README.md#quadtree_addAll"><em>quadtree</em>.addAll</a>. This code in 3.x:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">quadtree</span> <span class="o">=</span> <span class="nx">d3</span><span class="p">.</span><span class="nx">geom</span><span class="p">.</span><span class="nx">quadtree</span><span class="p">()</span>
    <span class="p">.</span><span class="nx">extent</span><span class="p">([[</span><span class="mf">0</span><span class="p">,</span> <span class="mf">0</span><span class="p">],</span> <span class="p">[</span><span class="nx">width</span><span class="p">,</span> <span class="nx">height</span><span class="p">]])</span>
    <span class="p">(</span><span class="nx">data</span><span class="p">);</span>
</pre></div>
</div>
<p>Can be rewritten in 4.0 as:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">quadtree</span> <span class="o">=</span> <span class="nx">d3</span><span class="p">.</span><span class="nx">quadtree</span><span class="p">()</span>
    <span class="p">.</span><span class="nx">extent</span><span class="p">([[</span><span class="mf">0</span><span class="p">,</span> <span class="mf">0</span><span class="p">],</span> <span class="p">[</span><span class="nx">width</span><span class="p">,</span> <span class="nx">height</span><span class="p">]])</span>
    <span class="p">.</span><span class="nx">addAll</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
</pre></div>
</div>
<p>The new quadtree implementation is vastly improved! It is no longer recursive, avoiding stack overflows when there are large numbers of coincident points. The internal storage is now more efficient, and the implementation is also faster; constructing a quadtree of 1M normally-distributed points takes about one second in 4.0, as compared to three seconds in 3.x.</p>
<p>The change in <a class="reference external" href="https://github.com/d3/d3-quadtree/blob/master/README.md#nodes">internal <em>node</em> structure</a> affects <a class="reference external" href="https://github.com/d3/d3-quadtree/blob/master/README.md#quadtree_visit"><em>quadtree</em>.visit</a>: use <em>node</em>.length to distinguish leaf nodes from internal nodes. For example, to iterate over all data in a quadtree:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="nx">quadtree</span><span class="p">.</span><span class="nx">visit</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">node</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">node</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">do</span> <span class="p">{</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">node</span><span class="p">.</span><span class="nx">data</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">while</span> <span class="p">(</span><span class="nx">node</span> <span class="o">=</span> <span class="nx">node</span><span class="p">.</span><span class="nx">next</span><span class="p">)</span>
  <span class="p">}</span>
<span class="p">});</span>
</pre></div>
</div>
<p>There’s a new <a class="reference external" href="https://github.com/d3/d3-quadtree/blob/master/README.md#quadtree_visitAfter"><em>quadtree</em>.visitAfter</a> method for visiting nodes in post-order traversal. This feature is used in <a class="reference external" href="#forces-d3-force">d3-force</a> to implement the <a class="reference external" href="https://en.wikipedia.org/wiki/Barnes%E2%80%93Hut_simulation">Barnes–Hut approximation</a>.</p>
<p>You can now remove data from a quadtree using <a class="reference external" href="https://github.com/d3/d3-quadtree/blob/master/README.md#quadtree_remove"><em>quadtree</em>.remove</a> and <a class="reference external" href="https://github.com/d3/d3-quadtree/blob/master/README.md#quadtree_removeAll"><em>quadtree</em>.removeAll</a>. When adding data to a quadtree, the quadtree will now expand its extent by repeated doubling if the new point is outside the existing extent of the quadtree. There are also <a class="reference external" href="https://github.com/d3/d3-quadtree/blob/master/README.md#quadtree_extent"><em>quadtree</em>.extent</a> and <a class="reference external" href="https://github.com/d3/d3-quadtree/blob/master/README.md#quadtree_cover"><em>quadtree</em>.cover</a> methods for explicitly expanding the extent of the quadtree after creation.</p>
<p>Quadtrees support several new utility methods: <a class="reference external" href="https://github.com/d3/d3-quadtree/blob/master/README.md#quadtree_copy"><em>quadtree</em>.copy</a> returns a copy of the quadtree sharing the same data; <a class="reference external" href="https://github.com/d3/d3-quadtree/blob/master/README.md#quadtree_data"><em>quadtree</em>.data</a> generates an array of all data in the quadtree; <a class="reference external" href="https://github.com/d3/d3-quadtree/blob/master/README.md#quadtree_size"><em>quadtree</em>.size</a> returns the number of data points in the quadtree; and <a class="reference external" href="https://github.com/d3/d3-quadtree/blob/master/README.md#quadtree_root"><em>quadtree</em>.root</a> returns the root node, which is useful for manual traversal of the quadtree. The <a class="reference external" href="https://github.com/d3/d3-quadtree/blob/master/README.md#quadtree_find"><em>quadtree</em>.find</a> method now takes an optional search radius, which is useful for pointer-based selection in <a class="reference external" href="https://bl.ocks.org/mbostock/ad70335eeef6d167bc36fd3c04378048">force-directed graphs</a>.</p>
</div>
<div class="section" id="queues-d3-queue">
<h2><a class="reference external" href="https://github.com/d3/d3-queue/blob/master/README.md">Queues (d3-queue)</a><a class="headerlink" href="#queues-d3-queue" title="Permalink to this headline">¶</a></h2>
<p>Formerly known as Queue.js and queue-async, <a class="reference external" href="https://github.com/d3/d3-queue">d3.queue</a> is now included in the default bundle, making it easy to load data files in parallel. It has been rewritten with fewer closures to improve performance, and there are now stricter checks in place to guarantee well-defined behavior. You can now use instanceof d3.queue and inspect the queue’s internal private state.</p>
</div>
<div class="section" id="random-numbers-d3-random">
<h2><a class="reference external" href="https://github.com/d3/d3-random/blob/master/README.md">Random Numbers (d3-random)</a><a class="headerlink" href="#random-numbers-d3-random" title="Permalink to this headline">¶</a></h2>
<p>Pursuant to the great namespace flattening, the random number generators have new names:</p>
<ul class="simple">
<li><p>d3.random.normal ↦ <a class="reference external" href="https://github.com/d3/d3-random/blob/master/README.md#randomNormal">d3.randomNormal</a></p></li>
<li><p>d3.random.logNormal ↦ <a class="reference external" href="https://github.com/d3/d3-random/blob/master/README.md#randomLogNormal">d3.randomLogNormal</a></p></li>
<li><p>d3.random.bates ↦ <a class="reference external" href="https://github.com/d3/d3-random/blob/master/README.md#randomBates">d3.randomBates</a></p></li>
<li><p>d3.random.irwinHall ↦ <a class="reference external" href="https://github.com/d3/d3-random/blob/master/README.md#randomIrwinHall">d3.randomIrwinHall</a></p></li>
</ul>
<p>There are also new random number generators for <a class="reference external" href="https://github.com/d3/d3-random/blob/master/README.md#randomExponential">exponential</a> and <a class="reference external" href="https://github.com/d3/d3-random/blob/master/README.md#randomUniform">uniform</a> distributions. The <a class="reference external" href="https://github.com/d3/d3-random/blob/master/README.md#randomNormal">normal</a> and <a class="reference external" href="https://github.com/d3/d3-random/blob/master/README.md#randomLogNormal">log-normal</a> random generators have been optimized.</p>
</div>
<div class="section" id="requests-d3-request">
<h2><a class="reference external" href="https://github.com/d3/d3-request/blob/master/README.md">Requests (d3-request)</a><a class="headerlink" href="#requests-d3-request" title="Permalink to this headline">¶</a></h2>
<p>The d3.xhr method has been renamed to <a class="reference external" href="https://github.com/d3/d3-request/blob/master/README.md#request">d3.request</a>. Basic authentication is now supported using <a class="reference external" href="https://github.com/d3/d3-request/blob/master/README.md#request_user"><em>request</em>.user</a> and <a class="reference external" href="https://github.com/d3/d3-request/blob/master/README.md#request_password"><em>request</em>.password</a>. You can now configure a timeout using <a class="reference external" href="https://github.com/d3/d3-request/blob/master/README.md#request_timeout"><em>request</em>.timeout</a>.</p>
<p>If an error occurs, the corresponding <a class="reference external" href="https://xhr.spec.whatwg.org/#interface-progressevent">ProgressEvent</a> of type “error” is now passed to the error listener, rather than the <a class="reference external" href="https://xhr.spec.whatwg.org/#interface-xmlhttprequest">XMLHttpRequest</a>. Likewise, the ProgressEvent is passed to progress event listeners, rather than using <a class="reference external" href="https://github.com/d3/d3-selection/blob/master/README.md#event">d3.event</a>. If <a class="reference external" href="https://github.com/d3/d3-request/blob/master/README.md#xml">d3.xml</a> encounters an error parsing XML, this error is now reported to error listeners rather than returning a null response.</p>
<p>The <a class="reference external" href="https://github.com/d3/d3-request/blob/master/README.md#request">d3.request</a>, <a class="reference external" href="https://github.com/d3/d3-request/blob/master/README.md#text">d3.text</a> and <a class="reference external" href="https://github.com/d3/d3-request/blob/master/README.md#xml">d3.xml</a> methods no longer take an optional mime type as the second argument; use <a class="reference external" href="https://github.com/d3/d3-request/blob/master/README.md#request_mimeType"><em>request</em>.mimeType</a> instead. For example:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span>d3.xml(&quot;file.svg&quot;).mimeType(&quot;image/svg+xml&quot;).get(function(error, svg) {
  …
});
</pre></div>
</div>
<p>With the exception of <a class="reference external" href="https://github.com/d3/d3-request/blob/master/README.md#html">d3.html</a> and <a class="reference external" href="https://github.com/d3/d3-request/blob/master/README.md#xml">d3.xml</a>, Node is now supported via <a class="reference external" href="https://github.com/driverdan/node-XMLHttpRequest">node-XMLHttpRequest</a>.</p>
</div>
<div class="section" id="scales-d3-scale">
<h2><a class="reference external" href="https://github.com/d3/d3-scale/blob/master/README.md">Scales (d3-scale)</a><a class="headerlink" href="#scales-d3-scale" title="Permalink to this headline">¶</a></h2>
<p>Pursuant to the great namespace flattening:</p>
<ul class="simple">
<li><p>d3.scale.linear ↦ <a class="reference external" href="https://github.com/d3/d3-scale/blob/master/README.md#scaleLinear">d3.scaleLinear</a></p></li>
<li><p>d3.scale.sqrt ↦ <a class="reference external" href="https://github.com/d3/d3-scale/blob/master/README.md#scaleSqrt">d3.scaleSqrt</a></p></li>
<li><p>d3.scale.pow ↦ <a class="reference external" href="https://github.com/d3/d3-scale/blob/master/README.md#scalePow">d3.scalePow</a></p></li>
<li><p>d3.scale.log ↦ <a class="reference external" href="https://github.com/d3/d3-scale/blob/master/README.md#scaleLog">d3.scaleLog</a></p></li>
<li><p>d3.scale.quantize ↦ <a class="reference external" href="https://github.com/d3/d3-scale/blob/master/README.md#scaleQuantize">d3.scaleQuantize</a></p></li>
<li><p>d3.scale.threshold ↦ <a class="reference external" href="https://github.com/d3/d3-scale/blob/master/README.md#scaleThreshold">d3.scaleThreshold</a></p></li>
<li><p>d3.scale.quantile ↦ <a class="reference external" href="https://github.com/d3/d3-scale/blob/master/README.md#scaleQuantile">d3.scaleQuantile</a></p></li>
<li><p>d3.scale.identity ↦ <a class="reference external" href="https://github.com/d3/d3-scale/blob/master/README.md#scaleIdentity">d3.scaleIdentity</a></p></li>
<li><p>d3.scale.ordinal ↦ <a class="reference external" href="https://github.com/d3/d3-scale/blob/master/README.md#scaleOrdinal">d3.scaleOrdinal</a></p></li>
<li><p>d3.time.scale ↦ <a class="reference external" href="https://github.com/d3/d3-scale/blob/master/README.md#scaleTime">d3.scaleTime</a></p></li>
<li><p>d3.time.scale.utc ↦ <a class="reference external" href="https://github.com/d3/d3-scale/blob/master/README.md#scaleUtc">d3.scaleUtc</a></p></li>
</ul>
<p>Scales now generate ticks in the same order as the domain: if you have a descending domain, you now get descending ticks. This change affects the order of tick elements generated by <a class="reference external" href="#axes-d3-axis">axes</a>. For example:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="nx">d3</span><span class="p">.</span><span class="nx">scaleLinear</span><span class="p">().</span><span class="nx">domain</span><span class="p">([</span><span class="mf">10</span><span class="p">,</span> <span class="mf">0</span><span class="p">]).</span><span class="nx">ticks</span><span class="p">(</span><span class="mf">5</span><span class="p">);</span> <span class="c1">// [10, 8, 6, 4, 2, 0]</span>
</pre></div>
</div>
<p><a class="reference external" href="https://github.com/d3/d3-scale/blob/master/README.md#log_tickFormat">Log tick formatting</a> now assumes a default <em>count</em> of ten, not Infinity, if not specified. Log scales with  domains that span many powers (such as from 1e+3 to 1e+29) now return only one <a class="reference external" href="https://github.com/d3/d3-scale/blob/master/README.md#log_ticks">tick</a> per power rather than returning <em>base</em> ticks per power. Non-linear quantitative scales are slightly more accurate.</p>
<p>You can now control whether an ordinal scale’s domain is implicitly extended when the scale is passed a value that is not already in its domain. By default, <a class="reference external" href="https://github.com/d3/d3-scale/blob/master/README.md#ordinal_unknown"><em>ordinal</em>.unknown</a> is <a class="reference external" href="https://github.com/d3/d3-scale/blob/master/README.md#scaleImplicit">d3.scaleImplicit</a>, causing unknown values to be added to the domain:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">x</span> <span class="o">=</span> <span class="nx">d3</span><span class="p">.</span><span class="nx">scaleOrdinal</span><span class="p">()</span>
    <span class="p">.</span><span class="nx">domain</span><span class="p">([</span><span class="mf">0</span><span class="p">,</span> <span class="mf">1</span><span class="p">])</span>
    <span class="p">.</span><span class="nx">range</span><span class="p">([</span><span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="s2">&quot;green&quot;</span><span class="p">,</span> <span class="s2">&quot;blue&quot;</span><span class="p">]);</span>

<span class="nx">x</span><span class="p">.</span><span class="nx">domain</span><span class="p">();</span> <span class="c1">// [0, 1]</span>
<span class="nx">x</span><span class="p">(</span><span class="mf">2</span><span class="p">);</span> <span class="c1">// &quot;blue&quot;</span>
<span class="nx">x</span><span class="p">.</span><span class="nx">domain</span><span class="p">();</span> <span class="c1">// [0, 1, 2]</span>
</pre></div>
</div>
<p>By setting <em>ordinal</em>.unknown, you instead define the output value for unknown inputs. This is particularly useful for choropleth maps where you want to assign a color to missing data.</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">x</span> <span class="o">=</span> <span class="nx">d3</span><span class="p">.</span><span class="nx">scaleOrdinal</span><span class="p">()</span>
    <span class="p">.</span><span class="nx">domain</span><span class="p">([</span><span class="mf">0</span><span class="p">,</span> <span class="mf">1</span><span class="p">])</span>
    <span class="p">.</span><span class="nx">range</span><span class="p">([</span><span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="s2">&quot;green&quot;</span><span class="p">,</span> <span class="s2">&quot;blue&quot;</span><span class="p">])</span>
    <span class="p">.</span><span class="nx">unknown</span><span class="p">(</span><span class="kc">undefined</span><span class="p">);</span>

<span class="nx">x</span><span class="p">.</span><span class="nx">domain</span><span class="p">();</span> <span class="c1">// [0, 1]</span>
<span class="nx">x</span><span class="p">(</span><span class="mf">2</span><span class="p">);</span> <span class="c1">// undefined</span>
<span class="nx">x</span><span class="p">.</span><span class="nx">domain</span><span class="p">();</span> <span class="c1">// [0, 1]</span>
</pre></div>
</div>
<p>The <em>ordinal</em>.rangeBands and <em>ordinal</em>.rangeRoundBands methods have been replaced with a new subclass of ordinal scale: <a class="reference external" href="https://github.com/d3/d3-scale/blob/master/README.md#band-scales">band scales</a>. The following code in 3.x:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">x</span> <span class="o">=</span> <span class="nx">d3</span><span class="p">.</span><span class="nx">scale</span><span class="p">.</span><span class="nx">ordinal</span><span class="p">()</span>
    <span class="p">.</span><span class="nx">domain</span><span class="p">([</span><span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="s2">&quot;b&quot;</span><span class="p">,</span> <span class="s2">&quot;c&quot;</span><span class="p">])</span>
    <span class="p">.</span><span class="nx">rangeBands</span><span class="p">([</span><span class="mf">0</span><span class="p">,</span> <span class="nx">width</span><span class="p">]);</span>
</pre></div>
</div>
<p>Is equivalent to this in 4.0:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">x</span> <span class="o">=</span> <span class="nx">d3</span><span class="p">.</span><span class="nx">scaleBand</span><span class="p">()</span>
    <span class="p">.</span><span class="nx">domain</span><span class="p">([</span><span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="s2">&quot;b&quot;</span><span class="p">,</span> <span class="s2">&quot;c&quot;</span><span class="p">])</span>
    <span class="p">.</span><span class="nx">range</span><span class="p">([</span><span class="mf">0</span><span class="p">,</span> <span class="nx">width</span><span class="p">]);</span>
</pre></div>
</div>
<p>The new <a class="reference external" href="https://github.com/d3/d3-scale/blob/master/README.md#band_padding"><em>band</em>.padding</a>, <a class="reference external" href="https://github.com/d3/d3-scale/blob/master/README.md#band_paddingInner"><em>band</em>.paddingInner</a> and <a class="reference external" href="https://github.com/d3/d3-scale/blob/master/README.md#band_paddingOuter"><em>band</em>.paddingOuter</a> methods replace the optional arguments to <em>ordinal</em>.rangeBands. The new <a class="reference external" href="https://github.com/d3/d3-scale/blob/master/README.md#band_bandwidth"><em>band</em>.bandwidth</a> and <a class="reference external" href="https://github.com/d3/d3-scale/blob/master/README.md#band_step"><em>band</em>.step</a> methods replace <em>ordinal</em>.rangeBand. There’s also a new <a class="reference external" href="https://github.com/d3/d3-scale/blob/master/README.md#band_align"><em>band</em>.align</a> method which you can use to control how the extra space outside the bands is distributed, say to shift columns closer to the <em>y</em>-axis.</p>
<p>Similarly, the <em>ordinal</em>.rangePoints and <em>ordinal</em>.rangeRoundPoints methods have been replaced with a new subclass of ordinal scale: <a class="reference external" href="https://github.com/d3/d3-scale/blob/master/README.md#point-scales">point scales</a>. The following code in 3.x:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">x</span> <span class="o">=</span> <span class="nx">d3</span><span class="p">.</span><span class="nx">scale</span><span class="p">.</span><span class="nx">ordinal</span><span class="p">()</span>
    <span class="p">.</span><span class="nx">domain</span><span class="p">([</span><span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="s2">&quot;b&quot;</span><span class="p">,</span> <span class="s2">&quot;c&quot;</span><span class="p">])</span>
    <span class="p">.</span><span class="nx">rangePoints</span><span class="p">([</span><span class="mf">0</span><span class="p">,</span> <span class="nx">width</span><span class="p">]);</span>
</pre></div>
</div>
<p>Is equivalent to this in 4.0:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">x</span> <span class="o">=</span> <span class="nx">d3</span><span class="p">.</span><span class="nx">scalePoint</span><span class="p">()</span>
    <span class="p">.</span><span class="nx">domain</span><span class="p">([</span><span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="s2">&quot;b&quot;</span><span class="p">,</span> <span class="s2">&quot;c&quot;</span><span class="p">])</span>
    <span class="p">.</span><span class="nx">range</span><span class="p">([</span><span class="mf">0</span><span class="p">,</span> <span class="nx">width</span><span class="p">]);</span>
</pre></div>
</div>
<p>The new <a class="reference external" href="https://github.com/d3/d3-scale/blob/master/README.md#point_padding"><em>point</em>.padding</a> method replaces the optional <em>padding</em> argument to <em>ordinal</em>.rangePoints. Like <em>ordinal</em>.rangeBand with <em>ordinal</em>.rangePoints, the <a class="reference external" href="https://github.com/d3/d3-scale/blob/master/README.md#point_bandwidth"><em>point</em>.bandwidth</a> method always returns zero; a new <a class="reference external" href="https://github.com/d3/d3-scale/blob/master/README.md#point_step"><em>point</em>.step</a> method returns the interval between adjacent points.</p>
<p>The <a class="reference external" href="https://github.com/d3/d3-scale/blob/master/README.md#ordinal-scales">ordinal scale constructor</a> now takes an optional <em>range</em> for a shorter alternative to <a class="reference external" href="https://github.com/d3/d3-scale/blob/master/README.md#ordinal_range"><em>ordinal</em>.range</a>. This is especially useful now that the categorical color scales have been changed to simple arrays of colors rather than specialized ordinal scale constructors:</p>
<ul class="simple">
<li><p>d3.scale.category10 ↦ <a class="reference external" href="https://github.com/d3/d3-scale/blob/master/README.md#schemeCategory10">d3.schemeCategory10</a></p></li>
<li><p>d3.scale.category20 ↦ <a class="reference external" href="https://github.com/d3/d3-scale/blob/master/README.md#schemeCategory20">d3.schemeCategory20</a></p></li>
<li><p>d3.scale.category20b ↦ <a class="reference external" href="https://github.com/d3/d3-scale/blob/master/README.md#schemeCategory20b">d3.schemeCategory20b</a></p></li>
<li><p>d3.scale.category20c ↦ <a class="reference external" href="https://github.com/d3/d3-scale/blob/master/README.md#schemeCategory20c">d3.schemeCategory20c</a></p></li>
</ul>
<p>The following code in 3.x:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">color</span> <span class="o">=</span> <span class="nx">d3</span><span class="p">.</span><span class="nx">scale</span><span class="p">.</span><span class="nx">category10</span><span class="p">();</span>
</pre></div>
</div>
<p>Is equivalent to this in 4.0:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">color</span> <span class="o">=</span> <span class="nx">d3</span><span class="p">.</span><span class="nx">scaleOrdinal</span><span class="p">(</span><span class="nx">d3</span><span class="p">.</span><span class="nx">schemeCategory10</span><span class="p">);</span>
</pre></div>
</div>
<p><a class="reference external" href="https://github.com/d3/d3-scale/blob/master/README.md#scaleSequential">Sequential scales</a>, are a new class of scales with a fixed output <a class="reference external" href="https://github.com/d3/d3-scale/blob/master/README.md#sequential_interpolator">interpolator</a> instead of a <a class="reference external" href="https://github.com/d3/d3-scale/blob/master/README.md#continuous_range">range</a>. Typically these scales are used to implement continuous sequential or diverging color schemes. Inspired by Matplotlib’s new <a class="reference external" href="https://bids.github.io/colormap/">perceptually-motived colormaps</a>, 4.0 now features <a class="reference external" href="https://github.com/d3/d3-scale/blob/master/README.md#interpolateViridis">viridis</a>, <a class="reference external" href="https://github.com/d3/d3-scale/blob/master/README.md#interpolateInferno">inferno</a>, <a class="reference external" href="https://github.com/d3/d3-scale/blob/master/README.md#interpolateMagma">magma</a>, <a class="reference external" href="https://github.com/d3/d3-scale/blob/master/README.md#interpolatePlasma">plasma</a> interpolators for use with sequential scales. Using <a class="reference external" href="https://github.com/d3/d3-interpolate/blob/master/README.md#quantize">d3.quantize</a>, these interpolators can also be applied to <a class="reference external" href="https://github.com/d3/d3-scale/blob/master/README.md#quantile-scales">quantile</a>, <a class="reference external" href="https://github.com/d3/d3-scale/blob/master/README.md#quantize-scales">quantize</a> and <a class="reference external" href="https://github.com/d3/d3-scale/blob/master/README.md#threshold-scales">threshold</a> scales.</p>
<p><a class="reference external" href="https://github.com/d3/d3-scale/blob/master/README.md#interpolateViridis"><img src="https://raw.githubusercontent.com/d3/d3-scale/v1.0.0/img/viridis.png" width="100%" height="40" alt="viridis"></a>
<a class="reference external" href="https://github.com/d3/d3-scale/blob/master/README.md#interpolateInferno"><img src="https://raw.githubusercontent.com/d3/d3-scale/v1.0.0/img/inferno.png" width="100%" height="40" alt="inferno"></a>
<a class="reference external" href="https://github.com/d3/d3-scale/blob/master/README.md#interpolateMagma"><img src="https://raw.githubusercontent.com/d3/d3-scale/v1.0.0/img/magma.png" width="100%" height="40" alt="magma"></a>
<a class="reference external" href="https://github.com/d3/d3-scale/blob/master/README.md#interpolatePlasma"><img src="https://raw.githubusercontent.com/d3/d3-scale/v1.0.0/img/plasma.png" width="100%" height="40" alt="plasma"></a></p>
<p>4.0 also ships new Cubehelix schemes, including <a class="reference external" href="https://github.com/d3/d3-scale/blob/master/README.md#interpolateCubehelixDefault">Dave Green’s default</a> and a <a class="reference external" href="https://github.com/d3/d3-scale/blob/master/README.md#interpolateRainbow">cyclical rainbow</a> inspired by <a class="reference external" href="https://mycarta.wordpress.com/2013/02/21/perceptual-rainbow-palette-the-method/">Matteo Niccoli</a>:</p>
<p><a class="reference external" href="https://github.com/d3/d3-scale/blob/master/README.md#interpolateCubehelixDefault"><img src="https://raw.githubusercontent.com/d3/d3-scale/v1.0.0/img/cubehelix.png" width="100%" height="40" alt="cubehelix"></a>
<a class="reference external" href="https://github.com/d3/d3-scale/blob/master/README.md#interpolateRainbow"><img src="https://raw.githubusercontent.com/d3/d3-scale/v1.0.0/img/rainbow.png" width="100%" height="40" alt="rainbow"></a>
<a class="reference external" href="https://github.com/d3/d3-scale/blob/master/README.md#interpolateWarm"><img src="https://raw.githubusercontent.com/d3/d3-scale/v1.0.0/img/warm.png" width="100%" height="40" alt="warm"></a>
<a class="reference external" href="https://github.com/d3/d3-scale/blob/master/README.md#interpolateCool"><img src="https://raw.githubusercontent.com/d3/d3-scale/v1.0.0/img/cool.png" width="100%" height="40" alt="cool"></a></p>
<p>For even more sequential and categorical color schemes, see <a class="reference external" href="https://github.com/d3/d3-scale-chromatic">d3-scale-chromatic</a>.</p>
<p>For an introduction to scales, see <a class="reference external" href="https://medium.com/&#64;mbostock/introducing-d3-scale-61980c51545f">Introducing d3-scale</a>.</p>
</div>
<div class="section" id="selections-d3-selection">
<h2><a class="reference external" href="https://github.com/d3/d3-selection/blob/master/README.md">Selections (d3-selection)</a><a class="headerlink" href="#selections-d3-selection" title="Permalink to this headline">¶</a></h2>
<p>Selections no longer subclass Array using <a class="reference external" href="http://perfectionkills.com/how-ecmascript-5-still-does-not-allow-to-subclass-an-array/#wrappers_prototype_chain_injection">prototype chain injection</a>; they are now plain objects, improving performance. The internal fields (<em>selection</em>._groups, <em>selection</em>._parents) are private; please use the documented public API to manipulate selections. The new <a class="reference external" href="https://github.com/d3/d3-selection/blob/master/README.md#selection_nodes"><em>selection</em>.nodes</a> method generates an array of all nodes in a selection.</p>
<p>Selections are now immutable: the elements and parents in a selection never change. (The elements’ attributes and content will of course still be modified!) The <a class="reference external" href="https://github.com/d3/d3-selection/blob/master/README.md#selection_sort"><em>selection</em>.sort</a> and <a class="reference external" href="https://github.com/d3/d3-selection/blob/master/README.md#selection_data"><em>selection</em>.data</a> methods now return new selections rather than modifying the selection in-place. In addition, <a class="reference external" href="https://github.com/d3/d3-selection/blob/master/README.md#selection_append"><em>selection</em>.append</a> no longer merges entering nodes into the update selection; use <a class="reference external" href="https://github.com/d3/d3-selection/blob/master/README.md#selection_merge"><em>selection</em>.merge</a> to combine enter and update after a data join. For example, the following <a class="reference external" href="https://bl.ocks.org/mbostock/a8a5baa4c4a470cda598">general update pattern</a> in 3.x:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">circle</span> <span class="o">=</span> <span class="nx">svg</span><span class="p">.</span><span class="nx">selectAll</span><span class="p">(</span><span class="s2">&quot;circle&quot;</span><span class="p">).</span><span class="nx">data</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="c1">// UPDATE</span>
    <span class="p">.</span><span class="nx">style</span><span class="p">(</span><span class="s2">&quot;fill&quot;</span><span class="p">,</span> <span class="s2">&quot;blue&quot;</span><span class="p">);</span>

<span class="nx">circle</span><span class="p">.</span><span class="nx">exit</span><span class="p">().</span><span class="nx">remove</span><span class="p">();</span> <span class="c1">// EXIT</span>

<span class="nx">circle</span><span class="p">.</span><span class="nx">enter</span><span class="p">().</span><span class="nx">append</span><span class="p">(</span><span class="s2">&quot;circle&quot;</span><span class="p">)</span> <span class="c1">// ENTER; modifies UPDATE! 🌶</span>
    <span class="p">.</span><span class="nx">style</span><span class="p">(</span><span class="s2">&quot;fill&quot;</span><span class="p">,</span> <span class="s2">&quot;green&quot;</span><span class="p">);</span>

<span class="nx">circle</span> <span class="c1">// ENTER + UPDATE</span>
    <span class="p">.</span><span class="nx">style</span><span class="p">(</span><span class="s2">&quot;stroke&quot;</span><span class="p">,</span> <span class="s2">&quot;black&quot;</span><span class="p">);</span>
</pre></div>
</div>
<p>Would be rewritten in 4.0 as:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">circle</span> <span class="o">=</span> <span class="nx">svg</span><span class="p">.</span><span class="nx">selectAll</span><span class="p">(</span><span class="s2">&quot;circle&quot;</span><span class="p">).</span><span class="nx">data</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="c1">// UPDATE</span>
    <span class="p">.</span><span class="nx">style</span><span class="p">(</span><span class="s2">&quot;fill&quot;</span><span class="p">,</span> <span class="s2">&quot;blue&quot;</span><span class="p">);</span>

<span class="nx">circle</span><span class="p">.</span><span class="nx">exit</span><span class="p">().</span><span class="nx">remove</span><span class="p">();</span> <span class="c1">// EXIT</span>

<span class="nx">circle</span><span class="p">.</span><span class="nx">enter</span><span class="p">().</span><span class="nx">append</span><span class="p">(</span><span class="s2">&quot;circle&quot;</span><span class="p">)</span> <span class="c1">// ENTER</span>
    <span class="p">.</span><span class="nx">style</span><span class="p">(</span><span class="s2">&quot;fill&quot;</span><span class="p">,</span> <span class="s2">&quot;green&quot;</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">merge</span><span class="p">(</span><span class="nx">circle</span><span class="p">)</span> <span class="c1">// ENTER + UPDATE</span>
    <span class="p">.</span><span class="nx">style</span><span class="p">(</span><span class="s2">&quot;stroke&quot;</span><span class="p">,</span> <span class="s2">&quot;black&quot;</span><span class="p">);</span>
</pre></div>
</div>
<p>This change is discussed further in <a class="reference external" href="https://medium.com/&#64;mbostock/what-makes-software-good-943557f8a488">What Makes Software Good</a>.</p>
<p>In 3.x, the <a class="reference external" href="https://github.com/d3/d3-selection/blob/master/README.md#selection_enter"><em>selection</em>.enter</a> and <a class="reference external" href="https://github.com/d3/d3-selection/blob/master/README.md#selection_exit"><em>selection</em>.exit</a> methods were undefined until you called <em>selection</em>.data, resulting in a TypeError if you attempted to access them. In 4.0, now they simply return the empty selection if the selection has not been joined to data.</p>
<p>In 3.x, <a class="reference external" href="https://github.com/d3/d3-selection/blob/master/README.md#selection_append"><em>selection</em>.append</a> would always append the new element as the last child of its parent. A little-known trick was to use <a class="reference external" href="https://github.com/d3/d3-selection/blob/master/README.md#selection_insert"><em>selection</em>.insert</a> without specifying a <em>before</em> selector when entering nodes, causing the entering nodes to be inserted before the following element in the update selection. In 4.0, this is now the default behavior of <em>selection</em>.append; if you do not specify a <em>before</em> selector to <em>selection</em>.insert, the inserted element is appended as the last child. This change makes the general update pattern preserve the relative order of elements and data. For example, given the following DOM:</p>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>a<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>b<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>f<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</pre></div>
</div>
<p>And the following code:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">div</span> <span class="o">=</span> <span class="nx">d3</span><span class="p">.</span><span class="nx">select</span><span class="p">(</span><span class="s2">&quot;body&quot;</span><span class="p">).</span><span class="nx">selectAll</span><span class="p">(</span><span class="s2">&quot;div&quot;</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">data</span><span class="p">([</span><span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="s2">&quot;b&quot;</span><span class="p">,</span> <span class="s2">&quot;c&quot;</span><span class="p">,</span> <span class="s2">&quot;d&quot;</span><span class="p">,</span> <span class="s2">&quot;e&quot;</span><span class="p">,</span> <span class="s2">&quot;f&quot;</span><span class="p">],</span> <span class="kd">function</span><span class="p">(</span><span class="nx">d</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">d</span> <span class="o">||</span> <span class="k">this</span><span class="p">.</span><span class="nx">textContent</span><span class="p">;</span> <span class="p">});</span>

<span class="nx">div</span><span class="p">.</span><span class="nx">enter</span><span class="p">().</span><span class="nx">append</span><span class="p">(</span><span class="s2">&quot;div&quot;</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">text</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">d</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">d</span><span class="p">;</span> <span class="p">});</span>
</pre></div>
</div>
<p>The resulting DOM will be:</p>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>a<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>b<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>c<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>d<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>e<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>f<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</pre></div>
</div>
<p>Thus, the entering <em>c</em>, <em>d</em> and <em>e</em> are inserted before <em>f</em>, since <em>f</em> is the following element in the update selection. Although this behavior is sufficient to preserve order if the new data’s order is stable, if the data changes order, you must still use <a class="reference external" href="https://github.com/d3/d3-selection/blob/master/README.md#selection_order"><em>selection</em>.order</a> to reorder elements.</p>
<p>There is now only one class of selection. 3.x implemented enter selections using a special class with different behavior for <em>enter</em>.append and <em>enter</em>.select; a consequence of this design was that enter selections in 3.x lacked <a class="reference external" href="https://github.com/d3/d3/issues/2043">certain methods</a>. In 4.0, enter selections are simply normal selections; they have the same methods and the same behavior. Placeholder <a class="reference external" href="https://github.com/d3/d3-selection/blob/master/src/selection/enter.js">enter nodes</a> now implement <a class="reference external" href="https://developer.mozilla.org/en-US/docs/Web/API/Node/appendChild"><em>node</em>.appendChild</a>, <a class="reference external" href="https://developer.mozilla.org/en-US/docs/Web/API/Node/insertBefore"><em>node</em>.insertBefore</a>, <a class="reference external" href="https://developer.mozilla.org/en-US/docs/Web/API/Element/querySelector"><em>node</em>.querySelector</a>, and <a class="reference external" href="https://developer.mozilla.org/en-US/docs/Web/API/Element/querySelectorAll"><em>node</em>.querySelectorAll</a>.</p>
<p>The <a class="reference external" href="https://github.com/d3/d3-selection/blob/master/README.md#selection_data"><em>selection</em>.data</a> method has been changed slightly with respect to duplicate keys. In 3.x, if multiple data had the same key, the duplicate data would be ignored and not included in enter, update or exit; in 4.0 the duplicate data is always put in the enter selection. In both 3.x and 4.0, if multiple elements have the same key, the duplicate elements are put in the exit selection. Thus, 4.0’s behavior is now symmetric for enter and exit, and the general update pattern will now produce a DOM that matches the data even if there are duplicate keys.</p>
<p>Selections have several new methods! Use <a class="reference external" href="https://github.com/d3/d3-selection/blob/master/README.md#selection_raise"><em>selection</em>.raise</a> to move the selected elements to the front of their siblings, so that they are drawn on top; use <a class="reference external" href="https://github.com/d3/d3-selection/blob/master/README.md#selection_lower"><em>selection</em>.lower</a> to move them to the back. Use <a class="reference external" href="https://github.com/d3/d3-selection/blob/master/README.md#selection_dispatch"><em>selection</em>.dispatch</a> to dispatch a <a class="reference external" href="https://developer.mozilla.org/en-US/docs/Web/API/CustomEvent">custom event</a> to event listeners.</p>
<p>When called in getter mode, <a class="reference external" href="https://github.com/d3/d3-selection/blob/master/README.md#selection_data"><em>selection</em>.data</a> now returns the data for all elements in the selection, rather than just the data for the first group of elements. The <a class="reference external" href="https://github.com/d3/d3-selection/blob/master/README.md#selection_call"><em>selection</em>.call</a> method no longer sets the <code class="docutils literal notranslate"><span class="pre">this</span></code> context when invoking the specified function; the <em>selection</em> is passed as the first argument to the function, so use that. The <a class="reference external" href="https://github.com/d3/d3-selection/blob/master/README.md#selection_on"><em>selection</em>.on</a> method now accepts multiple whitespace-separated typenames, so you can add or remove multiple listeners simultaneously. For example:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="nx">selection</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;mousedown touchstart&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">d3</span><span class="p">.</span><span class="nx">event</span><span class="p">.</span><span class="nx">type</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>
</div>
<p>The arguments passed to callback functions has changed slightly in 4.0 to be more consistent. The standard arguments are the element’s datum (<em>d</em>), the element’s index (<em>i</em>), and the element’s group (<em>nodes</em>), with <em>this</em> as the element. The slight exception to this convention is <em>selection</em>.data, which is evaluated for each group rather than each element; it is passed the group’s parent datum (<em>d</em>), the group index (<em>i</em>), and the selection’s parents (<em>parents</em>), with <em>this</em> as the group’s parent.</p>
<p>The new <a class="reference external" href="https://github.com/d3/d3-selection/blob/master/README.md#local-variables">d3.local</a> provides a mechanism for defining <a class="reference external" href="https://bl.ocks.org/mbostock/e1192fe405703d8321a5187350910e08">local variables</a>: state that is bound to DOM elements, and available to any descendant element. This can be a convenient alternative to using <a class="reference external" href="https://github.com/d3/d3-selection/blob/master/README.md#selection_each"><em>selection</em>.each</a> or storing local state in data.</p>
<p>The d3.ns.prefix namespace prefix map has been renamed to <a class="reference external" href="https://github.com/d3/d3-selection/blob/master/README.md#namespaces">d3.namespaces</a>, and the d3.ns.qualify method has been renamed to <a class="reference external" href="https://github.com/d3/d3-selection/blob/master/README.md#namespace">d3.namespace</a>. Several new low-level methods are now available, as well. <a class="reference external" href="https://github.com/d3/d3-selection/blob/master/README.md#matcher">d3.matcher</a> is used internally by <a class="reference external" href="https://github.com/d3/d3-selection/blob/master/README.md#selection_filter"><em>selection</em>.filter</a>; <a class="reference external" href="https://github.com/d3/d3-selection/blob/master/README.md#selector">d3.selector</a> is used by <a class="reference external" href="https://github.com/d3/d3-selection/blob/master/README.md#selection_select"><em>selection</em>.select</a>; <a class="reference external" href="https://github.com/d3/d3-selection/blob/master/README.md#selectorAll">d3.selectorAll</a> is used by <a class="reference external" href="https://github.com/d3/d3-selection/blob/master/README.md#selection_selectAll"><em>selection</em>.selectAll</a>; <a class="reference external" href="https://github.com/d3/d3-selection/blob/master/README.md#creator">d3.creator</a> is used by <a class="reference external" href="https://github.com/d3/d3-selection/blob/master/README.md#selection_append"><em>selection</em>.append</a> and <a class="reference external" href="https://github.com/d3/d3-selection/blob/master/README.md#selection_insert"><em>selection</em>.insert</a>. The new <a class="reference external" href="https://github.com/d3/d3-selection/blob/master/README.md#window">d3.window</a> returns the owner window for a given element, window or document. The new <a class="reference external" href="https://github.com/d3/d3-selection/blob/master/README.md#customEvent">d3.customEvent</a> temporarily sets <a class="reference external" href="https://github.com/d3/d3-selection/blob/master/README.md#event">d3.event</a> while invoking a function, allowing you to implement controls which dispatch custom events; this is used by <a class="reference external" href="https://github.com/d3/d3-drag">d3-drag</a>, <a class="reference external" href="https://github.com/d3/d3-zoom">d3-zoom</a> and <a class="reference external" href="https://github.com/d3/d3-brush">d3-brush</a>.</p>
<p>For the sake of parsimony, the multi-value methods—where you pass an object to set multiple attributes, styles or properties simultaneously—have been extracted to <a class="reference external" href="https://github.com/d3/d3-selection-multi">d3-selection-multi</a> and are no longer part of the default bundle. The multi-value map methods have also been renamed to plural form to reduce overload: <a class="reference external" href="https://github.com/d3/d3-selection-multi/blob/master/README.md#selection_attrs"><em>selection</em>.attrs</a>, <a class="reference external" href="https://github.com/d3/d3-selection-multi/blob/master/README.md#selection_styles"><em>selection</em>.styles</a> and <a class="reference external" href="https://github.com/d3/d3-selection-multi/blob/master/README.md#selection_properties"><em>selection</em>.properties</a>.</p>
</div>
<div class="section" id="shapes-d3-shape">
<h2><a class="reference external" href="https://github.com/d3/d3-shape/blob/master/README.md">Shapes (d3-shape)</a><a class="headerlink" href="#shapes-d3-shape" title="Permalink to this headline">¶</a></h2>
<p>Pursuant to the great namespace flattening:</p>
<ul class="simple">
<li><p>d3.svg.line ↦ <a class="reference external" href="https://github.com/d3/d3-shape/blob/master/README.md#lines">d3.line</a></p></li>
<li><p>d3.svg.line.radial ↦ <a class="reference external" href="https://github.com/d3/d3-shape/blob/master/README.md#radialLine">d3.radialLine</a></p></li>
<li><p>d3.svg.area ↦ <a class="reference external" href="https://github.com/d3/d3-shape/blob/master/README.md#areas">d3.area</a></p></li>
<li><p>d3.svg.area.radial ↦ <a class="reference external" href="https://github.com/d3/d3-shape/blob/master/README.md#radialArea">d3.radialArea</a></p></li>
<li><p>d3.svg.arc ↦ <a class="reference external" href="https://github.com/d3/d3-shape/blob/master/README.md#arcs">d3.arc</a></p></li>
<li><p>d3.svg.symbol ↦ <a class="reference external" href="https://github.com/d3/d3-shape/blob/master/README.md#symbols">d3.symbol</a></p></li>
<li><p>d3.svg.symbolTypes ↦ <a class="reference external" href="https://github.com/d3/d3-shape/blob/master/README.md#symbolTypes">d3.symbolTypes</a></p></li>
<li><p>d3.layout.pie ↦ <a class="reference external" href="https://github.com/d3/d3-shape/blob/master/README.md#pies">d3.pie</a></p></li>
<li><p>d3.layout.stack ↦ <a class="reference external" href="https://github.com/d3/d3-shape/blob/master/README.md#stacks">d3.stack</a></p></li>
<li><p>d3.svg.diagonal ↦ REMOVED (see <a class="reference external" href="https://github.com/d3/d3-shape/issues/27">d3/d3-shape#27</a>)</p></li>
<li><p>d3.svg.diagonal.radial ↦ REMOVED</p></li>
</ul>
<p>Shapes are no longer limited to SVG; they can now render to Canvas! Shape generators now support an optional <em>context</em>: given a <a class="reference external" href="https://developer.mozilla.org/en-US/docs/Web/API/CanvasRenderingContext2D">CanvasRenderingContext2D</a>, you can render a shape as a canvas path to be filled or stroked. For example, a <a class="reference external" href="https://bl.ocks.org/mbostock/8878e7fd82034f1d63cf">canvas pie chart</a> might use an arc generator:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">arc</span> <span class="o">=</span> <span class="nx">d3</span><span class="p">.</span><span class="nx">arc</span><span class="p">()</span>
    <span class="p">.</span><span class="nx">outerRadius</span><span class="p">(</span><span class="nx">radius</span> <span class="o">-</span> <span class="mf">10</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">innerRadius</span><span class="p">(</span><span class="mf">0</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">context</span><span class="p">(</span><span class="nx">context</span><span class="p">);</span>
</pre></div>
</div>
<p>To render an arc for a given datum <em>d</em>:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="nx">context</span><span class="p">.</span><span class="nx">beginPath</span><span class="p">();</span>
<span class="nx">arc</span><span class="p">(</span><span class="nx">d</span><span class="p">);</span>
<span class="nx">context</span><span class="p">.</span><span class="nx">fill</span><span class="p">();</span>
</pre></div>
</div>
<p>See <a class="reference external" href="https://github.com/d3/d3-shape/blob/master/README.md#line_context"><em>line</em>.context</a>, <a class="reference external" href="https://github.com/d3/d3-shape/blob/master/README.md#area_context"><em>area</em>.context</a> and <a class="reference external" href="https://github.com/d3/d3-shape/blob/master/README.md#arc_context"><em>arc</em>.context</a> for more. Under the hood, shapes use <a class="reference external" href="#paths-d3-path">d3-path</a> to serialize canvas path methods to SVG path data when the context is null; thus, shapes are optimized for rendering to canvas. You can also now derive lines from areas. The line shares most of the same accessors, such as <a class="reference external" href="https://github.com/d3/d3-shape/blob/master/README.md#line_defined"><em>line</em>.defined</a> and <a class="reference external" href="https://github.com/d3/d3-shape/blob/master/README.md#line_curve"><em>line</em>.curve</a>, with the area from which it is derived. For example, to render the topline of an area, use <a class="reference external" href="https://github.com/d3/d3-shape/blob/master/README.md#area_lineY1"><em>area</em>.lineY1</a>; for the baseline, use <a class="reference external" href="https://github.com/d3/d3-shape/blob/master/README.md#area_lineY0"><em>area</em>.lineY0</a>.</p>
<p>4.0 introduces a new curve API for specifying how line and area shapes interpolate between data points. The <em>line</em>.interpolate and <em>area</em>.interpolate methods have been replaced with <a class="reference external" href="https://github.com/d3/d3-shape/blob/master/README.md#line_curve"><em>line</em>.curve</a> and <a class="reference external" href="https://github.com/d3/d3-shape/blob/master/README.md#area_curve"><em>area</em>.curve</a>. Curves are implemented using the <a class="reference external" href="https://github.com/d3/d3-shape/blob/master/README.md#custom-curves">curve interface</a> rather than as a function that returns an SVG path data string; this allows curves to render to either SVG or Canvas. In addition, <em>line</em>.curve and <em>area</em>.curve now take a function which instantiates a curve for a given <em>context</em>, rather than a string. The full list of equivalents:</p>
<ul class="simple">
<li><p>linear ↦ <a class="reference external" href="https://github.com/d3/d3-shape/blob/master/README.md#curveLinear">d3.curveLinear</a></p></li>
<li><p>linear-closed ↦ <a class="reference external" href="https://github.com/d3/d3-shape/blob/master/README.md#curveLinearClosed">d3.curveLinearClosed</a></p></li>
<li><p>step ↦ <a class="reference external" href="https://github.com/d3/d3-shape/blob/master/README.md#curveStep">d3.curveStep</a></p></li>
<li><p>step-before ↦ <a class="reference external" href="https://github.com/d3/d3-shape/blob/master/README.md#curveStepBefore">d3.curveStepBefore</a></p></li>
<li><p>step-after ↦ <a class="reference external" href="https://github.com/d3/d3-shape/blob/master/README.md#curveStepAfter">d3.curveStepAfter</a></p></li>
<li><p>basis ↦ <a class="reference external" href="https://github.com/d3/d3-shape/blob/master/README.md#curveBasis">d3.curveBasis</a></p></li>
<li><p>basis-open ↦ <a class="reference external" href="https://github.com/d3/d3-shape/blob/master/README.md#curveBasisOpen">d3.curveBasisOpen</a></p></li>
<li><p>basis-closed ↦ <a class="reference external" href="https://github.com/d3/d3-shape/blob/master/README.md#curveBasisClosed">d3.curveBasisClosed</a></p></li>
<li><p>bundle ↦ <a class="reference external" href="https://github.com/d3/d3-shape/blob/master/README.md#curveBundle">d3.curveBundle</a></p></li>
<li><p>cardinal ↦ <a class="reference external" href="https://github.com/d3/d3-shape/blob/master/README.md#curveCardinal">d3.curveCardinal</a></p></li>
<li><p>cardinal-open ↦ <a class="reference external" href="https://github.com/d3/d3-shape/blob/master/README.md#curveCardinalOpen">d3.curveCardinalOpen</a></p></li>
<li><p>cardinal-closed ↦ <a class="reference external" href="https://github.com/d3/d3-shape/blob/master/README.md#curveCardinalClosed">d3.curveCardinalClosed</a></p></li>
<li><p>monotone ↦ <a class="reference external" href="https://github.com/d3/d3-shape/blob/master/README.md#curveMonotoneX">d3.curveMonotoneX</a></p></li>
</ul>
<p>But that’s not all! 4.0 now provides parameterized Catmull–Rom splines as proposed by <a class="reference external" href="http://www.cemyuksel.com/research/catmullrom_param/">Yuksel <em>et al.</em></a>. These are available as <a class="reference external" href="https://github.com/d3/d3-shape/blob/master/README.md#curveCatmullRom">d3.curveCatmullRom</a>, <a class="reference external" href="https://github.com/d3/d3-shape/blob/master/README.md#curveCatmullRomClosed">d3.curveCatmullRomClosed</a> and <a class="reference external" href="https://github.com/d3/d3-shape/blob/master/README.md#curveCatmullRomOpen">d3.curveCatmullRomOpen</a>.</p>
<img src="https://raw.githubusercontent.com/d3/d3-shape/master/img/catmullRom.png" width="888" height="240" alt="catmullRom">
<img src="https://raw.githubusercontent.com/d3/d3-shape/master/img/catmullRomOpen.png" width="888" height="240" alt="catmullRomOpen">
<img src="https://raw.githubusercontent.com/d3/d3-shape/master/img/catmullRomClosed.png" width="888" height="330" alt="catmullRomClosed">
<p>Each curve type can define its own named parameters, replacing <em>line</em>.tension and <em>area</em>.tension. For example, Catmull–Rom splines are parameterized using <a class="reference external" href="https://github.com/d3/d3-shape/blob/master/README.md#curveCatmullRom_alpha"><em>catmullRom</em>.alpha</a> and defaults to 0.5, which corresponds to a centripetal spline that avoids self-intersections and overshoot. For a uniform Catmull–Rom spline instead:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">line</span> <span class="o">=</span> <span class="nx">d3</span><span class="p">.</span><span class="nx">line</span><span class="p">()</span>
    <span class="p">.</span><span class="nx">curve</span><span class="p">(</span><span class="nx">d3</span><span class="p">.</span><span class="nx">curveCatmullRom</span><span class="p">.</span><span class="nx">alpha</span><span class="p">(</span><span class="mf">0</span><span class="p">));</span>
</pre></div>
</div>
<p>4.0 fixes the interpretation of the cardinal spline <em>tension</em> parameter, which is now specified as <a class="reference external" href="https://github.com/d3/d3-shape/blob/master/README.md#curveCardinal_tension"><em>cardinal</em>.tension</a> and defaults to zero for a uniform Catmull–Rom spline; a tension of one produces a linear curve. The first and last segments of basis and cardinal curves have also been fixed! The undocumented <em>interpolate</em>.reverse field has been removed. Curves can define different behavior for toplines and baselines by counting the sequence of <a class="reference external" href="https://github.com/d3/d3-shape/blob/master/README.md#curve_lineStart"><em>curve</em>.lineStart</a> within <a class="reference external" href="https://github.com/d3/d3-shape/blob/master/README.md#curve_areaStart"><em>curve</em>.areaStart</a>. See the <a class="reference external" href="https://github.com/d3/d3-shape/blob/master/src/curve/step.js">d3.curveStep implementation</a> for an example.</p>
<p>4.0 fixes numerous bugs in the monotone curve implementation, and introduces <a class="reference external" href="https://github.com/d3/d3-shape/blob/master/README.md#curveMonotoneY">d3.curveMonotoneY</a>; this is like d3.curveMonotoneX, except it requires that the input points are monotone in <em>y</em> rather than <em>x</em>, such as for a vertically-oriented line chart. The new <a class="reference external" href="https://github.com/d3/d3-shape/blob/master/README.md#curveNatural">d3.curveNatural</a> produces a <a class="reference external" href="http://mathworld.wolfram.com/CubicSpline.html">natural cubic spline</a>. The default <a class="reference external" href="https://github.com/d3/d3-shape/blob/master/README.md#bundle_beta">β</a> for <a class="reference external" href="https://github.com/d3/d3-shape/blob/master/README.md#curveBundle">d3.curveBundle</a> is now 0.85, rather than 0.7, matching the values used by <a class="reference external" href="https://www.win.tue.nl/vis1/home/dholten/papers/bundles_infovis.pdf">Holten</a>. 4.0 also has a more robust implementation of arc padding; see <a class="reference external" href="https://github.com/d3/d3-shape/blob/master/README.md#arc_padAngle"><em>arc</em>.padAngle</a> and <a class="reference external" href="https://github.com/d3/d3-shape/blob/master/README.md#arc_padRadius"><em>arc</em>.padRadius</a>.</p>
<p>4.0 introduces a new symbol type API. Symbol types are passed to <a class="reference external" href="https://github.com/d3/d3-shape/blob/master/README.md#symbol_type"><em>symbol</em>.type</a> in place of strings. The equivalents are:</p>
<ul class="simple">
<li><p>circle ↦ <a class="reference external" href="https://github.com/d3/d3-shape/blob/master/README.md#symbolCircle">d3.symbolCircle</a></p></li>
<li><p>cross ↦ <a class="reference external" href="https://github.com/d3/d3-shape/blob/master/README.md#symbolCross">d3.symbolCross</a></p></li>
<li><p>diamond ↦ <a class="reference external" href="https://github.com/d3/d3-shape/blob/master/README.md#symbolDiamond">d3.symbolDiamond</a></p></li>
<li><p>square ↦ <a class="reference external" href="https://github.com/d3/d3-shape/blob/master/README.md#symbolSquare">d3.symbolSquare</a></p></li>
<li><p>triangle-down ↦ REMOVED</p></li>
<li><p>triangle-up ↦ <a class="reference external" href="https://github.com/d3/d3-shape/blob/master/README.md#symbolTriangle">d3.symbolTriangle</a></p></li>
<li><p>ADDED ↦ <a class="reference external" href="https://github.com/d3/d3-shape/blob/master/README.md#symbolStar">d3.symbolStar</a></p></li>
<li><p>ADDED ↦ <a class="reference external" href="https://github.com/d3/d3-shape/blob/master/README.md#symbolWye">d3.symbolWye</a></p></li>
</ul>
<p>The full set of symbol types is now:</p>
<p><a href="#symbolCircle"><img src="https://raw.githubusercontent.com/d3/d3-shape/master/img/circle.png" width="100" height="100"></a><a href="#symbolCross"><img src="https://raw.githubusercontent.com/d3/d3-shape/master/img/cross.png" width="100" height="100"></a><a href="#symbolDiamond"><img src="https://raw.githubusercontent.com/d3/d3-shape/master/img/diamond.png" width="100" height="100"></a><a href="#symbolSquare"><img src="https://raw.githubusercontent.com/d3/d3-shape/master/img/square.png" width="100" height="100"></a><a href="#symbolStar"><img src="https://raw.githubusercontent.com/d3/d3-shape/master/img/star.png" width="100" height="100"></a><a href="#symbolTriangle"><img src="https://raw.githubusercontent.com/d3/d3-shape/master/img/triangle.png" width="100" height="100"><a href="#symbolWye"><img src="https://raw.githubusercontent.com/d3/d3-shape/master/img/wye.png" width="100" height="100"></a></p>
<p>Lastly, 4.0 overhauls the stack layout API, replacing d3.layout.stack with <a class="reference external" href="https://github.com/d3/d3-shape/blob/master/README.md#stacks">d3.stack</a>. The stack generator no longer needs an <em>x</em>-accessor. In addition, the API has been simplified: the <em>stack</em> generator now accepts tabular input, such as this array of objects:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">data</span> <span class="o">=</span> <span class="p">[</span>
  <span class="p">{</span><span class="nx">month</span><span class="o">:</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">(</span><span class="mf">2015</span><span class="p">,</span> <span class="mf">0</span><span class="p">,</span> <span class="mf">1</span><span class="p">),</span> <span class="nx">apples</span><span class="o">:</span> <span class="mf">3840</span><span class="p">,</span> <span class="nx">bananas</span><span class="o">:</span> <span class="mf">1920</span><span class="p">,</span> <span class="nx">cherries</span><span class="o">:</span> <span class="mf">960</span><span class="p">,</span> <span class="nx">dates</span><span class="o">:</span> <span class="mf">400</span><span class="p">},</span>
  <span class="p">{</span><span class="nx">month</span><span class="o">:</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">(</span><span class="mf">2015</span><span class="p">,</span> <span class="mf">1</span><span class="p">,</span> <span class="mf">1</span><span class="p">),</span> <span class="nx">apples</span><span class="o">:</span> <span class="mf">1600</span><span class="p">,</span> <span class="nx">bananas</span><span class="o">:</span> <span class="mf">1440</span><span class="p">,</span> <span class="nx">cherries</span><span class="o">:</span> <span class="mf">960</span><span class="p">,</span> <span class="nx">dates</span><span class="o">:</span> <span class="mf">400</span><span class="p">},</span>
  <span class="p">{</span><span class="nx">month</span><span class="o">:</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">(</span><span class="mf">2015</span><span class="p">,</span> <span class="mf">2</span><span class="p">,</span> <span class="mf">1</span><span class="p">),</span> <span class="nx">apples</span><span class="o">:</span>  <span class="mf">640</span><span class="p">,</span> <span class="nx">bananas</span><span class="o">:</span>  <span class="mf">960</span><span class="p">,</span> <span class="nx">cherries</span><span class="o">:</span> <span class="mf">640</span><span class="p">,</span> <span class="nx">dates</span><span class="o">:</span> <span class="mf">400</span><span class="p">},</span>
  <span class="p">{</span><span class="nx">month</span><span class="o">:</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">(</span><span class="mf">2015</span><span class="p">,</span> <span class="mf">3</span><span class="p">,</span> <span class="mf">1</span><span class="p">),</span> <span class="nx">apples</span><span class="o">:</span>  <span class="mf">320</span><span class="p">,</span> <span class="nx">bananas</span><span class="o">:</span>  <span class="mf">480</span><span class="p">,</span> <span class="nx">cherries</span><span class="o">:</span> <span class="mf">640</span><span class="p">,</span> <span class="nx">dates</span><span class="o">:</span> <span class="mf">400</span><span class="p">}</span>
<span class="p">];</span>
</pre></div>
</div>
<p>To generate the stack layout, first define a stack generator, and then apply it to the data:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">stack</span> <span class="o">=</span> <span class="nx">d3</span><span class="p">.</span><span class="nx">stack</span><span class="p">()</span>
    <span class="p">.</span><span class="nx">keys</span><span class="p">([</span><span class="s2">&quot;apples&quot;</span><span class="p">,</span> <span class="s2">&quot;bananas&quot;</span><span class="p">,</span> <span class="s2">&quot;cherries&quot;</span><span class="p">,</span> <span class="s2">&quot;dates&quot;</span><span class="p">])</span>
    <span class="p">.</span><span class="nx">order</span><span class="p">(</span><span class="nx">d3</span><span class="p">.</span><span class="nx">stackOrderNone</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">offset</span><span class="p">(</span><span class="nx">d3</span><span class="p">.</span><span class="nx">stackOffsetNone</span><span class="p">);</span>

<span class="kd">var</span> <span class="nx">series</span> <span class="o">=</span> <span class="nx">stack</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
</pre></div>
</div>
<p>The resulting array has one element per <em>series</em>. Each series has one point per month, and each point has a lower and upper value defining the baseline and topline:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="p">[</span>
  <span class="p">[[</span>   <span class="mf">0</span><span class="p">,</span> <span class="mf">3840</span><span class="p">],</span> <span class="p">[</span>   <span class="mf">0</span><span class="p">,</span> <span class="mf">1600</span><span class="p">],</span> <span class="p">[</span>   <span class="mf">0</span><span class="p">,</span>  <span class="mf">640</span><span class="p">],</span> <span class="p">[</span>   <span class="mf">0</span><span class="p">,</span>  <span class="mf">320</span><span class="p">]],</span> <span class="c1">// apples</span>
  <span class="p">[[</span><span class="mf">3840</span><span class="p">,</span> <span class="mf">5760</span><span class="p">],</span> <span class="p">[</span><span class="mf">1600</span><span class="p">,</span> <span class="mf">3040</span><span class="p">],</span> <span class="p">[</span> <span class="mf">640</span><span class="p">,</span> <span class="mf">1600</span><span class="p">],</span> <span class="p">[</span> <span class="mf">320</span><span class="p">,</span>  <span class="mf">800</span><span class="p">]],</span> <span class="c1">// bananas</span>
  <span class="p">[[</span><span class="mf">5760</span><span class="p">,</span> <span class="mf">6720</span><span class="p">],</span> <span class="p">[</span><span class="mf">3040</span><span class="p">,</span> <span class="mf">4000</span><span class="p">],</span> <span class="p">[</span><span class="mf">1600</span><span class="p">,</span> <span class="mf">2240</span><span class="p">],</span> <span class="p">[</span> <span class="mf">800</span><span class="p">,</span> <span class="mf">1440</span><span class="p">]],</span> <span class="c1">// cherries</span>
  <span class="p">[[</span><span class="mf">6720</span><span class="p">,</span> <span class="mf">7120</span><span class="p">],</span> <span class="p">[</span><span class="mf">4000</span><span class="p">,</span> <span class="mf">4400</span><span class="p">],</span> <span class="p">[</span><span class="mf">2240</span><span class="p">,</span> <span class="mf">2640</span><span class="p">],</span> <span class="p">[</span><span class="mf">1440</span><span class="p">,</span> <span class="mf">1840</span><span class="p">]],</span> <span class="c1">// dates</span>
<span class="p">]</span>
</pre></div>
</div>
<p>Each series in then typically passed to an <a class="reference external" href="https://github.com/d3/d3-shape/blob/master/README.md#areas">area generator</a> to render an area chart, or used to construct rectangles for a bar chart. Stack generators no longer modify the input data, so <em>stack</em>.out has been removed.</p>
<p>For an introduction to shapes, see <a class="reference external" href="https://medium.com/&#64;mbostock/introducing-d3-shape-73f8367e6d12">Introducing d3-shape</a>.</p>
</div>
<div class="section" id="time-formats-d3-time-format">
<h2><a class="reference external" href="https://github.com/d3/d3-time-format/blob/master/README.md">Time Formats (d3-time-format)</a><a class="headerlink" href="#time-formats-d3-time-format" title="Permalink to this headline">¶</a></h2>
<p>Pursuant to the great namespace flattening, the format constructors have new names:</p>
<ul class="simple">
<li><p>d3.time.format ↦ <a class="reference external" href="https://github.com/d3/d3-time-format/blob/master/README.md#timeFormat">d3.timeFormat</a></p></li>
<li><p>d3.time.format.utc ↦ <a class="reference external" href="https://github.com/d3/d3-time-format/blob/master/README.md#utcFormat">d3.utcFormat</a></p></li>
<li><p>d3.time.format.iso ↦ <a class="reference external" href="https://github.com/d3/d3-time-format/blob/master/README.md#isoFormat">d3.isoFormat</a></p></li>
</ul>
<p>The <em>format</em>.parse method has also been removed in favor of separate <a class="reference external" href="https://github.com/d3/d3-time-format/blob/master/README.md#timeParse">d3.timeParse</a>, <a class="reference external" href="https://github.com/d3/d3-time-format/blob/master/README.md#utcParse">d3.utcParse</a> and <a class="reference external" href="https://github.com/d3/d3-time-format/blob/master/README.md#isoParse">d3.isoParse</a> parser constructors. Thus, this code in 3.x:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">parseTime</span> <span class="o">=</span> <span class="nx">d3</span><span class="p">.</span><span class="nx">time</span><span class="p">.</span><span class="nx">format</span><span class="p">(</span><span class="s2">&quot;%c&quot;</span><span class="p">).</span><span class="nx">parse</span><span class="p">;</span>
</pre></div>
</div>
<p>Can be rewritten in 4.0 as:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">parseTime</span> <span class="o">=</span> <span class="nx">d3</span><span class="p">.</span><span class="nx">timeParse</span><span class="p">(</span><span class="s2">&quot;%c&quot;</span><span class="p">);</span>
</pre></div>
</div>
<p>The multi-scale time format d3.time.format.multi has been replaced by <a class="reference external" href="https://github.com/d3/d3-scale/blob/master/README.md#scaleTime">d3.scaleTime</a>’s <a class="reference external" href="https://github.com/d3/d3-scale/blob/master/README.md#time_tickFormat">tick format</a>. Time formats now coerce inputs to dates, and time parsers coerce inputs to strings. The <code class="docutils literal notranslate"><span class="pre">%Z</span></code> directive now allows more flexible parsing of time zone offsets, such as <code class="docutils literal notranslate"><span class="pre">-0700</span></code>, <code class="docutils literal notranslate"><span class="pre">-07:00</span></code>, <code class="docutils literal notranslate"><span class="pre">-07</span></code>, and <code class="docutils literal notranslate"><span class="pre">Z</span></code>. The <code class="docutils literal notranslate"><span class="pre">%p</span></code> directive is now parsed correctly when the locale’s period name is longer than two characters (<em>e.g.</em>, “a.m.”).</p>
<p>The default U.S. English locale now uses 12-hour time and a more concise representation of the date. This aligns with local convention and is consistent with <a class="reference external" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Date/toLocaleString"><em>date</em>.toLocaleString</a> in Chrome, Firefox and Node:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">now</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">;</span>
<span class="nx">d3</span><span class="p">.</span><span class="nx">timeFormat</span><span class="p">(</span><span class="s2">&quot;%c&quot;</span><span class="p">)(</span><span class="k">new</span> <span class="nb">Date</span><span class="p">);</span> <span class="c1">// &quot;6/23/2016, 2:01:33 PM&quot;</span>
<span class="nx">d3</span><span class="p">.</span><span class="nx">timeFormat</span><span class="p">(</span><span class="s2">&quot;%x&quot;</span><span class="p">)(</span><span class="k">new</span> <span class="nb">Date</span><span class="p">);</span> <span class="c1">// &quot;6/23/2016&quot;</span>
<span class="nx">d3</span><span class="p">.</span><span class="nx">timeFormat</span><span class="p">(</span><span class="s2">&quot;%X&quot;</span><span class="p">)(</span><span class="k">new</span> <span class="nb">Date</span><span class="p">);</span> <span class="c1">// &quot;2:01:38 PM&quot;</span>
</pre></div>
</div>
<p>You can now set the default locale using <a class="reference external" href="https://github.com/d3/d3-time-format/blob/master/README.md#timeFormatDefaultLocale">d3.timeFormatDefaultLocale</a>! The locales are published as <a class="reference external" href="https://github.com/d3/d3-request/blob/master/README.md#json">JSON</a> to <a class="reference external" href="https://unpkg.com/d3-time-format/locale/">npm</a>.</p>
<p>The performance of time formatting and parsing has been improved, and the UTC formatter and parser have a cleaner implementation (that avoids temporarily overriding the Date global).</p>
</div>
<div class="section" id="time-intervals-d3-time">
<h2><a class="reference external" href="https://github.com/d3/d3-time/blob/master/README.md">Time Intervals (d3-time)</a><a class="headerlink" href="#time-intervals-d3-time" title="Permalink to this headline">¶</a></h2>
<p>Pursuant to the great namespace flattening, the local time intervals have been renamed:</p>
<ul class="simple">
<li><p>ADDED ↦ <a class="reference external" href="https://github.com/d3/d3-time/blob/master/README.md#timeMillisecond">d3.timeMillisecond</a></p></li>
<li><p>d3.time.second ↦ <a class="reference external" href="https://github.com/d3/d3-time/blob/master/README.md#timeSecond">d3.timeSecond</a></p></li>
<li><p>d3.time.minute ↦ <a class="reference external" href="https://github.com/d3/d3-time/blob/master/README.md#timeMinute">d3.timeMinute</a></p></li>
<li><p>d3.time.hour ↦ <a class="reference external" href="https://github.com/d3/d3-time/blob/master/README.md#timeHour">d3.timeHour</a></p></li>
<li><p>d3.time.day ↦ <a class="reference external" href="https://github.com/d3/d3-time/blob/master/README.md#timeDay">d3.timeDay</a></p></li>
<li><p>d3.time.sunday ↦ <a class="reference external" href="https://github.com/d3/d3-time/blob/master/README.md#timeSunday">d3.timeSunday</a></p></li>
<li><p>d3.time.monday ↦ <a class="reference external" href="https://github.com/d3/d3-time/blob/master/README.md#timeMonday">d3.timeMonday</a></p></li>
<li><p>d3.time.tuesday ↦ <a class="reference external" href="https://github.com/d3/d3-time/blob/master/README.md#timeTuesday">d3.timeTuesday</a></p></li>
<li><p>d3.time.wednesday ↦ <a class="reference external" href="https://github.com/d3/d3-time/blob/master/README.md#timeWednesday">d3.timeWednesday</a></p></li>
<li><p>d3.time.thursday ↦ <a class="reference external" href="https://github.com/d3/d3-time/blob/master/README.md#timeThursday">d3.timeThursday</a></p></li>
<li><p>d3.time.friday ↦ <a class="reference external" href="https://github.com/d3/d3-time/blob/master/README.md#timeFriday">d3.timeFriday</a></p></li>
<li><p>d3.time.saturday ↦ <a class="reference external" href="https://github.com/d3/d3-time/blob/master/README.md#timeSaturday">d3.timeSaturday</a></p></li>
<li><p>d3.time.week ↦ <a class="reference external" href="https://github.com/d3/d3-time/blob/master/README.md#timeWeek">d3.timeWeek</a></p></li>
<li><p>d3.time.month ↦ <a class="reference external" href="https://github.com/d3/d3-time/blob/master/README.md#timeMonth">d3.timeMonth</a></p></li>
<li><p>d3.time.year ↦ <a class="reference external" href="https://github.com/d3/d3-time/blob/master/README.md#timeYear">d3.timeYear</a></p></li>
</ul>
<p>The UTC time intervals have likewise been renamed:</p>
<ul class="simple">
<li><p>ADDED ↦ <a class="reference external" href="https://github.com/d3/d3-time/blob/master/README.md#utcMillisecond">d3.utcMillisecond</a></p></li>
<li><p>d3.time.second.utc ↦ <a class="reference external" href="https://github.com/d3/d3-time/blob/master/README.md#utcSecond">d3.utcSecond</a></p></li>
<li><p>d3.time.minute.utc ↦ <a class="reference external" href="https://github.com/d3/d3-time/blob/master/README.md#utcMinute">d3.utcMinute</a></p></li>
<li><p>d3.time.hour.utc ↦ <a class="reference external" href="https://github.com/d3/d3-time/blob/master/README.md#utcHour">d3.utcHour</a></p></li>
<li><p>d3.time.day.utc ↦ <a class="reference external" href="https://github.com/d3/d3-time/blob/master/README.md#utcDay">d3.utcDay</a></p></li>
<li><p>d3.time.sunday.utc ↦ <a class="reference external" href="https://github.com/d3/d3-time/blob/master/README.md#utcSunday">d3.utcSunday</a></p></li>
<li><p>d3.time.monday.utc ↦ <a class="reference external" href="https://github.com/d3/d3-time/blob/master/README.md#utcMonday">d3.utcMonday</a></p></li>
<li><p>d3.time.tuesday.utc ↦ <a class="reference external" href="https://github.com/d3/d3-time/blob/master/README.md#utcTuesday">d3.utcTuesday</a></p></li>
<li><p>d3.time.wednesday.utc ↦ <a class="reference external" href="https://github.com/d3/d3-time/blob/master/README.md#utcWednesday">d3.utcWednesday</a></p></li>
<li><p>d3.time.thursday.utc ↦ <a class="reference external" href="https://github.com/d3/d3-time/blob/master/README.md#utcThursday">d3.utcThursday</a></p></li>
<li><p>d3.time.friday.utc ↦ <a class="reference external" href="https://github.com/d3/d3-time/blob/master/README.md#utcFriday">d3.utcFriday</a></p></li>
<li><p>d3.time.saturday.utc ↦ <a class="reference external" href="https://github.com/d3/d3-time/blob/master/README.md#utcSaturday">d3.utcSaturday</a></p></li>
<li><p>d3.time.week.utc ↦ <a class="reference external" href="https://github.com/d3/d3-time/blob/master/README.md#utcWeek">d3.utcWeek</a></p></li>
<li><p>d3.time.month.utc ↦ <a class="reference external" href="https://github.com/d3/d3-time/blob/master/README.md#utcMonth">d3.utcMonth</a></p></li>
<li><p>d3.time.year.utc ↦ <a class="reference external" href="https://github.com/d3/d3-time/blob/master/README.md#utcYear">d3.utcYear</a></p></li>
</ul>
<p>The local time range aliases have been renamed:</p>
<ul class="simple">
<li><p>d3.time.seconds ↦ <a class="reference external" href="https://github.com/d3/d3-time/blob/master/README.md#timeSeconds">d3.timeSeconds</a></p></li>
<li><p>d3.time.minutes ↦ <a class="reference external" href="https://github.com/d3/d3-time/blob/master/README.md#timeMinutes">d3.timeMinutes</a></p></li>
<li><p>d3.time.hours ↦ <a class="reference external" href="https://github.com/d3/d3-time/blob/master/README.md#timeHours">d3.timeHours</a></p></li>
<li><p>d3.time.days ↦ <a class="reference external" href="https://github.com/d3/d3-time/blob/master/README.md#timeDays">d3.timeDays</a></p></li>
<li><p>d3.time.sundays ↦ <a class="reference external" href="https://github.com/d3/d3-time/blob/master/README.md#timeSundays">d3.timeSundays</a></p></li>
<li><p>d3.time.mondays ↦ <a class="reference external" href="https://github.com/d3/d3-time/blob/master/README.md#timeMondays">d3.timeMondays</a></p></li>
<li><p>d3.time.tuesdays ↦ <a class="reference external" href="https://github.com/d3/d3-time/blob/master/README.md#timeTuesdays">d3.timeTuesdays</a></p></li>
<li><p>d3.time.wednesdays ↦ <a class="reference external" href="https://github.com/d3/d3-time/blob/master/README.md#timeWednesdays">d3.timeWednesdays</a></p></li>
<li><p>d3.time.thursdays ↦ <a class="reference external" href="https://github.com/d3/d3-time/blob/master/README.md#timeThursdays">d3.timeThursdays</a></p></li>
<li><p>d3.time.fridays ↦ <a class="reference external" href="https://github.com/d3/d3-time/blob/master/README.md#timeFridays">d3.timeFridays</a></p></li>
<li><p>d3.time.saturdays ↦ <a class="reference external" href="https://github.com/d3/d3-time/blob/master/README.md#timeSaturdays">d3.timeSaturdays</a></p></li>
<li><p>d3.time.weeks ↦ <a class="reference external" href="https://github.com/d3/d3-time/blob/master/README.md#timeWeeks">d3.timeWeeks</a></p></li>
<li><p>d3.time.months ↦ <a class="reference external" href="https://github.com/d3/d3-time/blob/master/README.md#timeMonths">d3.timeMonths</a></p></li>
<li><p>d3.time.years ↦ <a class="reference external" href="https://github.com/d3/d3-time/blob/master/README.md#timeYears">d3.timeYears</a></p></li>
</ul>
<p>The UTC time range aliases have been renamed:</p>
<ul class="simple">
<li><p>d3.time.seconds.utc ↦ <a class="reference external" href="https://github.com/d3/d3-time/blob/master/README.md#utcSeconds">d3.utcSeconds</a></p></li>
<li><p>d3.time.minutes.utc ↦ <a class="reference external" href="https://github.com/d3/d3-time/blob/master/README.md#utcMinutes">d3.utcMinutes</a></p></li>
<li><p>d3.time.hours.utc ↦ <a class="reference external" href="https://github.com/d3/d3-time/blob/master/README.md#utcHours">d3.utcHours</a></p></li>
<li><p>d3.time.days.utc ↦ <a class="reference external" href="https://github.com/d3/d3-time/blob/master/README.md#utcDays">d3.utcDays</a></p></li>
<li><p>d3.time.sundays.utc ↦ <a class="reference external" href="https://github.com/d3/d3-time/blob/master/README.md#utcSundays">d3.utcSundays</a></p></li>
<li><p>d3.time.mondays.utc ↦ <a class="reference external" href="https://github.com/d3/d3-time/blob/master/README.md#utcMondays">d3.utcMondays</a></p></li>
<li><p>d3.time.tuesdays.utc ↦ <a class="reference external" href="https://github.com/d3/d3-time/blob/master/README.md#utcTuesdays">d3.utcTuesdays</a></p></li>
<li><p>d3.time.wednesdays.utc ↦ <a class="reference external" href="https://github.com/d3/d3-time/blob/master/README.md#utcWednesdays">d3.utcWednesdays</a></p></li>
<li><p>d3.time.thursdays.utc ↦ <a class="reference external" href="https://github.com/d3/d3-time/blob/master/README.md#utcThursdays">d3.utcThursdays</a></p></li>
<li><p>d3.time.fridays.utc ↦ <a class="reference external" href="https://github.com/d3/d3-time/blob/master/README.md#utcFridays">d3.utcFridays</a></p></li>
<li><p>d3.time.saturdays.utc ↦ <a class="reference external" href="https://github.com/d3/d3-time/blob/master/README.md#utcSaturdays">d3.utcSaturdays</a></p></li>
<li><p>d3.time.weeks.utc ↦ <a class="reference external" href="https://github.com/d3/d3-time/blob/master/README.md#utcWeeks">d3.utcWeeks</a></p></li>
<li><p>d3.time.months.utc ↦ <a class="reference external" href="https://github.com/d3/d3-time/blob/master/README.md#utcMonths">d3.utcMonths</a></p></li>
<li><p>d3.time.years.utc ↦ <a class="reference external" href="https://github.com/d3/d3-time/blob/master/README.md#utcYears">d3.utcYears</a></p></li>
</ul>
<p>The behavior of <a class="reference external" href="https://github.com/d3/d3-time/blob/master/README.md#interval_range"><em>interval</em>.range</a> (and the convenience aliases such as <a class="reference external" href="https://github.com/d3/d3-time/blob/master/README.md#timeDays">d3.timeDays</a>) has been changed when <em>step</em> is greater than one. Rather than filtering the returned dates using the field number, <em>interval</em>.range now behaves like <a class="reference external" href="https://github.com/d3/d3-array/blob/master/README.md#range">d3.range</a>: it simply skips, returning every <em>step</em>th date. For example, the following code in 3.x returns only odd days of the month:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="nx">d3</span><span class="p">.</span><span class="nx">time</span><span class="p">.</span><span class="nx">days</span><span class="p">(</span><span class="k">new</span> <span class="nb">Date</span><span class="p">(</span><span class="mf">2016</span><span class="p">,</span> <span class="mf">4</span><span class="p">,</span> <span class="mf">28</span><span class="p">),</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">(</span><span class="mf">2016</span><span class="p">,</span> <span class="mf">5</span><span class="p">,</span> <span class="mf">5</span><span class="p">),</span> <span class="mf">2</span><span class="p">);</span>
<span class="c1">// [Sun May 29 2016 00:00:00 GMT-0700 (PDT),</span>
<span class="c1">//  Tue May 31 2016 00:00:00 GMT-0700 (PDT),</span>
<span class="c1">//  Wed Jun 01 2016 00:00:00 GMT-0700 (PDT),</span>
<span class="c1">//  Fri Jun 03 2016 00:00:00 GMT-0700 (PDT)]</span>
</pre></div>
</div>
<p>Note the returned array of dates does not start on the <em>start</em> date because May 28 is even. Also note that May 31 and June 1 are one day apart, not two! The behavior of d3.timeDays in 4.0 is probably closer to what you expect:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="nx">d3</span><span class="p">.</span><span class="nx">timeDays</span><span class="p">(</span><span class="k">new</span> <span class="nb">Date</span><span class="p">(</span><span class="mf">2016</span><span class="p">,</span> <span class="mf">4</span><span class="p">,</span> <span class="mf">28</span><span class="p">),</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">(</span><span class="mf">2016</span><span class="p">,</span> <span class="mf">5</span><span class="p">,</span> <span class="mf">5</span><span class="p">),</span> <span class="mf">2</span><span class="p">);</span>
<span class="c1">// [Sat May 28 2016 00:00:00 GMT-0700 (PDT),</span>
<span class="c1">//  Mon May 30 2016 00:00:00 GMT-0700 (PDT),</span>
<span class="c1">//  Wed Jun 01 2016 00:00:00 GMT-0700 (PDT),</span>
<span class="c1">//  Fri Jun 03 2016 00:00:00 GMT-0700 (PDT)]</span>
</pre></div>
</div>
<p>If you want a filtered view of a time interval (say to guarantee that two overlapping ranges are consistent, such as when generating <a class="reference external" href="https://github.com/d3/d3-scale/blob/master/README.md#time_ticks">time scale ticks</a>), you can use the new <a class="reference external" href="https://github.com/d3/d3-time/blob/master/README.md#interval_every"><em>interval</em>.every</a> method or its more general cousin <a class="reference external" href="https://github.com/d3/d3-time/blob/master/README.md#interval_filter"><em>interval</em>.filter</a>:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="nx">d3</span><span class="p">.</span><span class="nx">timeDay</span><span class="p">.</span><span class="nx">every</span><span class="p">(</span><span class="mf">2</span><span class="p">).</span><span class="nx">range</span><span class="p">(</span><span class="k">new</span> <span class="nb">Date</span><span class="p">(</span><span class="mf">2016</span><span class="p">,</span> <span class="mf">4</span><span class="p">,</span> <span class="mf">28</span><span class="p">),</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">(</span><span class="mf">2016</span><span class="p">,</span> <span class="mf">5</span><span class="p">,</span> <span class="mf">5</span><span class="p">));</span>
<span class="c1">// [Sun May 29 2016 00:00:00 GMT-0700 (PDT),</span>
<span class="c1">//  Tue May 31 2016 00:00:00 GMT-0700 (PDT),</span>
<span class="c1">//  Wed Jun 01 2016 00:00:00 GMT-0700 (PDT),</span>
<span class="c1">//  Fri Jun 03 2016 00:00:00 GMT-0700 (PDT)]</span>
</pre></div>
</div>
<p>Time intervals now expose an <a class="reference external" href="https://github.com/d3/d3-time/blob/master/README.md#interval_count"><em>interval</em>.count</a> method for counting the number of interval boundaries after a <em>start</em> date and before or equal to an <em>end</em> date. This replaces d3.time.dayOfYear and related methods in 3.x. For example, this code in 3.x:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">now</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">;</span>
<span class="nx">d3</span><span class="p">.</span><span class="nx">time</span><span class="p">.</span><span class="nx">dayOfYear</span><span class="p">(</span><span class="nx">now</span><span class="p">);</span> <span class="c1">// 165</span>
</pre></div>
</div>
<p>Can be rewritten in 4.0 as:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">now</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">;</span>
<span class="nx">d3</span><span class="p">.</span><span class="nx">timeDay</span><span class="p">.</span><span class="nx">count</span><span class="p">(</span><span class="nx">d3</span><span class="p">.</span><span class="nx">timeYear</span><span class="p">(</span><span class="nx">now</span><span class="p">),</span> <span class="nx">now</span><span class="p">);</span> <span class="c1">// 165</span>
</pre></div>
</div>
<p>Likewise, in place of 3.x’s d3.time.weekOfYear, in 4.0 you would say:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="nx">d3</span><span class="p">.</span><span class="nx">timeWeek</span><span class="p">.</span><span class="nx">count</span><span class="p">(</span><span class="nx">d3</span><span class="p">.</span><span class="nx">timeYear</span><span class="p">(</span><span class="nx">now</span><span class="p">),</span> <span class="nx">now</span><span class="p">);</span> <span class="c1">// 24</span>
</pre></div>
</div>
<p>The new <em>interval</em>.count is of course more general. For example, you can use it to compute hour-of-week for a heatmap:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="nx">d3</span><span class="p">.</span><span class="nx">timeHour</span><span class="p">.</span><span class="nx">count</span><span class="p">(</span><span class="nx">d3</span><span class="p">.</span><span class="nx">timeWeek</span><span class="p">(</span><span class="nx">now</span><span class="p">),</span> <span class="nx">now</span><span class="p">);</span> <span class="c1">// 64</span>
</pre></div>
</div>
<p>Here are all the equivalences from 3.x to 4.0:</p>
<ul class="simple">
<li><p>d3.time.dayOfYear ↦ <a class="reference external" href="https://github.com/d3/d3-time/blob/master/README.md#timeDay">d3.timeDay</a>.<a class="reference external" href="https://github.com/d3/d3-time/blob/master/README.md#interval_count">count</a></p></li>
<li><p>d3.time.sundayOfYear ↦ <a class="reference external" href="https://github.com/d3/d3-time/blob/master/README.md#timeSunday">d3.timeSunday</a>.<a class="reference external" href="https://github.com/d3/d3-time/blob/master/README.md#interval_count">count</a></p></li>
<li><p>d3.time.mondayOfYear ↦ <a class="reference external" href="https://github.com/d3/d3-time/blob/master/README.md#timeMonday">d3.timeMonday</a>.<a class="reference external" href="https://github.com/d3/d3-time/blob/master/README.md#interval_count">count</a></p></li>
<li><p>d3.time.tuesdayOfYear ↦ <a class="reference external" href="https://github.com/d3/d3-time/blob/master/README.md#timeTuesday">d3.timeTuesday</a>.<a class="reference external" href="https://github.com/d3/d3-time/blob/master/README.md#interval_count">count</a></p></li>
<li><p>d3.time.wednesdayOfYear ↦ <a class="reference external" href="https://github.com/d3/d3-time/blob/master/README.md#timeWednesday">d3.timeWednesday</a>.<a class="reference external" href="https://github.com/d3/d3-time/blob/master/README.md#interval_count">count</a></p></li>
<li><p>d3.time.thursdayOfYear ↦ <a class="reference external" href="https://github.com/d3/d3-time/blob/master/README.md#timeThursday">d3.timeThursday</a>.<a class="reference external" href="https://github.com/d3/d3-time/blob/master/README.md#interval_count">count</a></p></li>
<li><p>d3.time.fridayOfYear ↦ <a class="reference external" href="https://github.com/d3/d3-time/blob/master/README.md#timeFriday">d3.timeFriday</a>.<a class="reference external" href="https://github.com/d3/d3-time/blob/master/README.md#interval_count">count</a></p></li>
<li><p>d3.time.saturdayOfYear ↦ <a class="reference external" href="https://github.com/d3/d3-time/blob/master/README.md#timeSaturday">d3.timeSaturday</a>.<a class="reference external" href="https://github.com/d3/d3-time/blob/master/README.md#interval_count">count</a></p></li>
<li><p>d3.time.weekOfYear ↦ <a class="reference external" href="https://github.com/d3/d3-time/blob/master/README.md#timeWeek">d3.timeWeek</a>.<a class="reference external" href="https://github.com/d3/d3-time/blob/master/README.md#interval_count">count</a></p></li>
<li><p>d3.time.dayOfYear.utc ↦ <a class="reference external" href="https://github.com/d3/d3-time/blob/master/README.md#utcDay">d3.utcDay</a>.<a class="reference external" href="https://github.com/d3/d3-time/blob/master/README.md#interval_count">count</a></p></li>
<li><p>d3.time.sundayOfYear.utc ↦ <a class="reference external" href="https://github.com/d3/d3-time/blob/master/README.md#utcSunday">d3.utcSunday</a>.<a class="reference external" href="https://github.com/d3/d3-time/blob/master/README.md#interval_count">count</a></p></li>
<li><p>d3.time.mondayOfYear.utc ↦ <a class="reference external" href="https://github.com/d3/d3-time/blob/master/README.md#utcMonday">d3.utcMonday</a>.<a class="reference external" href="https://github.com/d3/d3-time/blob/master/README.md#interval_count">count</a></p></li>
<li><p>d3.time.tuesdayOfYear.utc ↦ <a class="reference external" href="https://github.com/d3/d3-time/blob/master/README.md#utcTuesday">d3.utcTuesday</a>.<a class="reference external" href="https://github.com/d3/d3-time/blob/master/README.md#interval_count">count</a></p></li>
<li><p>d3.time.wednesdayOfYear.utc ↦ <a class="reference external" href="https://github.com/d3/d3-time/blob/master/README.md#utcWednesday">d3.utcWednesday</a>.<a class="reference external" href="https://github.com/d3/d3-time/blob/master/README.md#interval_count">count</a></p></li>
<li><p>d3.time.thursdayOfYear.utc ↦ <a class="reference external" href="https://github.com/d3/d3-time/blob/master/README.md#utcThursday">d3.utcThursday</a>.<a class="reference external" href="https://github.com/d3/d3-time/blob/master/README.md#interval_count">count</a></p></li>
<li><p>d3.time.fridayOfYear.utc ↦ <a class="reference external" href="https://github.com/d3/d3-time/blob/master/README.md#utcFriday">d3.utcFriday</a>.<a class="reference external" href="https://github.com/d3/d3-time/blob/master/README.md#interval_count">count</a></p></li>
<li><p>d3.time.saturdayOfYear.utc ↦ <a class="reference external" href="https://github.com/d3/d3-time/blob/master/README.md#utcSaturday">d3.utcSaturday</a>.<a class="reference external" href="https://github.com/d3/d3-time/blob/master/README.md#interval_count">count</a></p></li>
<li><p>d3.time.weekOfYear.utc ↦ <a class="reference external" href="https://github.com/d3/d3-time/blob/master/README.md#utcWeek">d3.utcWeek</a>.<a class="reference external" href="https://github.com/d3/d3-time/blob/master/README.md#interval_count">count</a></p></li>
</ul>
<p>D3 4.0 now also lets you define custom time intervals using <a class="reference external" href="https://github.com/d3/d3-time/blob/master/README.md#timeInterval">d3.timeInterval</a>. The <a class="reference external" href="https://github.com/d3/d3-time/blob/master/README.md#timeYear">d3.timeYear</a>, <a class="reference external" href="https://github.com/d3/d3-time/blob/master/README.md#utcYear">d3.utcYear</a>, <a class="reference external" href="https://github.com/d3/d3-time/blob/master/README.md#timeMillisecond">d3.timeMillisecond</a> and <a class="reference external" href="https://github.com/d3/d3-time/blob/master/README.md#utcMillisecond">d3.utcMillisecond</a> intervals have optimized implementations of <a class="reference external" href="https://github.com/d3/d3-time/blob/master/README.md#interval_every"><em>interval</em>.every</a>, which is necessary to generate time ticks for very large or very small domains efficiently. More generally, the performance of time intervals has been improved, and time intervals now do a better job with respect to daylight savings in various locales.</p>
</div>
<div class="section" id="timers-d3-timer">
<h2><a class="reference external" href="https://github.com/d3/d3-timer/blob/master/README.md">Timers (d3-timer)</a><a class="headerlink" href="#timers-d3-timer" title="Permalink to this headline">¶</a></h2>
<p>In D3 3.x, the only way to stop a timer was for its callback to return true. For example, this timer stops after one second:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="nx">d3</span><span class="p">.</span><span class="nx">timer</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">elapsed</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">elapsed</span><span class="p">);</span>
  <span class="k">return</span> <span class="nx">elapsed</span> <span class="o">&gt;=</span> <span class="mf">1000</span><span class="p">;</span>
<span class="p">});</span>
</pre></div>
</div>
<p>In 4.0, use <a class="reference external" href="https://github.com/d3/d3-timer/blob/master/README.md#timer_stop"><em>timer</em>.stop</a> instead:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">t</span> <span class="o">=</span> <span class="nx">d3</span><span class="p">.</span><span class="nx">timer</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">elapsed</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">elapsed</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">elapsed</span> <span class="o">&gt;=</span> <span class="mf">1000</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">t</span><span class="p">.</span><span class="nx">stop</span><span class="p">();</span>
  <span class="p">}</span>
<span class="p">});</span>
</pre></div>
</div>
<p>The primary benefit of <em>timer</em>.stop is that timers are not required to self-terminate: they can be stopped externally, allowing for the immediate and synchronous disposal of associated resources, and the separation of concerns. The above is equivalent to:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">t</span> <span class="o">=</span> <span class="nx">d3</span><span class="p">.</span><span class="nx">timer</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">elapsed</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">elapsed</span><span class="p">);</span>
<span class="p">});</span>

<span class="nx">d3</span><span class="p">.</span><span class="nx">timeout</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="nx">t</span><span class="p">.</span><span class="nx">stop</span><span class="p">();</span>
<span class="p">},</span> <span class="mf">1000</span><span class="p">);</span>
</pre></div>
</div>
<p>This improvement extends to <a class="reference external" href="#transitions-d3-transition">d3-transition</a>: now when a transition is interrupted, its resources are immediately freed rather than having to wait for transition to start.</p>
<p>4.0 also introduces a new <a class="reference external" href="https://github.com/d3/d3-timer/blob/master/README.md#timer_restart"><em>timer</em>.restart</a> method for restarting timers, for replacing the callback of a running timer, or for changing its delay or reference time. Unlike <em>timer</em>.stop followed by <a class="reference external" href="https://github.com/d3/d3-timer/blob/master/README.md#timer">d3.timer</a>, <em>timer</em>.restart maintains the invocation priority of an existing timer: it guarantees that the order of invocation of active timers remains the same. The d3.timer.flush method has been renamed to <a class="reference external" href="https://github.com/d3/d3-timer/blob/master/README.md#timerFlush">d3.timerFlush</a>.</p>
<p>Some usage patterns in D3 3.x could cause the browser to hang when a background page returned to the foreground. For example, the following code schedules a transition every second:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="nx">setInterval</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="nx">d3</span><span class="p">.</span><span class="nx">selectAll</span><span class="p">(</span><span class="s2">&quot;div&quot;</span><span class="p">).</span><span class="nx">transition</span><span class="p">().</span><span class="nx">call</span><span class="p">(</span><span class="nx">someAnimation</span><span class="p">);</span> <span class="c1">// BAD</span>
<span class="p">},</span> <span class="mf">1000</span><span class="p">);</span>
</pre></div>
</div>
<p>If such code runs in the background for hours, thousands of queued transitions will try to run simultaneously when the page is foregrounded. D3 4.0 avoids this hang by freezing time in the background: when a page is in the background, time does not advance, and so no queue of timers accumulates to run when the page returns to the foreground. Use d3.timer instead of transitions to schedule a long-running animation, or use <a class="reference external" href="https://github.com/d3/d3-timer/blob/master/README.md#timeout">d3.timeout</a> and <a class="reference external" href="https://github.com/d3/d3-timer/blob/master/README.md#interval">d3.interval</a> in place of setTimeout and setInterval to prevent transitions from being queued in the background:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="nx">d3</span><span class="p">.</span><span class="nx">interval</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="nx">d3</span><span class="p">.</span><span class="nx">selectAll</span><span class="p">(</span><span class="s2">&quot;div&quot;</span><span class="p">).</span><span class="nx">transition</span><span class="p">().</span><span class="nx">call</span><span class="p">(</span><span class="nx">someAnimation</span><span class="p">);</span> <span class="c1">// GOOD</span>
<span class="p">},</span> <span class="mf">1000</span><span class="p">);</span>
</pre></div>
</div>
<p>By freezing time in the background, timers are effectively “unaware” of being backgrounded. It’s like nothing happened! 4.0 also now uses high-precision time (<a class="reference external" href="https://developer.mozilla.org/en-US/docs/Web/API/Performance/now">performance.now</a>) where available; the current time is available as <a class="reference external" href="https://github.com/d3/d3-timer/blob/master/README.md#now">d3.now</a>.</p>
</div>
<div class="section" id="transitions-d3-transition">
<h2><a class="reference external" href="https://github.com/d3/d3-transition/blob/master/README.md">Transitions (d3-transition)</a><a class="headerlink" href="#transitions-d3-transition" title="Permalink to this headline">¶</a></h2>
<p>The <a class="reference external" href="https://github.com/d3/d3-transition/blob/master/README.md#selection_transition"><em>selection</em>.transition</a> method now takes an optional <em>transition</em> instance which can be used to synchronize a new transition with an existing transition. (This change is discussed further in <a class="reference external" href="https://medium.com/&#64;mbostock/what-makes-software-good-943557f8a488">What Makes Software Good?</a>) For example:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">t</span> <span class="o">=</span> <span class="nx">d3</span><span class="p">.</span><span class="nx">transition</span><span class="p">()</span>
    <span class="p">.</span><span class="nx">duration</span><span class="p">(</span><span class="mf">750</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">ease</span><span class="p">(</span><span class="nx">d3</span><span class="p">.</span><span class="nx">easeLinear</span><span class="p">);</span>

<span class="nx">d3</span><span class="p">.</span><span class="nx">selectAll</span><span class="p">(</span><span class="s2">&quot;.apple&quot;</span><span class="p">).</span><span class="nx">transition</span><span class="p">(</span><span class="nx">t</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">style</span><span class="p">(</span><span class="s2">&quot;fill&quot;</span><span class="p">,</span> <span class="s2">&quot;red&quot;</span><span class="p">);</span>

<span class="nx">d3</span><span class="p">.</span><span class="nx">selectAll</span><span class="p">(</span><span class="s2">&quot;.orange&quot;</span><span class="p">).</span><span class="nx">transition</span><span class="p">(</span><span class="nx">t</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">style</span><span class="p">(</span><span class="s2">&quot;fill&quot;</span><span class="p">,</span> <span class="s2">&quot;orange&quot;</span><span class="p">);</span>
</pre></div>
</div>
<p>Transitions created this way inherit timing from the closest ancestor element, and thus are synchronized even when the referenced <em>transition</em> has variable timing such as a staggered delay. This method replaces the deeply magical behavior of <em>transition</em>.each in 3.x; in 4.0, <a class="reference external" href="https://github.com/d3/d3-transition/blob/master/README.md#transition_each"><em>transition</em>.each</a> is identical to <a class="reference external" href="https://github.com/d3/d3-selection/blob/master/README.md#selection_each"><em>selection</em>.each</a>. Use the new <a class="reference external" href="https://github.com/d3/d3-transition/blob/master/README.md#transition_on"><em>transition</em>.on</a> method to listen to transition events.</p>
<p>The meaning of <a class="reference external" href="https://github.com/d3/d3-transition/blob/master/README.md#transition_delay"><em>transition</em>.delay</a> has changed for chained transitions created by <a class="reference external" href="https://github.com/d3/d3-transition/blob/master/README.md#transition_transition"><em>transition</em>.transition</a>. The specified delay is now relative to the <em>previous</em> transition in the chain, rather than the <em>first</em> transition in the chain; this makes it easier to insert interstitial pauses. For example:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="nx">d3</span><span class="p">.</span><span class="nx">selectAll</span><span class="p">(</span><span class="s2">&quot;.apple&quot;</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">transition</span><span class="p">()</span> <span class="c1">// First fade to green.</span>
    <span class="p">.</span><span class="nx">style</span><span class="p">(</span><span class="s2">&quot;fill&quot;</span><span class="p">,</span> <span class="s2">&quot;green&quot;</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">transition</span><span class="p">()</span> <span class="c1">// Then red.</span>
    <span class="p">.</span><span class="nx">style</span><span class="p">(</span><span class="s2">&quot;fill&quot;</span><span class="p">,</span> <span class="s2">&quot;red&quot;</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">transition</span><span class="p">()</span> <span class="c1">// Wait one second. Then brown, and remove.</span>
    <span class="p">.</span><span class="nx">delay</span><span class="p">(</span><span class="mf">1000</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">style</span><span class="p">(</span><span class="s2">&quot;fill&quot;</span><span class="p">,</span> <span class="s2">&quot;brown&quot;</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">remove</span><span class="p">();</span>
</pre></div>
</div>
<p>Time is now frozen in the background; see <a class="reference external" href="#timers-d3-timer">d3-timer</a> for more information. While it was previously the case that transitions did not run in the background, now they pick up where they left off when the page returns to the foreground. This avoids page hangs by not scheduling an unbounded number of transitions in the background. If you want to schedule an infinitely-repeating transition, use transition events, or use <a class="reference external" href="https://github.com/d3/d3-timer/blob/master/README.md#timeout">d3.timeout</a> and <a class="reference external" href="https://github.com/d3/d3-timer/blob/master/README.md#interval">d3.interval</a> in place of <a class="reference external" href="https://developer.mozilla.org/en-US/docs/Web/API/WindowTimers/setTimeout">setTimeout</a> and <a class="reference external" href="https://developer.mozilla.org/en-US/docs/Web/API/WindowTimers/setInterval">setInterval</a>.</p>
<p>The <a class="reference external" href="https://github.com/d3/d3-transition/blob/master/README.md#selection_interrupt"><em>selection</em>.interrupt</a> method now cancels all scheduled transitions on the selected elements, in addition to interrupting any active transition. When transitions are interrupted, any resources associated with the transition are now released immediately, rather than waiting until the transition starts, improving performance. (See also <a class="reference external" href="https://github.com/d3/d3-timer/blob/master/README.md#timer_stop"><em>timer</em>.stop</a>.) The new <a class="reference external" href="https://github.com/d3/d3-transition/blob/master/README.md#interrupt">d3.interrupt</a> method is an alternative to <a class="reference external" href="https://github.com/d3/d3-transition/blob/master/README.md#selection_interrupt"><em>selection</em>.interrupt</a> for quickly interrupting a single node.</p>
<p>The new <a class="reference external" href="https://github.com/d3/d3-transition/blob/master/README.md#active">d3.active</a> method allows you to select the currently-active transition on a given <em>node</em>, if any. This is useful for modifying in-progress transitions and for scheduling infinitely-repeating transitions. For example, this transition continuously oscillates between red and blue:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="nx">d3</span><span class="p">.</span><span class="nx">select</span><span class="p">(</span><span class="s2">&quot;circle&quot;</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">transition</span><span class="p">()</span>
    <span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;start&quot;</span><span class="p">,</span> <span class="kd">function</span> <span class="nx">repeat</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">d3</span><span class="p">.</span><span class="nx">active</span><span class="p">(</span><span class="k">this</span><span class="p">)</span>
            <span class="p">.</span><span class="nx">style</span><span class="p">(</span><span class="s2">&quot;fill&quot;</span><span class="p">,</span> <span class="s2">&quot;red&quot;</span><span class="p">)</span>
          <span class="p">.</span><span class="nx">transition</span><span class="p">()</span>
            <span class="p">.</span><span class="nx">style</span><span class="p">(</span><span class="s2">&quot;fill&quot;</span><span class="p">,</span> <span class="s2">&quot;blue&quot;</span><span class="p">)</span>
          <span class="p">.</span><span class="nx">transition</span><span class="p">()</span>
            <span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;start&quot;</span><span class="p">,</span> <span class="nx">repeat</span><span class="p">);</span>
      <span class="p">});</span>
</pre></div>
</div>
<p>The <a class="reference external" href="https://github.com/d3/d3-transition/blob/master/README.md#the-life-of-a-transition">life cycle of a transition</a> is now more formally defined and enforced. For example, attempting to change the duration of a running transition now throws an error rather than silently failing. The <a class="reference external" href="https://github.com/d3/d3-transition/blob/master/README.md#transition_remove"><em>transition</em>.remove</a> method has been fixed if multiple transition names are in use: the element is only removed if it has no scheduled transitions, regardless of name. The <a class="reference external" href="https://github.com/d3/d3-transition/blob/master/README.md#transition_ease"><em>transition</em>.ease</a> method now always takes an <a class="reference external" href="#easings-d3-ease">easing function</a>, not a string. When a transition ends, the tweens are invoked one last time with <em>t</em> equal to exactly 1, regardless of the associated easing function.</p>
<p>As with <a class="reference external" href="#selections-d3-selection">selections</a> in 4.0, all transition callback functions now receive the standard arguments: the element’s datum (<em>d</em>), the element’s index (<em>i</em>), and the element’s group (<em>nodes</em>), with <em>this</em> as the element. This notably affects <a class="reference external" href="https://github.com/d3/d3-transition/blob/master/README.md#transition_attrTween"><em>transition</em>.attrTween</a> and <a class="reference external" href="https://github.com/d3/d3-transition/blob/master/README.md#transition_styleTween"><em>transition</em>.styleTween</a>, which no longer pass the <em>tween</em> function the current attribute or style value as the third argument. The <em>transition</em>.attrTween and <em>transition</em>.styleTween methods can now be called in getter modes for debugging or to share tween definitions between transitions.</p>
<p>Homogenous transitions are now optimized! If all elements in a transition share the same tween, interpolator, or event listeners, this state is now shared across the transition rather than separately allocated for each element. 4.0 also uses an optimized default interpolator in place of <a class="reference external" href="https://github.com/d3/d3-interpolate/blob/master/README.md#interpolate">d3.interpolate</a> for <a class="reference external" href="https://github.com/d3/d3-transition/blob/master/README.md#transition_attr"><em>transition</em>.attr</a> and <a class="reference external" href="https://github.com/d3/d3-transition/blob/master/README.md#transition_style"><em>transition</em>.style</a>. And transitions can now interpolate both <a class="reference external" href="https://github.com/d3/d3-interpolate/blob/master/README.md#interpolateTransformCss">CSS</a> and <a class="reference external" href="https://github.com/d3/d3-interpolate/blob/master/README.md#interpolateTransformSvg">SVG</a> transforms.</p>
<p>For reusable components that support transitions, such as <a class="reference external" href="#axes-d3-axis">axes</a>, a new <a class="reference external" href="https://github.com/d3/d3-transition/blob/master/README.md#transition_selection"><em>transition</em>.selection</a> method returns the <a class="reference external" href="#selections-d3-selection">selection</a> that corresponds to a given transition. There is also a new <a class="reference external" href="https://github.com/d3/d3-transition/blob/master/README.md#transition_merge"><em>transition</em>.merge</a> method that is equivalent to <a class="reference external" href="https://github.com/d3/d3-selection/blob/master/README.md#selection_merge"><em>selection</em>.merge</a>.</p>
<p>For the sake of parsimony, the multi-value map methods have been extracted to <a class="reference external" href="https://github.com/d3/d3-selection-multi">d3-selection-multi</a> and are no longer part of the default bundle. The multi-value map methods have also been renamed to plural form to reduce overload: <a class="reference external" href="https://github.com/d3/d3-selection-multi/blob/master/README.md#transition_attrs"><em>transition</em>.attrs</a> and <a class="reference external" href="https://github.com/d3/d3-selection-multi/blob/master/README.md#transition_styles"><em>transition</em>.styles</a>.</p>
</div>
<div class="section" id="voronoi-diagrams-d3-voronoi">
<h2><a class="reference external" href="https://github.com/d3/d3-voronoi/blob/master/README.md">Voronoi Diagrams (d3-voronoi)</a><a class="headerlink" href="#voronoi-diagrams-d3-voronoi" title="Permalink to this headline">¶</a></h2>
<p>The d3.geom.voronoi method has been renamed to <a class="reference external" href="https://github.com/d3/d3-voronoi/blob/master/README.md#voronoi">d3.voronoi</a>, and the <em>voronoi</em>.clipExtent method has been renamed to <a class="reference external" href="https://github.com/d3/d3-voronoi/blob/master/README.md#voronoi_extent"><em>voronoi</em>.extent</a>. The undocumented <em>polygon</em>.point property in 3.x, which is the element in the input <em>data</em> corresponding to the polygon, has been renamed to <em>polygon</em>.data.</p>
<p>Calling <a class="reference external" href="https://github.com/d3/d3-voronoi/blob/master/README.md#_voronoi"><em>voronoi</em></a> now returns the full <a class="reference external" href="https://github.com/d3/d3-voronoi/blob/master/README.md#voronoi-diagrams">Voronoi diagram</a>, which includes topological information: each Voronoi edge exposes <em>edge</em>.left and <em>edge</em>.right specifying the sites on either side of the edge, and each Voronoi cell is defined as an array of these edges and a corresponding site. The Voronoi diagram can be used to efficiently compute both the Voronoi and Delaunay tessellations for a set of points: <a class="reference external" href="https://github.com/d3/d3-voronoi/blob/master/README.md#diagram_polygons"><em>diagram</em>.polygons</a>, <a class="reference external" href="https://github.com/d3/d3-voronoi/blob/master/README.md#diagram_links"><em>diagram</em>.links</a>, and <a class="reference external" href="https://github.com/d3/d3-voronoi/blob/master/README.md#diagram_triangles"><em>diagram</em>.triangles</a>. The new topology is also useful in conjunction with TopoJSON; see the <a class="reference external" href="https://bl.ocks.org/mbostock/cd52a201d7694eb9d890">Voronoi topology example</a>.</p>
<p>The <a class="reference external" href="https://github.com/d3/d3-voronoi/blob/master/README.md#voronoi_polygons"><em>voronoi</em>.polygons</a> and <a class="reference external" href="https://github.com/d3/d3-voronoi/blob/master/README.md#diagram_polygons"><em>diagram</em>.polygons</a> now require an <a class="reference external" href="https://github.com/d3/d3-voronoi/blob/master/README.md#voronoi_extent">extent</a>; there is no longer an implicit extent of ±1e6. The <a class="reference external" href="https://github.com/d3/d3-voronoi/blob/master/README.md#voronoi_links"><em>voronoi</em>.links</a>, <a class="reference external" href="https://github.com/d3/d3-voronoi/blob/master/README.md#voronoi_triangles"><em>voronoi</em>.triangles</a>, <a class="reference external" href="https://github.com/d3/d3-voronoi/blob/master/README.md#diagram_links"><em>diagram</em>.links</a> and <a class="reference external" href="https://github.com/d3/d3-voronoi/blob/master/README.md#diagram_triangles"><em>diagram</em>.triangles</a> are now affected by the clip extent: as the Delaunay is computed as the dual of the Voronoi, two sites are only linked if the clipped cells are touching. To compute the Delaunay triangulation without respect to clipping, set the extent to null.</p>
<p>The Voronoi generator finally has well-defined behavior for coincident vertices: the first of a set of coincident points has a defined cell, while the subsequent duplicate points have null cells. The returned array of polygons is sparse, so by using <em>array</em>.forEach or <em>array</em>.map, you can easily skip undefined cells. The Voronoi generator also now correctly handles the case where no cell edges intersect the extent.</p>
</div>
<div class="section" id="zooming-d3-zoom">
<h2><a class="reference external" href="https://github.com/d3/d3-zoom/blob/master/README.md">Zooming (d3-zoom)</a><a class="headerlink" href="#zooming-d3-zoom" title="Permalink to this headline">¶</a></h2>
<p>The zoom behavior d3.behavior.zoom has been renamed to d3.zoom. Zoom behaviors no longer store the active zoom transform (<em>i.e.</em>, the visible region; the scale and translate) internally. The zoom transform is now stored on any elements to which the zoom behavior has been applied. The zoom transform is available as <em>event</em>.transform within a zoom event or by calling <a class="reference external" href="https://github.com/d3/d3-zoom/blob/master/README.md#zoomTransform">d3.zoomTransform</a> on a given <em>element</em>. To zoom programmatically, use <a class="reference external" href="https://github.com/d3/d3-zoom/blob/master/README.md#zoom_transform"><em>zoom</em>.transform</a> with a given <a class="reference external" href="#selections-d3-selection">selection</a> or <a class="reference external" href="#transitions-d3-transition">transition</a>; see the <a class="reference external" href="https://bl.ocks.org/mbostock/b783fbb2e673561d214e09c7fb5cedee">zoom transitions example</a>. The <em>zoom</em>.event method has been removed.</p>
<p>To make programmatic zooming easier, there are several new convenience methods on top of <em>zoom</em>.transform: <a class="reference external" href="https://github.com/d3/d3-zoom/blob/master/README.md#zoom_translateBy"><em>zoom</em>.translateBy</a>, <a class="reference external" href="https://github.com/d3/d3-zoom/blob/master/README.md#zoom_scaleBy"><em>zoom</em>.scaleBy</a> and <a class="reference external" href="https://github.com/d3/d3-zoom/blob/master/README.md#zoom_scaleTo"><em>zoom</em>.scaleTo</a>. There is also a new API for describing <a class="reference external" href="https://github.com/d3/d3-zoom/blob/master/README.md#zoom-transforms">zoom transforms</a>. Zoom behaviors are no longer dependent on <a class="reference external" href="#scales-d3-scale">scales</a>, but you can use <a class="reference external" href="https://github.com/d3/d3-zoom/blob/master/README.md#transform_rescaleX"><em>transform</em>.rescaleX</a>, <a class="reference external" href="https://github.com/d3/d3-zoom/blob/master/README.md#transform_rescaleY"><em>transform</em>.rescaleY</a>, <a class="reference external" href="https://github.com/d3/d3-zoom/blob/master/README.md#transform_invertX"><em>transform</em>.invertX</a> or <a class="reference external" href="https://github.com/d3/d3-zoom/blob/master/README.md#transform_invertY"><em>transform</em>.invertY</a> to transform a scale’s domain. 3.x’s <em>event</em>.scale is replaced with <em>event</em>.transform.k, and <em>event</em>.translate is replaced with <em>event</em>.transform.x and <em>event</em>.transform.y. The <em>zoom</em>.center method has been removed in favor of programmatic zooming.</p>
<p>The zoom behavior finally supports simple constraints on panning! The new <a class="reference external" href="https://github.com/d3/d3-zoom/blob/master/README.md#zoom_translateExtent"><em>zoom</em>.translateExtent</a> lets you define the viewable extent of the world: the currently-visible extent (the extent of the viewport, as defined by <a class="reference external" href="https://github.com/d3/d3-zoom/blob/master/README.md#zoom_extent"><em>zoom</em>.extent</a>) is always contained within the translate extent. The <em>zoom</em>.size method has been replaced by <em>zoom</em>.extent, and the default behavior is now smarter: it defaults to the extent of the zoom behavior’s owner element, rather than being hardcoded to 960×500. (This also improves the default path chosen during smooth zoom transitions!)</p>
<p>The zoom behavior’s interaction has also improved. It now correctly handles concurrent wheeling and dragging, as well as concurrent touching and mousing. The zoom behavior now ignores wheel events at the limits of its scale extent, allowing you to scroll past a zoomable area. The <em>zoomstart</em> and <em>zoomend</em> events have been renamed <em>start</em> and <em>end</em>. By default, zoom behaviors now ignore right-clicks intended for the context menu; use <a class="reference external" href="https://github.com/d3/d3-zoom/blob/master/README.md#zoom_filter"><em>zoom</em>.filter</a> to control which events are ignored. The zoom behavior also ignores emulated mouse events on iOS. The zoom behavior now consumes handled events, making it easier to combine with other interactive behaviors such as <a class="reference external" href="#dragging-d3-drag">dragging</a>.</p>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./node_modules/d3"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        
        <div class='prev-next-bottom'>
            

        </div>
        
        </div>
    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By The FAIRplus project members<br/>
        
            &copy; Copyright 2020 (CC-BY 4.0).<br/>
          <div class="extra_footer">
            <script>mermaid.init();</script> <div class="row_footer"> This project has received funding from the <a href="https://www.imi.europa.eu/">Innovative Medicines Initiative</a> 2 Joint Undertaking under grant agreement No 802750. This Joint Undertaking receives support from the European Union’s Horizon 2020 research and innovation programme and EFPIA Companies. This communication reflects the views of the authors and neither IMI nor the European Union, EFPIA or any Associated Partners are liable for any use that may be made of the information contained herein. </div>
<div class="row_footer"> This page was created by <a href="https://github.com/jupyter/jupyter-book/graphs/contributors">The Jupyter Book Community</a> </div>
<div class="row_footer"> <div class="column" style="center"><a href="https://europa.eu/"><img src="https://raw.githubusercontent.com/FAIRplus/the-fair-cookbook/migrating/_static/images/logo/eu-flag-recolored-fairplus.png" height="20" alt="EU flag" style="float:center""></a></div> <div class="column"><a href="https://www.imi.europa.eu/"><img src="https://raw.githubusercontent.com/FAIRplus/the-fair-cookbook/migrating/_static/images/logo/imi-logo-fairplus-v1.png" height="20" alt="IMI logo" style="float:center""></a></div> <div class="column"><a href="https://efpia.eu"><img src="https://raw.githubusercontent.com/FAIRplus/the-fair-cookbook/migrating/_static/images/logo/efpia-logo-fairplus2.png" height="20" alt="EFPIA logo" style="float:center""></a></div> <br/> </div>
          </div>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>

    
  <script src="../../_static/js/index.d3f166471bb80abb5163.js"></script>


    
    <!-- Google Analytics -->
    <script>
      window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
      ga('create', 'UA-171697285-1', 'auto');
      ga('set', 'anonymizeIp', true);
      ga('send', 'pageview');
    </script>
    <script async src='https://www.google-analytics.com/analytics.js'></script>
    <!-- End Google Analytics -->
    
  </body>
</html>